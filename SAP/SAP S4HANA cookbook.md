**SAP S/4HANA Cookbook**
**顧客/仕入先統合 (CVI)**
**顧客**

**SAP**
**Run Simple**

---

**目次**

1. **文書の目的と範囲** 5
2. **顧客/仕入先統合の背景と動機** 6
3. **ビジネスへの影響** 8
4. **ソリューションへの影響** 10
    4.1. Fioriアプリ: 顧客マスタデータ管理 10
    4.2. Fioriアプリ: 仕入先マスタデータ管理 10
    4.3. ビジネスパートナの権限 11
    4.4. 変換プロセスの権限 12
    4.5. 顧客階層 12
    4.6. 顧客分類 12
    4.7. タイム依存性の利用 13
5. **CVI変換シナリオ** 14
6. **新規導入 (グリーンフィールド) のCVI** 16
    6.1. 設定 16
    6.2. 移行 / BP更新 17
7. **CVI同期化 システム変換** 18
    7.1. 概要とフェーズアプローチ 18
    7.2. CVIコックピット 18
    7.3. **準備** 23
        7.3.1. CVIのTCIノート 23
        7.3.2. S/4HANA事前チェックとチェックレポート 24
            7.3.2.1. マスタデータクレンジング: マスタデータ整合性チェック 24
            7.3.2.2. CVIカスタマイズ – チェック 26
            7.3.2.3. CVI完全性 – チェック 27
        7.3.3. 削除フラグ付きの顧客/仕入先データのアーカイブ 27
        7.3.4. SAP CRMとの依存関係チェック 28
        7.3.5. 連絡担当者マッピング 28
        7.3.6. ビジネス機能の有効化 28
        7.3.7. 顧客/仕入先拡張機能のチェックと統合 29
        7.3.8. CVI/BPカスタマイズのチェックと調整 30
            7.3.8.1. マスタデータ同期化 50
                7.3.8.1.1. データ配賦のためのファンクションモジュール (CRM) 50
                7.3.8.1.2. 後処理オーダーの作成の有効化 50
                7.3.8.1.3. プラットフォームオブジェクトのためのPPOリクエストの有効化 51
                7.3.8.1.4. 同期化オプションの有効化 51
            7.3.8.2. 番号範囲とグルーピング 52
                7.3.8.2.1. 概要 52
                7.3.8.2.2. 顧客マスタレコードの番号範囲定義 55
                7.3.8.2.3. 仕入先マスタレコードの番号範囲定義 56
                7.3.8.2.4. ビジネスパートナの番号範囲とグルーピングの定義 57
                7.3.8.2.5. 関係の番号範囲定義 58
                7.3.8.2.6. アカウントグループへのビジネスパートナロールの割り当て 58
                7.3.8.2.7. 番号割当 (CVIターゲット: ビジネスパートナ) 60
                7.3.8.2.8. 一般的なビジネス要件の例 61
            7.3.8.3. 顧客値マッピング (連絡担当者) 62
                7.3.8.3.1. 連絡担当者の割当の有効化 62
                7.3.8.3.2. 連絡担当者の部門番号の割当 62
                7.3.8.3.3. 連絡担当者の機能の割当 63
                7.3.8.3.4. 連絡担当者の権限の割当 63
                7.3.8.3.5. 連絡担当者のVIPインジケータの割当 64
            7.3.8.4. 顧客値マッピング 64
                7.3.8.4.1. 婚姻状況の割当 65
                7.3.8.4.2. 法的形態の法的ステータスへの割当 65
                7.3.8.4.3. 支払カードの割当 66
                7.3.8.4.4. 業種の割当 66
        7.3.8.5. 仕入先値マッピング 68
            7.3.8.5.1. 連絡担当者 68
            7.3.8.5.2. 業種の割当 68
        7.3.8.6. 独自のマッピング開発のためのビジネスアドイン (BAdI) 69
        7.3.8.7. ビジネスパートナのアドレスタイプのチェック 69
        7.3.9. 顧客と仕入先を単一のビジネスパートナにリンクするための準備 70
        7.3.10. HCM従業員のビジネスパートナへの変換の準備 70
    7.4. **同期化** 71
        7.4.1. 同期化コックピット 72
        7.4.2. 後処理オフィス (PPO) 75
        7.4.3. 例 - PPOを使用した同期化エラーの解決 77
        7.4.4. 同期化完了のチェック 80
        7.4.5. 設定およびマスタデータの問題 80
            7.4.5.1. CVI設定の問題 80
                7.4.5.1.1. BUPA_TAXN011 - 税コードカテゴリが存在しない 80
                7.4.5.1.2. R11173 - 業種の指定 81
                7.4.5.1.3. F2868/F2869 - アドレスフォームが組織向けに設定されていない 81
                7.4.5.1.4. T5002 - 国コードXXの電話/ファックスコードが維持されていない 82
            7.4.5.2. マスタデータの問題 82
                7.4.5.2.1. 取引先xxが顧客yyに割り当てられていない 82
                7.4.5.2.2. AR102 - 銀行口座キーの長さがxxでなければならない 83
                7.4.5.2.3. AR147 - 銀行管理キーは2文字でなければならない 83
                7.4.5.2.4. 銀行キーxxxが国yyに存在しない 84
                7.4.5.2.5. 口座名義人がいない 84
                7.4.5.2.6. AM654 - 郵便番号 (私書箱) の長さがxxまたはyyでなければならない 84
                7.4.5.2.7. AR128/AR129 - 税コードnは無効です 85
                7.4.5.2.8. 税管轄コードは無効です 85
                7.4.5.2.9. BUPA_TAX200 - 税コードカテゴリXXXの税番号はすでに維持されています 85
                7.4.5.2.10. 税コードnの項目への入力がXX文字を超えています 86
                7.4.5.2.11. 存在しない顧客/仕入先への参照 87
                7.4.5.2.12. 不正なクレジットカード番号の割当 87
                7.4.5.2.13. BC428 - KNVKテーブルの訪問時間の不整合 (許可されていないオーバーフロー) 87
                7.4.5.2.14. 顧客マスタにWebアドレスがない 88
                7.4.5.2.15. ビジネスパートナ国が定義されていない 89
                7.4.5.2.16. F2840 - 輸送ゾーンXXは国XXに定義されていません 89
                7.4.5.2.17. XYZフィールドの最後のX文字の使用が制限されています (YYのXX) 89
            7.4.5.3. その他の問題 91
                7.4.5.3.1. R11124 - GUID xxxxxのビジネスパートナが存在しない 91
                7.4.5.3.2. R1908 - GUID xxxxxxのビジネスパートナがすでに存在します 91
                7.4.5.3.3. ロックテーブルオーバーフロー 91
                7.4.5.3.4. 更新終了エラー (ADRNR) 91
                7.4.5.3.5. R11244 - アドレスの有効期間のエラー 92
                7.4.5.3.6. AM053 - アドレス番号またはアドレスハンドルを指定してください 92
                7.4.5.3.7. F2810/F4230 - 銀行XXXが国YYで削除マークされています 92
                7.4.5.3.8. すべてのアドレス番号が定義されていません 92
                7.4.5.3.9. その他 93
    7.5. **変換プロセス** 93
        7.5.1. CVI変換アプローチ: 主要な考慮事項 93
        7.5.2. CVI変換アプローチ: 例 93
        7.5.3. SUM実行中のCVI事前チェックのバイパス (概念実証 (POC) 使用のみ) 94
        7.5.4. ヒントとトリック 95
    7.6. **変換後アクティビティ** 95
        7.6.1. 後処理オーダーの作成の有効化 (BPから顧客/仕入先への方向) 95
        7.6.2. 同期化オプションの有効化 (BPから顧客/仕入先への方向) 96
        7.6.3. 顧客統合のためのBPロールカテゴリの設定 98
        7.6.4. 番号割当 (CVIターゲット: 顧客/仕入先) 99
        7.6.5. アカウントグループの項目ステータスの変更 100
        7.6.6. 業種の対応付け 100
        7.6.7. 一般的な対応付けチェック 100
        7.6.8. ヒントとトリック 100
8. **カスタムコードへの影響** 101
9. **周辺システム/その他のアプリケーションへの影響** 102
    9.1. インターフェース 102
        9.1.1. 一般情報 102
        9.1.2. S/4HANAのIDoc DEBMAS/CREMAS 102
    9.2. 従業員レプリケーション 102
    9.3. 与信管理 103
    9.4. CRM 104
    9.5. 業種ソリューション – ユーティリティ (IS-U) 106
    9.6. 業種ソリューション – 小売 (IS-R) 106
    9.7. MDG (S/4に埋め込み) 106
    9.8. SAP Cloud for Customer (C4C) 107
10. **追加情報** 108
    10.1. SAPノート 108
    10.2. ドキュメント 111
11. **図一覧** 112

---
**文書情報**

| Reviewed | Date |
|---|---|
| 2022/02 | 2022/02 |

| Version | Changes | Date |
|---|---|---|
| 16Q4 | 初期バージョン | 2016/Q4 |
| 16Q4_V05 | レビュー用バージョン | 2017/Q1 |
| 17Q1 | 最終版 | 2017/Q1 |
| 17Q1_V2 | 章「2.4.4.1.7.7 その他のカスタマイズチェック」と「2.4.4.2.5.4 国固有チェックのスイッチオフ」を追加 | 2017/Q2 |
| 17Q4 | 外部リリース向けに調整されたドキュメント | 2017/Q4 |
| 17Q4_V2 | プロジェクトからの経験の導入 | 2017/Q4 |
| 18Q2 | CVIチェックのバイパスに関するパラグラフ7.3.3の更新 PDF変換で埋め込みオブジェクトからサンプルコーディングを移動 (パラグラフ「7.1.9.3 マスタデータチェック」から付録1へ) 埋め込みExcelをスクリーンショットに置き換え (パラグラフ 7.1.7.2.1) | 2018/Q2 |
| 18Q2_V2 | • 項目ステータスの回避策をSAPノート2516606に置き換え • HCM従業員マッピング (サンプルコーディング) (第7.1.10章) • SUM開始前のPPO処理 (第7.4.1章) • 仕入先連絡担当者の必須SP (第7.1.4章) • 第7.1.9.3マスタデータチェックの削除 | 2018/Q2 |
| 19Q4 | 全体的な更新 | 2019/Q4 |
| 20Q4 | 全体的な更新 | 2020/Q4 |
| 21Q2 | 軽微な変更 | 2021/Q1 |
| 21Q4 | • CVIコックピットSAPノートおよびTCI CVI SAPノート2.0に関する第7.2章と7.3.1章の更新 • SAP S/4HANA変換フェーズの前にCVI/BP同期化フェーズを分離フェーズとして実施するという段階的アプローチに関する追加の推奨事項の説明 | 2021/Q4 |
| 22Q1 | • 第1章の機能強化 • 第3章、4.3ビジネスパートナ権限、および4.4変換プロセスの権限の更新レビュー • 書式設定と軽微な変更 • 第7.2章CVIコックピットと7.3.1TCI CVIノートの更新 • Cookbook添付ファイル「TCI 2.0 Input Notes_Release_Wise.xlsx」がSAP KBAノート3147029 - CVIコックピットおよびCVIのTCIに関するガイド付き回答に移動 | 2022/Q1 |

---
**1. 文書の目的と範囲** (5ページ)

本ドキュメントは、顧客/仕入先統合 (CVI) のトピックに関するガイダンスとして意図されています。CVIは、ほとんどのSAP顧客に影響を与えるSAP S/4HANAの主要な簡素化の1つです。本ドキュメントは主に、システム変換シナリオ (ブラウンフィールド) のCVIに関するトピックについてガイダンスを提供します。グリーンフィールドアプローチ (新規導入) については、ベストプラクティスを参照し、第6章でいくつかの情報を追加しています。

本ドキュメントでは、「CVI変換」と「CVI同期化」という用語は、SAPノートとドキュメントの両方に登場するため、相互に入れ替えて使用されます。

第1章では、文書の構成と目的の概要を説明します。

第2章では、SAPにおける顧客と仕入先の定義、ビジネスパートナデータモデルの利点、CVIの考え方など、CVIの背景と動機について理解を深めることができます。

第3章では、CVIのビジネスへの影響、マスタデータ品質とクレンジングに関するSAPの推奨事項、販売および購買における顧客および仕入先のマスタデータ作成と保守などのビジネスプロセスへの影響、SAP ERP 6.0におけるBPの制限の概要を説明します。

第4章では、顧客および仕入先のマスタデータを保守するための利用可能なFioriアプリの概要、変換プロセスに必要なBPの権限オブジェクトのほとんど、顧客階層、顧客分類、タイム依存性の利用などの機能について概説します。

第5～7章では、可能なCVI変換シナリオ（システム変換/ブラウンフィールドおよび新規導入/グリーンフィールド）と、同期化の前に実行する必要がある必要な準備ステップ、チェック、カスタマイズアクティビティについて説明します。第7.4～7.6章では、同期化コックピットの設定、同期化中に発生する可能性のある後処理アクティビティと問題、および同期化後に変更する必要がある設定とヒントとトリックについて説明します。

第8章では、カスタムコードへの影響に関する情報を見つけることができます。

第9章では、周辺システム、インターフェース、その他のアプリケーションとの統合への影響について説明し、インダストリソリューションとMDGおよびC4Cとの統合に関する特定のステップに関する情報を提供します。

第10章では、関連するSAPノートとドキュメントの形式で追加情報を提供します。

第11章には、図の一覧が含まれています。

---
**2. 顧客/仕入先統合の背景と動機** (6ページ)

従来のERPシステムには、冗長なオブジェクトモデルがあります。ここでは、仕入先マスタと顧客マスタが使用されており、これらにはいくつかの制約があります。顧客/仕入先オブジェクトモデルの制限事項：

* 1つの住所のみ
* 同じ実世界エンティティに対する仕入先と顧客間の関係がない (ロールコンセプトなし)
* 個人 (B2C) の対象外
* タイム依存性なし

SAP S/4HANAの戦略的なオブジェクトモデルはビジネスパートナ (BP) です。ビジネスパートナは、ビジネスパートナ、顧客、仕入先のマスタデータを一元的に管理できます。現在の開発では、BPはビジネスパートナ、顧客、仕入先のマスタデータを作成、編集、表示するための単一のエントリーポイントです。

SAPビジネスパートナの用語では、顧客と仕入先の定義は次のとおりです。

**顧客**

顧客とは、モノやサービスが販売または納入されるビジネスパートナのことです。例えば、顧客があなたにモノを供給する場合、ビジネスパートナは顧客であると同時に仕入先にもなり得ます。

顧客マスタには、名前、住所、銀行詳細、税務詳細、納入および請求の環境設定など、顧客に関する情報が含まれます。この顧客情報は、販売注文、入庫、請求書などのトランザクションで使用され、保存されます。

一部の顧客情報は、組織内の会社コード別、または販売エリア別の固有のものです。

**仕入先**

仕入先（またはサプライヤ）とは、組織にモノやサービスを納入・販売するビジネスパートナのことです。例えば、仕入先があなたにモノを供給する場合、ビジネスパートナは仕入先であると同時に顧客にもなり得ます。

仕入先マスタには、名前、住所、銀行詳細、税務詳細、請求の環境設定など、仕入先に関する情報が含まれます。この仕入先情報は、購買発注、入庫、仕入先請求書などのトランザクションで使用され、保存されます。

一部の仕入先情報は、組織内の会社コード別、または購買組織別の固有のものです。

ビジネスパートナを使用することには、以下の利点があります。

* 法的エンティティは1つのビジネスパートナで表現されます
* 1つのビジネスパートナが複数のロール (例: 顧客および仕入先 (サプライヤ)) を実行できます
* すべての異なるビジネスパートナロールで一般データが利用可能であり、特定データは各ロール用に保存されます
* 最大限のデータ共有とデータ再利用により、データ統合が容易になります
* ビジネスパートナカテゴリ（組織、個人、グループ）の違い
* 「連絡担当者がいる」、「既婚である」などの柔軟なビジネスパートナ関係が可能
* 1つのビジネスパートナが複数の住所を持つことができます
* 異なるサブエンティティ（ロール、住所、関係、銀行データなど）に対するタイム依存性
* アプリケーション全体での統一されたアーキテクチャの提供

SAP S/4HANAでビジネスパートナをリードオブジェクトとして使用するには、CVI（顧客/仕入先統合）を使用する必要があります。CVIコンポーネントは、ビジネスパートナオブジェクトと顧客/仕入先オブジェクト間の同期化を保証します。

CVIは、マスタデータ同期化コックピットツールによってサポートされる自動化された手順です。これは、顧客マスタおよび仕入先マスタオブジェクトをSAPビジネスパートナオブジェクトと同期化するために使用されます。CVIは、すべての顧客および仕入先マスタデータオブジェクトを新しく作成されたSAPビジネスパートナオブジェクトに割り当て、その逆も行います。

以下の図は、その背景を示しています。

**図1: CVI複合インターフェース**

顧客または仕入先が作成されると、常にビジネスパートナが作成されます。

CVI (顧客/仕入先統合) の複合インターフェースには、ビジネスパートナ固有のデータだけでなく、顧客および仕入先の固有のデータも含まれています。

ビジネスパートナと顧客/仕入先のデータの一部は冗長です (BUT000対KNA1 & LFA1データ)。例えば、「名称と住所固有の属性」は両方のテーブルセットで利用可能です。

顧客または仕入先の固有のデータは、顧客/仕入先固有のインターフェースを通じてルーティングされ、ビジネスパートナの中央データと混在されます。

コミット時に、ビジネスパートナと対応する顧客および/または仕入先が保守/作成されます。

SAPは、ガイド付き手順レポートを通じて、既存の顧客および仕入先データをビジネスパートナに変換することをサポートします。

---
**3. ビジネスへの影響** (8ページ)

顧客/仕入先統合がすでに導入されているSAP Business Suiteの顧客のみが、SAP S/4HANAオンプレミス版1909、2020、2021以降に移行できます (システム変換アプローチ)。

アップグレードを成功させるためには、すべての顧客、仕入先、および顧客または仕入先に関連するすべての連絡担当者（削除フラグ付きの顧客および仕入先を含む）をビジネスパートナに変換する必要があります。

CVIは、変換されるマスタデータが高い品質であることを要求します。マスタデータは非常に重要であるため、顧客はCVIプロジェクトを開始する前に、データ整合性チェックレポートを実行し、CVIプロジェクトを危険にさらす可能性のあるマスタデータの問題を修正することが推奨されます。レポートの実行とデータクレンジングにより、CVI作業に使用されるマスタデータが高品質であることが保証されます。

事前に実行しないと、変換にとって深刻な障害となる可能性があります。マスタデータ整合性チェックレポートに関する詳細は、セクション7.3.2.1「マスタデータクレンジング: マスタデータ整合性チェック」で確認できます。

CVI変換を実行する前に、SAPは削除フラグの付いた顧客/仕入先をアーカイブすることを推奨します (セクション7.3.3「削除フラグ付きの顧客/仕入先データのアーカイブ」)。

ビジネス要件に応じて、ビジネスパートナと顧客/仕入先が同じ番号を持つことを検討できます。また、現在の顧客/仕入先番号とは完全に独立したBP番号を設定することも決定できます。

このアプローチは、SAP S/4HANAの新規導入で可能です。BP、顧客、仕入先のすべての番号を自由に設計できます。

既存のSAP ERPからSAP S/4HANAへの変換の場合、顧客と仕入先の番号範囲はすでに確立されています。この場合、BPの番号の均一性を設定すると、次のようになる可能性があります。

* 番号の均一性を保証するためだけに、追加のカスタマイズ設定が必要になります。例：アカウントグループへの追加のBPグルーピング 1:1。
* 制限事項
    * 顧客マスタと仕入先マスタが（部分的に）重複する番号範囲を持つ場合、1つのオブジェクトのみがBPと同じ番号を持つことができます。
    * 異なる番号を持つ同じ法的エンティティの特定の顧客と仕入先を1つのBPにマージする場合、BPオブジェクトが顧客または仕入先のどちらの番号付けを使用するか、または完全に新しい番号を使用するかを検討する必要があります。
    * 顧客と仕入先だけでなく、SAP S/4HANAへの変換中にHCM従業員マスタもBPに変換する必要があります。HCM従業員マスタは、顧客および仕入先の番号範囲と重複する番号範囲を持つ可能性があります。番号の重複の概念の制限は、顧客と仕入先、従業員など、異なるソースオブジェクトの番号を維持したい場合に、番号範囲の概念の制限につながる可能性があります。この制限は、BPを使用する他のアプリケーションとの関係にも適用される場合があります。「人工的」なBP番号付けに制限のあるアプリケーションを考慮する必要があります。

SAP S/4HANAで顧客および仕入先のマスタデータを登録および保守するためのユーザーインターフェースは、トランザクションBPおよび対応するSAP Fioriアプリです (セクション4.1および4.2を参照)。SAP Business Suiteでの顧客/仕入先を保守するための特定のトランザクションコードは、SAP S/4HANAでは利用できません。BPトランザクションは、ビジネスパートナ、顧客、仕入先のすべてのマスタデータを登録、編集、表示するための単一のエントリーポイントです。

以下のSAP Business Suiteトランザクションは、トランザクションBPにリダイレクトされます。

* FD01, FD02, FD03
* FK01, FK02, FK03
* MAP1, MAP2, MAP3
* MK01, MK02, MK03
* V-03, V-04, V-05, V-06, V-07, V-08, V-09, V-11
* VAP1, VAP2, VAP3
* VD01, VD02, VD03
* XD01, XD02, XD03
* XK01, XK06, XK07, XK02, XK03

以下のトランザクションは廃止されています。

FD06, FK06, MK06, MK12, MK18, MK19, VD06, XD06, V+21, V+22, V+23

トランザクションMASSを使用したビジネスパートナ項目の大量保守は、「ビジネスパートナ」オブジェクトを介して利用可能です。

S/4HANA 1709で顧客/仕入先項目を更新するには、SAPノート2346269 – XD99およびXK99を使用した顧客/サプライヤの大量保守機能が必要です。1809以降のS/4HANAの後のバージョンでは、この機能がすでに組み込まれています。

SAP Business Suiteの顧客番号と仕入先番号は、VA01、ME21N、または標準レポートなどの、以前のSAP Business Suiteトランザクションの選択入力として引き続き使用されます。顧客または仕入先に新しいBP番号が割り当てられた場合、これらのトランザクションまたはレポートではSAP Business Suiteの顧客または仕入先番号を使用する必要があります。

CVIは、BPが作成/変更された後に顧客および仕入先マスタデータテーブルが自動的に更新されることを保証します。すべてのKNxxおよびLFxx顧客/仕入先マスタデータテーブルは、以前のSAP Business Suiteと同様に引き続き移入されます。

SAP S/4HANAでは、BPトランザクションがほぼすべての顧客/仕入先マスタデータ項目をカバーします。標準のSAP S/4HANA BPトランザクションに含まれていない追加項目については、独自のカスタム項目を追加するためにBDTインターフェースアクティビティを確認してください。セクション7.3.7「顧客/仕入先拡張機能のチェックと統合」も確認してください。

**同期化方向 BP->顧客 /仕入先 のS/4HANA (SAP ERP 6.0) における制限**

技術的には、この同期化方向はSAP ERP 6.0で利用可能です。しかし、SAP ERP 6.0でBPをリードオブジェクトとして使用する場合、S/4HANAと比較して考慮すべき機能的な制限がいくつかあります。例：

* BPトランザクションを使用してすべての顧客またはサプライヤ項目を保守することはできません。なぜなら、すべての項目がBPトランザクションで利用できるわけではないからです。BPトランザクションを改善する計画はありません。ビジネスパートナは、ERPシステムでのXD\*およびXK\*のような顧客/仕入先トランザクションの代替ではありません。

さらに詳細については、以下のSAPノートを参照してください。

* 1025037 - BP_CVI: 顧客-仕入先統合の機能範囲
* 2772037 - T-code BPで購買項目が不足
* アカウントグループはBPトランザクションで表示されず、変更できません。
* BPがリードオブジェクトである場合、統合とインターフェースの保守の問題が発生する可能性があります。FIの観点からの項目変更 (例：アカウントグループによる) はBPトランザクションでは考慮されません。
* BP、BP-顧客、BP-仕入先を保守するためのFIORIアプリはありません。
* 「顧客/仕入先によるBP」のような検索ヘルプ/ロケータ検索や表示はありません。
* BPトランザクションから顧客/仕入先ドキュメントにアクセスすることはできません。
* BPトランザクションから、顧客または仕入先の分類データへの直接メニューリンクはありません。
* 顧客/仕入先のパートナー機能手順での前方ナビゲーションはサポートされていません (パートナー番号のダブルクリックはサポートされていません)。
* すべてのSAP Business Suiteヘルプドキュメントは、ビジネスパートナトランザクションではなく、顧客および仕入先トランザクションを参照しています。

---
**4. ソリューションへの影響** (10ページ)

**4.1. Fioriアプリ: 顧客マスタデータ管理** (10ページ)

このアプリを使用すると、販売に関わる部門のために顧客マスタデータを一元的に管理できます。ロール **SAP\_BR\_BUPA\_MASTER\_SPECIALIST** を使用して、顧客マスタデータの作成、変更、検索、表示、コピーが可能です。

販売組織および会社コードのコピー機能はFIORIでのみ利用可能であることに注意してください。

**主な機能**

* **顧客マスタデータの作成。**
    * 「個人を作成」または「組織を作成」ボタンを使用して、新しい顧客マスタデータを作成します。基本データ、ロール、住所などの関連フィールドに値を入力します。エントリを保存します。
* **顧客マスタデータの変更。**
    * リストレポートページから顧客マスタデータレコードを開きます。検索フィールドを使用して検索し、「実行」ボタンをクリックして変更する顧客マスタデータを検索することもできます。「編集」ボタンをクリックします。これにより、顧客データがドラフトモードで開かれ、値を変更できます。変更を保存します。
* **顧客マスタデータのコピー。**
    * リストレポートページから顧客を選択し、「コピー」ボタンをクリックします。以前選択した顧客の詳細がすべて表示された新しい顧客マスタデータレコードページがドラフトモードで表示されますが、ビジネスパートナ番号は除きます。必要に応じて値を編集します。「エントリを保存」します。顧客マスタデータレコードは、新しいビジネスパートナ番号で保存されます。
* **タイム依存性。**
    * タイム依存性が有効になっている場合、ロール、住所、住所使用、銀行口座、連絡担当者などのフィールドに対して有効開始日と有効終了日を設定できます。タイム依存性が有効になっていない場合、システムはデフォルト値を使用します。デフォルト値は現在の日付（有効開始日）と31.12.9999（有効終了日）です。
* **住所使用。**
    * これにより、好みに応じて異なる住所（例：自宅住所、勤務先住所、ホリデーホーム）を管理できます。顧客および仕入先ロールでは、標準住所 (XXDEFAULT) が必須です。
* **添付ファイル。**
    * この機能により、顧客マスタデータレコードに関連する添付ファイルを提供できます。このアプリは、一般オブジェクトサービス (GOS) タイプの添付ファイルのみをサポートします。
    * GOS添付ファイルに関するこのブログも確認してください:
    https://blogs.sap.com/2020/11/03/generic-object-services-gos-attachments-for-business-partner/
    * Fioriアプリライブラリで詳細を確認してください:
    https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/#/detail/Apps('F0850A')/S6OP

**4.2. Fioriアプリ: 仕入先マスタデータ管理** (10ページ)

このアプリを使用すると、すべての購買部門 (例：購買部門) の仕入先マスタデータを一元的に管理できます。ロール **SAP\_BR\_BUPA\_MASTER\_SPECIALIST** を使用して、仕入先マスタデータの作成、変更、検索、表示、コピーが可能です。

購買組織および会社コードのコピー機能はFIORIでのみ利用可能であることに注意してください。

**主な機能**

* **仕入先マスタデータの作成。**
    * 「個人を作成」または「組織を作成」ボタンを使用して、新しい仕入先マスタデータを作成します。基本データ、ロール、住所などの関連フィールドに値を入力します。エントリを保存します。
* **仕入先マスタデータの変更。**
    * リストレポートページから仕入先マスタデータレコードを開きます。検索フィールドを使用して検索し、「実行」ボタンをクリックして変更する仕入先マスタデータを検索することもできます。「編集」ボタンをクリックします。これにより、仕入先データがドラフトモードで開かれ、値を変更できます。変更を保存します。
* **仕入先マスタデータのコピー。**
    * リストレポートページから仕入先を選択し、「コピー」ボタンをクリックします。以前選択した仕入先のすべての詳細が新しいビジネスパートナ番号を除いて表示された仕入先マスタデータページがドラフトモードで表示されます。必要に応じて値を編集します。「エントリを保存」します。仕入先マスタデータレコードは、新しいビジネスパートナ番号で保存されます。
* **タイム依存性。**
    * タイム依存性が有効な場合、ロール、住所、住所使用、銀行口座、連絡担当者などのフィールドに対して有効開始日と有効終了日を設定できます。タイム依存性が有効になっていない場合、システムはデフォルト値を使用します。デフォルト値は現在の日付（有効開始日）と31.12.9999（有効終了日）です。
* **住所使用。**
    * これにより、好みに応じて異なる住所（例：自宅住所、勤務先住所、ホリデーホーム）を管理できます。顧客および仕入先ロールでは、標準住所 (XXDEFAULT) が必須です。
* **添付ファイル。**
    * この機能により、仕入先マスタデータレコードに関連する添付ファイルを提供できます。このアプリは、一般オブジェクトサービス (GOS) タイプの添付ファイルのみをサポートします。
    * GOS添付ファイルに関するこのブログも確認してください:
    https://blogs.sap.com/2020/11/03/generic-object-services-gos-attachments-for-business-partner/
    * Fioriアプリライブラリで詳細を確認してください:
    https://fioriappslibrary.hana.ondemand.com/sap/fix/externalViewer/#/detail/Apps('F1053A')/S6OP

**4.3. ビジネスパートナの権限** (11ページ)

顧客および仕入先に対する権限コンセプトはS/4HANAで変更されません。顧客および仕入先に対して利用可能なSAP ERP 6.0の権限オブジェクトに加えて、追加のBP権限オブジェクト「B\_BUPA\*」および「B\_BUPR\*」があります。

SAPビジネスパートナのセキュリティは、SAPビジネスパートナの一般的な権限コンセプトによって保証されます。支払いカードなどの機密データのセキュリティは、暗号化を使用することでさらに保護できます。トランザクションSU21を使用して権限オブジェクトを見つけることができます。

ビジネスパートナセキュリティに関する詳細については、リンク SAP Business Partner Security - SAPヘルプポータルを参照してください。

最も一般的なSAPビジネスパートナ権限オブジェクトの簡単な説明を以下に示します。

**権限オブジェクト: B\_BUPA\_GRP - 権限グループ**
権限グループ: この権限オブジェクトを使用すると、どのビジネスパートナを権限グループに基づいて編集できるかを定義します。

**権限オブジェクト: B\_BUPA\_ATT - 権限タイプ**
権限タイプ: この権限オブジェクトを使用すると、ビジネスパートナ保守における任意の数の入力フィールドに対する権限を定義できます。どのビジネスパートナを保守できるかを、フィールド値に基づいて決定します。カスタマイズで権限タイプを定義し、チェックされるフィールド名を指定します。

**権限オブジェクト: B\_BUPA\_FDG - 項目グループ**
項目グループ: この権限オブジェクトを使用すると、ビジネスパートナ保守における個々の項目グループに対する権限を定義できます。これにより、ビジネスパートナ保守でどの項目をユーザーが保守または表示できるかを定義します。

**権限オブジェクト: B\_BUPA\_RLT - BPロール**
ロール: この権限オブジェクトを使用すると、編集できるビジネスパートナロールを定義します。

**B\_BUPR\_BZT 関係カテゴリ**
この権限オブジェクトにより、処理できる関係カテゴリを確立します。

**B\_BUPR\_FDG 関係項目グループ**
この権限オブジェクトにより、ビジネスパートナ関係保守における個々の項目グループに対する権限を定義できます。これにより、ビジネスパートナ関係のどの項目をユーザーが保守または表示できるかを定義します。

**支払いカード:**
**B\_CARD\_SEC**
権限暗号化カードマスタ: このオブジェクトを使用して、支払いカードマスタデータの表示および/または保守の権限を規制できます。このオブジェクトを使用して、支払いカードデータの暗号化または復号化の権限を制御します。

**B\_CCARD**
支払いカード: このオブジェクトを使用して、支払いカードマスタデータの表示および/または保守の権限を規制できます。

SAP S/4HANAにおける権限シナリオおよび詳細情報については、以下のブログを参照してください。
https://blogs.sap.com/2020/10/16/bp-authorization-tips-and-tricks/

特別な要件がある場合は、以下のSAPノートを参照してください。
2591329 - ヘッダーデータ (カテゴリ、グルーピング、アクティビティ、ロールなど) の組み合わせに基づいて項目ステータスを制御する新しいBADI - SAP ONE Support Launchpad

**4.4. 変換プロセスの権限** (12ページ)

変換を準備し、BP同期化を開始するには、CVIカスタマイズ、同期化コックピット、および後処理オフィス (PPO) の権限が必要になります (その他)。SAPノート 3149693 - CVI COCKPITの権限チェック (CVI\_COCKPIT) により、CVIコックピットはトランザクションコードに対する権限チェックで強化されました。

**権限オブジェクト: CVI\_CUST - プロセス割当カスタマイズおよび同期化レポート**
この権限オブジェクトを使用して、ビジネスパートナ-顧客/仕入先のオブジェクトペアに属する属性の割当カスタマイズと、対応する同期化レポートが処理できるかどうかを決定します。

**権限オブジェクト: MDS\_LOAD - 同期化 (個別および一括保守)**
この権限オブジェクトは、ユーザーが同期化コックピットおよび後処理オフィス (PPO) で同期化できるソースオブジェクトをチェックします。同期化コックピットとPPOは、一括および個別の同期化にこの権限オブジェクトを使用します。この権限オブジェクトは、マスタデータを編集できるかどうかを決定するものではありません。

**権限オブジェクト: C\_PRECHK\_M および B\_MASSMAIN**
マスタデータ整合性チェックレポートでは、権限オブジェクト C\_PRECHK\_M および B\_MASSMAIN が、編集機能を許可することで、不正な操作を防ぎます。権限が割り当てられている場合にのみ、編集を使用してマスタデータ整合性エラーを修正できます。また、これらにより、一括入力が可能になります。

* 権限オブジェクト C\_PRECHK\_M およびアクティビティ 02 が割り当てられている
* 権限オブジェクト B\_MASSMAIN、アクティビティ MASSOBJTYP、および値 XD99 (顧客) または XK99 (仕入先) が割り当てられている。

**4.5. 顧客階層** (12ページ)

顧客/仕入先階層機能はそのまま残ります。SAP S/4HANAでは簡素化されていません。

**4.6. 顧客分類** (12ページ)

顧客分類はSAP S/4HANAで利用可能です。タイム依存性の利用

---
**4.7. タイム依存性の利用** (13ページ)

以下のエンティティがタイム依存性データに対して有効化できます。

* BUT020 - タイム依存性 BP住所
* BUT0BK - タイム依存性 BP銀行データ
* BUT100 - タイム依存性 BPロール
* CRM\_BUT050 - タイム依存性: 連絡担当者関係

デフォルトの住所、銀行データ、および連絡担当者の関係は、CVIを使用して顧客/仕入先マスタと共有されます。BPが顧客/仕入先と同期化されるリードオブジェクトである場合（S/4では必須であり、ECCでは通常使用されません）、レポートBUPTDTRANSMITを定期的に実行する必要があります（例：毎日）。

このプログラムでパフォーマンスの問題が発生した場合は、ワークアラウンドとして以下のOSSノートを検討してください：2151842 - but000\_swapおよびアウトバウンドからのBUPTDTRANSMITパフォーマンスの問題。

ヘッダーレベルデータ（BUT000）に対するタイム依存性はS/4HANAではサポートされていないことに注意してください。詳細はノート2379157 - S4TWL - ビジネスパートナ BUT000/ヘッダーレベルタイム依存性を確認してください。

特定のタイム依存性機能を有効化/無効化するには、IMGノード：SAPカスタマイジング導入ガイド -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 機能の有効化スイッチを使用します。

---
**5. CVI変換シナリオ** (14ページ)

以下の図は、2つの異なるCVI変換シナリオを示しています。新規導入 (グリーンフィールド) と変換 (ブラウンフィールド) です。

**図2: CVI同期化シナリオ**

各シナリオには独自の課題がありますが、両方に一般的な考慮事項と準備が関連しています。

**スキルセット**

* 顧客/仕入先およびBPマスタデータに関する機能的およびカスタマイズ的な知識が必要です（例：BP番号範囲決定のため）。
* 特に拡張機能については技術的な知識が必要です。
* 販売および購買における基本的なビジネスプロセスの知識。

**ドキュメント**

ビジネスパートナ変換ドキュメント、簡素化リスト、および拡張クックブックを知識として活用する必要があります。また、新規導入システムの場合は、BP -> 顧客/仕入先方向のCVI設定を理解するために、ビジネスパートナ変換ドキュメントと簡素化リストが役立ちます。SAPノート2265093 - S4TWL - ビジネスパートナアプローチの最新バージョンの変換ドキュメントと簡素化リスト項目「ビジネスパートナアプローチ」を取得するために参照してください。

顧客仕入先統合に関する一般情報は、SAPヘルプで入手できます。
SAPヘルプ: 顧客仕入先統合。

その他のリンクは、このクックブック全体およびセクション10.2ドキュメントで提供されています。

**拡張機能**

CVI拡張機能には、CVIプロジェクト中にさらなる計画とリソースが必要になる場合があることに留意してください。ドキュメントとテンプレートソースコードについては、以下のSAPノートをダウンロードして参照してください。

* SAPノート 2309153 - BP\_CVI: S4HANAリリースにおけるCVI (顧客/仕入先統合) の顧客拡張機能に関するガイドラインバージョン 1.14
* SAPノート 2295823 - BP\_CVI: 顧客/仕入先項目をビジネスパートナへ転送 - テンプレートソースコード

拡張機能に関する詳細については、セクション7.3.7「顧客/仕入先拡張機能のチェックと統合」も参照してください。

**ツール**

SAPは、CVI関連のカスタマイズチェックを実行し、これらのエントリの作成/修正をサポートするためのレポートを提供します。これらは両方のシナリオで使用できます。セクション7.3.2.2「CVIカスタマイズ – チェック」の「7.3.2.2 CVIカスタマイズ – チェック」を参照してください。

変換シナリオでは、CVIコックピット（セクション7.2 CVIコックピットを参照）のような、さらに多くのツールがあります。

**SAPノート**

セクション10.1 SAPノートには、このドキュメントで言及されているすべてのSAPノート（および役立つ可能性のある追加ノート）の概要が提供されています。CVI関連のSAPノートをさらに検索するには、検索語「BP\_CVI」を使用します。

**その他のドキュメント**

セクション10.2.10.2ドキュメントには、さらに詳しいドキュメントへのリンクが提供されています。

---
**6. 新規導入 (グリーンフィールド) のCVI** (16ページ)

**6.1. 設定** (16ページ)

新しくインストールされたSAP S/4HANAシステムでCVIを設定するための前提条件として、ビジネスパートナの設定が完了している必要があります。ベストプラクティスビルディングブロックBN4およびJ61は、ビジネスパートナ機能の設定に必要な関連ステップと設定パラメータ、およびCVI設定を記述しています。プロジェクトがベストプラクティスに基づいていない場合は、これらのパラメータを参考として使用し、既存のビジネスパートナ設定が要件を満たしているか確認し、必要に応じて調整・完了してください。

**ビルディングブロック BN4 (2018): ビジネスパートナの基本設定**
このビルディングブロックは、IAM (IDおよびアクセス管理) ユーザーの一部としてBP従業員を作成するために必須の設定に焦点を当てたSAPビジネスパートナ (BP) オブジェクトの主要な設定を提供します。

ビジネスパートナに関する追加設定は、ビルディングブロックJ61などの他のビルディングブロックで提供されており、BN4はこれらのビルディングブロックの必須前提条件です。

**機能リスト:**
* BPロール
* 番号範囲
* BPグルーピングと番号範囲の割当
* 項目別項目属性 (クライアント別)
* BPロール別項目属性
* 学術称号
* 敬称
* 名の接頭辞
* 婚姻状況
* 敬称
* 名の書式設定ルール
* アドレスタイプの定義
* 識別タイプの定義

**ビルディングブロック J61 (2018): ビジネスパートナのセントラル設定**
このビルディングブロックは、BPをBP-顧客、BP-仕入先、BP-連絡担当者などとして使用することに焦点を当てたSAPビジネスパートナ (BP) オブジェクトの主要な設定を提供します。さらに、「ERP」オブジェクト「顧客」および「仕入先」の設定も提供します。

SAPビジネスパートナを使用可能にするための技術的な設定は、ビルディングブロックBN4で提供されています。BN4は、ビルディングブロックJ61がビジネスパートナ機能を使用するための必須前提条件です。

**機能リスト**
ビルディングブロックJ61は、さまざまな分野で多くの設定を提供します。以下に示す概要はすべての設定の完全なビューではなく、代表的な抜粋です。

* 「ERP」顧客/仕入先オブジェクトのパートナー決定設定
* 「ERP」顧客および仕入先アカウントグループの設定
* 「ERP」顧客および仕入先項目の値テーブルの内容
* SAPビジネスパートナ項目の値テーブルの内容
* CVI (顧客 / 仕入先インターフェース) の設定

**ビルディングブロック JA2 (2018): サンプルマスタデータビジネスパートナ**
このビルディングブロックは、「在庫からの販売」または「在庫への調達」などのさまざまなシナリオで使用されるサンプルビジネスパートナ（BP-顧客およびBP-連絡担当者、BP-仕入先）を提供します。

ほとんどのSAPベストプラクティスシナリオでは、プロセススクリプトでの使用のために、このビルディングブロックからのビジネスパートナをサンプルマスタデータとして使用します。特殊なシナリオ向けの追加のビジネスパートナは、他のサンプルマスタデータビルディングブロックで提供されます。

**6.2. 移行 / BP更新** (17ページ)

新規導入システム（グリーンフィールドアプローチ）では、ビジネスパートナデータのアップロードは、一般的な移行プロジェクトの多くのタスクの1つにすぎません。利用可能なツールとインターフェースの概要を以下に示します。

**移行コックピット**
移行コックピットは、S/4HANAのインストールに含まれるツールです。複数のオブジェクト（1909リリースで150以上が利用可能）の初期ロードを実行するために意図されています。
移行コックピットに関する情報は、以下のリンクで見つけることができます。

* help.sap.comのデータ移行のランディングページ
* ベストプラクティススコープアイテムBH5: ファイルからのS/4HANAへのデータ移行
* OSSノート 2537549 - S/4HANA移行コックピット (オンプレミス) のSAP統合ノートとFAQ

ビジネスパートナのトピックについては、以下のOSSノートも参照してください。

* 2848224 - 移行コックピット: ビジネスパートナ (顧客、サプライヤ) の統合KBA

**SAP Rapid Data Migration for S/4HANA**
オンプレミスS/4HANA用のSAP Rapid Data Migrationに関する詳細情報については、以下のリンクを使用してください。

* SAPベストプラクティスエクスプローラ
* SAPノート 2239701 - SAP Rapid Data Migration for SAP S/4HANA、オンプレミス版

**IDOC**
IDOC DEBMASおよびCREMASはSAP S/4HANA OP 1511で利用可能です。DEBMASのALEインバウンドエラーについてはSAPノート 2312529を参照してください。S/4HANA 1610以降については、SAPノート 2479954 - SAP S/4HANAビジネスパートナでのDEBMAS/CREMAS IDocを参照してください。

セクション9.1.2 IDocs DEBMAS/CREMAS in S/4HANAも確認してください。

**RFCおよびSOAサービス**
ビジネスパートナマスタデータを登録または更新する外部アプリケーションは、SAPノート 2417298 - 顧客およびサプライヤロールを持つビジネスパートナの作成に記載されている利用可能なAPI (CL\_MD\_BP\_MAINTAIN)、IDOC、またはBP SOAサービスを使用する必要があります。

以下のノートも考慮してください: 2506041 - S4TWL - API RFC\_CVI\_EI\_INBOUND\_MAIN は、S/4 HANA OP 1709 FPS2リリースおよびCloud Edition 1805以降ではサポートされていません。

---
**7. CVI同期化 システム変換** (18ページ)

**7.1. 概要とフェーズアプローチ** (18ページ)

システムで正常な変換を確実に行うには、すべてのクライアントのすべての顧客、仕入先、連絡担当者をビジネスパートナに変換する必要があります。これは、既に使用されているビジネスパートナにも当てはまります。顧客/仕入先変換プロセスがトリガーされると、システムは必要なすべてのフィールドをビジネスパートナに投稿します。BPは、SAP S/4HANAでビジネスパートナ、顧客、仕入先（以前は仕入先として知られていた）のマスタデータを保守するためのリードオブジェクトおよび単一のエントリーポイントです。

変換とビジネスパートナの後処理アクティビティを含む、完全なビジネスパートナデータ転送は通常、以下の図に示されている4つのフェーズで発生します。

**図3: CVI同期化プロセス**

準備と同期化の変換ステップは、本ドキュメントで詳細に説明されており、エラーが発生した場合には定義された順序で実行し、繰り返す必要があります。

**BP/CVI同期化フェーズの実施時期に関する推奨事項:**
BP/CVI同期化フェーズをSAP S/4HANA変換フェーズに含めないでください。数週間または数ヶ月前に実行してください。BP/CVI同期化は、SAP S/4HANA変換フェーズのクリティカルパスの一部であってはなりません。これにより、SAP S/4HANA変換フェーズでの直前の驚きを避けることができます。

変換プロセスは、SAP S/4HANA変換ガイドに従ってトリガーする必要があります。後処理ステップのアクティビティも、記載されたドキュメントで説明されています。

**7.2. CVIコックピット** (18ページ)

この段階的なアプローチは、「CVIコックピット」と呼ばれるものでサポートされています。このCVIコックピットは、CVIアクティビティを実行するための順次的かつ論理的なプロセスフローでユーザーをガイドするために提供されており、SAP S/4HANA変換を準備するためのCVIプロジェクトのフェーズを反映しています。

**図4: CVIコックピットによってサポートされるフェーズ**

**図5: トランザクション CVI\_COCKPIT (ECC 6.0)**

CVIコックピットは、フェーズごとにすべてのアクティビティを収集します。

* **Read Me**
    * これはCVIコックピットの最初のステージです。ユーザーは、CVI移行プロセスに関連するさまざまな前提条件OSSノートとヘルプドキュメントに関する情報を入手できます。このフェーズには以下が含まれます。
        * ノートチェッカー (SAPノート 2823648 - ビジネスパートナCVI同期化の前提条件SAPノートに関する情報へのリンク、セクション7.3.1 TCIノート CVIのTCIノートも確認してください)
        * CVIライブラリ (SAPノート 2823632 - ビジネスパートナアプローチとCVIプロセスに関するコンサルティングノートへの重要な情報リンク)

* **準備**
    * これはCVIコックピットの2番目のステージです。このステージのタスクは、ビジネスパートナデータモデルへのCVI同期化に必要な顧客および仕入先マスタデータにおける必要なビジネスチェック（機能的およびカスタマイズ的）を実行します。このステージでは、テストまたはサンドボックスシステムでユーザーが抑制することを意図するチェックをカスタマイズするプロビジョンも提供します。このフェーズには主に以下が含まれます。
        * マスタデータ整合性チェック (このブログ投稿およびセクション7.3.2.1マスタデータクレンジング: マスタデータ整合性チェックで詳細情報)
        * 自動化されたカスタマイズ (このブログ投稿およびセクション7.3.2.2 CVIカスタマイズ – チェックで詳細情報)

* **CVI\_LOAD**
    * これはCVIコックピットの3番目のステージです。プリロードアクティビティ、リアルロードアクティビティ、およびポストロードアクティビティの3つのセクションに分けられた合計8つのタスクがあります。これらのタスクは、すべての顧客および仕入先レコードに対してBPマスタデータを作成する主要な同期化アクティビティを実行します。このフェーズには主に以下が含まれます。
        * プリロードアクティビティ
        * メインCVIロードツール (SAPトランザクション MDS\_LOAD\_COCKPIT) の起動を伴うリアルロードアクティビティ。
            * このLOADブログ投稿および
            * このエラー処理ブログ投稿)
        * ポストロードアクティビティ
    * セクション7.4同期化で詳細情報。

* **アップグレード準備**
    * これはCVIコックピットの4番目で現在のところ最後のステージです。S/4HANA変換プロジェクトが本番変換に近づくときに使用されます。これらのチェックは、変換前のチェックが実行される前に、すべてのエラーを解決できるように、事前に実行する必要があります。このステージは、作成されたBPの整合性をチェックするのにも役立ちます。このフェーズには主に以下が含まれます。
        * 後処理
        * アップグレード事前チェック

各アクティビティのステータスロギングをサポートします。各フェーズのアクティビティがすべて完了すると、次のフェーズを開始できます。すべての顧客、仕入先、およびそれらの連絡担当者がビジネスパートナにリンクされると、全体ステータスは自動的に「緑」に設定されます。

単一ステージの実行中に問題が発生した場合は、以下のノートを参照してください: «3037330 - CVI\_COCKPITステージがグレーアウト»。

CVIコックピットは、SAPノート 2832085 - ビジネスパートナへの新しいセントラル顧客仕入先統合 (CVI) コックピットを介して利用可能です。これはECC 6.0 EHP8 SP13で導入され、ECC 6.0 EHP0以降にバックポートされました。

CVIコックピットに関する以下のSAPノートにも注意してください。

* 2850537 - CVIコックピットのDDIC変更
* 2861108 - CVI\_COCKPIT: CVI\_LOADテーブルエントリとドキュメント
* 2812309 - CVI\_COCKPIT: CVI\_LOADステージ
* 2891522 - CVI\_COCKPIT: 新しいカスタマイズチェックレポートへのナビゲーション
* 3022635 - BP/CVIアップデートのTCI 2.0ノートからCVIコックピットへ

CVIコックピットを実装するとき、またはCVIコックピットの機能拡張を探すときに記載されているバグに遭遇した場合は、以下の追加のSAPノートを考慮する必要があります。

* 2898609 - CVIコックピットで「リアルタイムステータス」ボタンをクリックした後のタイムアウトまたはダンプ。
* 3000296 - CVI\_COCKPITの「全体ステータス」が赤色のまま。
* 3015262 - CVI\_COCKPITでプッシュボタン「次へ」が表示されない。
* 3017965 - 顧客仕入先統合コックピット (CVI\_COCKPIT) の機能強化

---
**(続き: 21ページ)**

* 3147770 - SP18 CVI-コックピットのDDIC: クロスクライアントステータス
* 3131243 - 顧客/仕入先統合コックピット(CVI\_COCKPIT)がクロスライン同期化ステータス情報で強化されました。
* 3074379 - 顧客仕入先統合 (CVI) コックピットからの小売サイトの除外
* 3112307 - 顧客仕入先統合 (CVI) コックピットからの小売サイトの除外 - ドキュメント
* 3149693 - CVI COCKPITの権限チェック(CVI\_COCKPIT)
* 3139888 - CVIコックピットの機能強化 - 権限プロファイル
* 3082229 - CVIコックピット - いつでも実行可能なタスク
* 2858507 - ブロック保守トランザクションまたはリリース保守トランザクションをクリックして処理中にCVI\_COCKPIT - タスクでエラーが発生しました。

CVIコックピットの実装に適用可能な前提条件およびオプションのSAPノートの最新リストについては、SAPノートを定期的に確認してください。

CVIコックピットはマスタデータ整合性チェック (セクション7.3.2.1) およびCVIカスタマイズチェックレポート (セクション7.3.2.2) にリンクされているため、クックブックおよび言及されているSAPノートの参照セクションに注意してください。

さらに、SAPはTCI (トランスポートベース補正指示) ノートの使用を導入し、関連するCVI関連SAPノートの実装をよりシンプルかつ迅速なプロセスにしました。TCIノートの詳細は次のセクション (セクション7.3.1) にあります。以下の決定フロー図は、ERPバージョンとサポートパッケージレベルに基づいて、TCIノートを実装する場合としない場合でCVIコックピットをERPシステムに実装する方法と、必要になる可能性のある追加ステップを評価するためのガイドです。

**図6: SAPノートに関するCVIコックピットの準備**

このブログはCVIコックピットの概要を説明しています。
新しいCVIコックピット – シームレスなBP同期化によるSAP S/4HANAへの移行の有効化

このプレゼンテーションも概要を説明しています。
S/4HANA MOVE – BP/CVI - CVIコックピット

---
**7.3. 準備** (23ページ)

**7.3.1. CVIのTCIノート** (23ページ)

多数のCVI関連SAPノートの実装を容易にするために、SAPはTCIノート (トランスポートベース補正指示ノート) にCVI関連の修正をまとめています。

* 2951811 – ECC (SAP\_APPL) における顧客仕入先統合 (CVI) のためのトランスポートベース補正指示 (TCI)

このCVI TCI SAPノートの実装は、SAP S/4HANA変換プロジェクトの準備として、CVIプロジェクトの初期段階で推奨されます。

トランスポートベース補正指示 (TCI) は、個々のSAPノートを修正指示 (CI) で実装する場合と比較して、以下の利点があります。

* 統合されたCIの迅速な消費
* 自動インストールプロセスによる実装のための開発スキルが不要
* DDIC、テーブル内容、MIMEなど、トランスポート対応のすべてのSAP ABAPオブジェクトのサポート
* SPインポートおよびアップグレード中のSAP標準オブジェクトの調整アクティビティなし
* 明確な機能的焦点と副作用の少なさ
* TCIの非実装またはロールバック (詳細については、SAPノート 2408383 - TCI - SAPノートトランスポートベース補正指示 (TCI) ロールバックを有効にするシステムを参照してください)。

TCIノートの技術、有効性、および適用準備アクティビティに関する基本情報については、このSAPノートを確認してください。
* 2187425 - SAPノートトランスポートベース補正指示 (TCI) に関する情報

SAP Netweaverリリースに関連する条件を特に確認してください。

CVIの最新のTCIノートは次のとおりです。
* 2951811 – ECC (SAP\_APPL) における顧客仕入先統合 (CVI) のためのトランスポートベース補正指示 (TCI)

注: CVIの以前のTCIノート – SAPノート 2820678 - CVI SAP\_APPL TCIが最初にリリースされましたが、これは現在廃止されたと見なされます。この古いノートは使用すべきではありません。そのため、TCI 2.0」が2951811 – ECC (SAP\_APPL) における顧客仕入先統合 (CVI) のためのトランスポートベース補正指示 (TCI) に関連して記載されているのを確認できます。

お使いのERPバージョンが、TCI CVI SAPノート 2951811 – ECC (SAP\_APPL) における顧客仕入先統合 (CVI) のためのトランスポートベース補正指示 (TCI) の最小サポートパックバージョンよりも低い場合、推奨される2つのオプションのいずれかを検討してください。

1. TCI CVI SAPノートの最小サポートパックバージョン以上にサポートパックアップグレードを実行する。
2. または、TCI CVI SAPノートに含まれるSAPノートのリストから、お使いのERPバージョンとサポートパッケージレベルに適用可能なものを手動で適用する。

TCI CVI SAPノート 2951811 – ECC (SAP\_APPL) における顧客仕入先統合 (CVI) のためのトランスポートベース補正指示 (TCI) に含まれるSAPノートの特定のリストについては、SAP KBAノート 3147029 - CVIコックピットおよびCVIのTCIに関するガイド付き回答のTCI 2.0入力ノート\_リリース\_ワイズ.xlsx添付ファイルを参照してください。このSAP KBAノートでも役立つガイド付き回答が提供されています。

TCIノートは、約600から1000以上のSAPノートを良好にカバーしていますが（お使いのERPサポートパックレベルによって異なります）、CVIのSAPノートカバレッジを100%保証するものではありません。CVI機能領域の新しいSAPノートは、CVI TCI SAPノートにすぐに組み込まれることなく、いつでもリリースされる可能性があります。

CVI TCI SAPノートに追加のSAPノートがあることにも注意してください。

---
**(続き: 24ページ)**

* 2850361 - 顧客/仕入先統合のTCIの言語依存オブジェクトのテキスト (DE/EN) の配信 (SAPノート 2818292)

**7.3.2. S/4HANA事前チェックとチェックレポート** (24ページ)

SAPは、システムが変換プロセスと互換性があることを保証するために必要なステップを特定する事前チェックを提供することにより、変換プロジェクトをサポートします。

SAP S/4HANA移行チェックは、必須チェックを対象としており、アップグレードツールによってその使用が強制されます。アップグレードツールは、すべてのチェックが正常に完了した場合にのみ移行が実行されるように、SAP S/4HANA移行チェックが実行されることを保証します。

また、設定チェックを実行し、不足しているカスタマイズエントリを見つけ、これらのエントリの作成/修正をサポートするためのレポートもあります。さらに、初期ロード後の事後チェックを実行するためにもレポートを使用できます。これらはCVIコックピットに含まれています。

チェックレポートはCVIコックピットから起動できます。CVIコックピットの概要については、セクション7.17.1「概要とフェーズアプローチ」およびSAPノートを参照してください。

以前使用されていたレポート、PRECHECK\_UPGRADATION\_REPORT、CVI\_UPGRADE\_CHECK\_RESOLVE、CVI\_FS\_CHECK\_CUSTOMIZING、またはZCUSTOMER\_LINK\_CHECK\_REPORTなどは、今後使用すべきではなく、CVIコックピットにリンクされている以下のチェックレポートを使用すべきです。

**7.3.2.1. マスタデータクレンジング: マスタデータ整合性チェック** (24ページ)

顧客および仕入先マスタをBPと同期化する際、特定の項目の内容が現在の有効なルールに対してチェックされます。一部の項目（例：税番号）は、ネイティブのBP項目（例：税コード）にマッピングされます。古く不適切に入力された値は、同期化実行中にエラーを引き起こします。最も一般的なエラーを事前にチェックするために、SAPはトランザクションCVI\_PRECHK (レポート CVI\_MIGRATION\_PRECHK) を提供します。

備考: このレポートは、ビジネスパートナ変換に関する最も重要なマスタデータ機能チェックのみを対象としています。チェックのリストは、実際の変換中にMDS\_LOAD\_COCKPITで実行されるチェックほど包括的ではありません。

このチェックは、BP/CVIカスタマイズを行わなくても実行できるという利点があります。

このレポートは、データ品質をチェックし、データクレンジングを追跡するために使用できます。また、エラーリストで直接、またはマスタデータ保守トランザクションXD02/XK02への直接ジャンプを介して、誤ったまたは不足している項目内容を変更することも可能です。

**SAPデータ品質管理 (DQM) を使用した住所クレンジング**
住所クレンジングは、SAPデータ品質管理 (DQM) の助けを借りて可能です。DQMの詳細については、SAPデータ品質管理を参照してください。

マスタデータ整合性チェックレポートは、設定された郵便住所ディレクトリに基づく住所検証のために、DQM 4.0 SP10とも互換性があります。ただし、マイクロサービス機能はDQM 4.1バージョンでのみサポートされています。

詳細については、以下を確認してください:
https://help.sap.com/viewer/39615c43587c4405aba2de8ebf33cd66/6.18.15/en-US/cab77276399f4088999c0c8269f7333b.html

指定された選択基準を使用して、エラーリストから即時チェック再実行をトリガーすることが可能です。

**選択画面:** (25ページ)

**図7: マスタデータ整合性チェックの選択画面**

**結果:** (25ページ)

**図8: マスタデータ整合性チェックの結果リスト**

レポートが見つからない場合（ECC 6サポートパッケージスタックが低い場合）、これらのSAPノートを確認してください::

メインノート: 2743494 Prevalidation: Master Data Consistency Check
* 2942339 Prevalidation: Master Data Consistency Check V2 - DDIC作成
* 2891951 Prevalidation: Master Data Consistency Check Reportへの機能強化
* 2949093 Prevalidation: Master Data Consistency Check Report – 権限オブジェクトへの機能強化
* 2949094 Prevalidation: Master Data Consistency Check Report - 権限オブジェクト: DDIC

---
**(続き: 26ページ)**

* 2958796 Prevalidation: Master Data Consistency Check Reportから仕入先データが保存されない
* 2996762 Master Data Consistency Check (Tcode CVI\_PRECHK) レポートで業種チェックが実行されない
* 2968936 Master Data Consistency Check Report - データ品質管理 (DQM) に基づく住所クレンジング: DDIC作成
* 2957924 Master Data Consistency Check Report - データ品質管理 (DQM) に基づく住所クレンジング

ラン ID を作成できるように、オブジェクト 'CVI\_PRECHK' の番号範囲 '01' に、トランザクション SNUM を使用して番号範囲を追加する必要があります (SAPノート 2963656 - トランザクション CVI\_PRECHK が機能しない を参照)。

SAPノート 2265093 - S4TWL - ビジネスパートナアプローチ2265093 - S4TWL - ビジネスパートナアプローチに添付されているドキュメント「BP\_Conversion\_Document.pdf」には、セクション 3 および 6.2 のマスタデータ整合性チェックレポートに関する情報が含まれています。

役立つブログ記事もあります。
ビジネスパートナ CVI – SAP S/4HANA MOVE をサポートするマスタデータ整合性チェック

**7.3.2.2. CVIカスタマイズ – チェック** (26ページ)

トランザクション BP\_CVI\_IMG\_CHK 「CVIカスタマイズ – チェックレポート」 (ABAPレポート CVI\_CUSTOMIZING\_RESOLVE) は、顧客/仕入先からBPへ、およびBPから顧客/仕入先への両方向の必要なBPおよびCVIカスタマイズの設定に役立ちます。これは、CVIコックピットの「準備」タブの「自動化されたカスタマイズ」として、および「アップグレード準備」タブの「アップグレード前カスタマイズチェック」として統合されています。

**図9: CVIカスタマイズチェックの例のスナップショット**

これは、マスタデータ (該当する場合) で使用されるカスタマイズのエラーメッセージを示し、各チェックについて解決のための対応するカスタマイズ設定へのリンク、および一部の場合はインラインカスタマイズを提供します。

CVI/BPカスタマイズステップは本クックブックで詳細に説明されています。このチェックレポートは、追加のチェックと直接カスタマイズ保守へのアクセスでサポートします。

役立つブログ記事もあります。
https://blogs.sap.com/2020/03/31/cvi-customizing-check-report/

システムでレポートが見つからない場合は、このノートを確認してください。
2891455 - 新しいカスタマイズチェックレポート SAP S/4HANAマスタデータ移行 (BP<->CVI) 用

**7.3.2.3. CVIの完全性 – チェック** (27ページ)

トランザクション CVI\_COMPL\_CHK (ABAPレポート CVI\_COMPLETENESS\_CHECK) は、まだビジネスパートナに変換されていない顧客、仕入先、連絡担当者のリストを提供します。欠落している情報を表示したい範囲を選択できます。後で実行するために、MS Excelファイルとしてリストをダウンロードし、MDS\_LOAD\_COCKPITに直接アップロードすることが可能です。これらは、デフォルトの場所 C:\Temp\CVI に次の名前のファイルにエクスポートされます。

* unsync\_customers.xls
* unsync\_customers\_contacts.xls
* unsync\_suppliers\_contacts.xls
* unsync\_suppliers.xls

**図10: CVI完全性チェックの例のスナップショット**

**7.3.3. 削除フラグ付きの顧客/仕入先データのアーカイブ** (27ページ)

制限なしにすべての顧客/仕入先データを変換する前に、SAPは削除フラグの付いた顧客/仕入先をアーカイブすることを推奨します。また、削除フラグの付いた顧客/仕入先でBPに変換されていないものもBPに変換する必要があります。

アーカイブはオプションのステップです。プロセスによって付加価値がない場合はスキップできます。アーカイブは、CVI変換を簡素化する可能性があります。例えば、IMGから顧客または仕入先オブジェクト設定が削除された場合（例：廃止された番号範囲）。アーカイブを計画している場合は、顧客/仕入先からBPへの同期化を有効にする前に、削除フラグをマークすることが推奨されます。顧客/仕入先からBPへの同期化時に削除フラグをマークすると、アーカイブフラグが設定されたビジネスパートナに顧客/仕入先が変換されます。削除フラグの付いた顧客および仕入先はビジネスパートナに変換できます。

**顧客データのアーカイブ**
SAPヘルプポータルにアクセスするためのリンクを使用してください: 顧客マスタデータのアーカイブ (FI-AR, SD)
パス:
SAPヘルプポータル (help.sap.com) から、SAP ERPを検索し、ここからSAPライブラリへ移動します。
SAPライブラリでは、「SAP ERP クロスアプリケーション機能」へ進み、次に「アプリケーション内のシナリオ」へ、次に「データアーカイブ (CA-ARC)」へ、そして「財務会計 (FI)」へ進みます。ここから、以下のパスに進みます。

---
**(続き: 28ページ)**

財務会計 (FI) > 財務会計データのアーカイブ (FI) > 顧客マスタデータのアーカイブ (FI AR, SD)

**仕入先データのアーカイブ**
SAPヘルプポータルにアクセスするためのリンクを使用してください: 仕入先マスタデータのアーカイブ (FI-AP)
パス:
SAPヘルプポータル (help.sap.com) から、SAP ERPを検索し、ここからSAPライブラリへ移動します。
SAPライブラリでは、「SAP ERP クロスアプリケーション機能」へ進み、次に「アプリケーション内のシナリオ」へ、次に「データアーカイブ (CA-ARC)」へ、そして「財務会計 (FI)」へ進みます。ここから、以下のパスに進みます。

財務会計 (FI) > 財務会計データのアーカイブ (FI) > 仕入先マスタデータのアーカイブ (FI-AP)

**顧客/仕入先統合におけるアーカイブ**
CVIが有効な環境でのアーカイブの影響は、SAPヘルプに記載されています。関連セクションにアクセスするには、リンクを使用してください: 顧客/仕入先統合におけるアーカイブ
パス:
SAPヘルプポータル (help.sap.com) から、SAP ERPを検索し、ここからSAPライブラリへ移動します。
SAPライブラリでは、「SAP ERP クロスアプリケーション機能」へ進み、「クロスアプリケーションコンポーネント」ノードを展開し、「マスタデータ同期化」をクリックします。ここから、以下のパスに進みます。

顧客/仕入先統合 > 顧客/仕入先統合におけるアーカイブ

**7.3.4. SAP CRMとの依存関係チェック** (28ページ)

SAP CRMを使用しており、SAP ERP 6.0からSAP S/4HANAへの変換を計画している場合、CVIを有効化して一括同期化を開始する前に、SAPノート 2285062 - S4TWL: SAPCRMとS/4 HANA間のビジネスパートナデータ交換、オンプレミス版に記載されている事前変換アクションを実行する必要があります。関連ノート（例：CRMとのGUID交換）も考慮してください。

詳細については、セクション9.4 CRMを参照してください。

**7.3.5. 連絡担当者マッピング** (28ページ)

連絡担当者を持つ仕入先を使用しており、SAP ERP 6.0 EHP 5 (SAP\_APPL 605) より低いリリースから変換を計画している場合、SAPノート 2711712 - ECCシステムリリースのさまざまなリリースにおける連絡担当者のBPへのマッピング方法を確認し、以下のSAPノートを考慮する必要があります。

2383051 - ビジネスパートナへの仕入先連絡担当者のマッピングの開発
2421613 - スイッチ - 仕入先連絡担当者のビジネスパートナへのマッピング
2638156 - 連絡担当者の住所変更が関連するBP個人に正しく更新されない

これにより、連絡担当者からビジネスパートナへの適切なマッピングが保証されます。これは、割り当てられた連絡先を持たないシステムには関連ありません。連絡先を持つ仕入先が存在するかどうかは、テーブルKNVKでLIFNRに初期値以外があるかどうか (KNVK-LIFNR <> ‘’）で確認できます。

**7.3.6. ビジネス機能の有効化** (28ページ)

変換のために、ビジネス機能 CA\_BP\_SOA が有効になっている必要があります。前提条件として、ビジネス機能 CA\_SUPPLIER\_SOA が最初に有効になっている必要があります。

CA\_BP\_SOA には、仕入先連絡担当者データをビジネスパートナ連絡担当者データと同期化するために有効にする必要があるスイッチ「VENDOR\_SFWS\_SC1」および「VENDOR\_SFWS\_SC2」が含まれています。

ビジネス機能 CA\_BP\_SOA がシステムにまだ存在しない場合、顧客名前空間にスイッチ VENDOR\_SFWS\_SC1 および VENDOR\_SFWS\_SC2 を持つ新しいビジネス機能を登録する必要があります。新しい顧客固有のビジネス機能は、エンタープライズビジネス機能 (G) タイプである必要があります。SAPノート 1454441 - 仕入先の連絡担当者の開発を参照してください。

---
**(続き: 29ページ)**

トランザクションSFW5でこれをチェックできます。変換の場合、ビジネス機能の有効化は、WHERE条件LIFNR <> SPACEでテーブルKNVKの選択につながります。

トランザクションSFW5でビジネス機能を有効化します。計画ステータスをTrueに設定し、変更を有効化します。

有効化後、両方のスイッチの「グローバルステータス」が「オン」になっていることを確認してください。

**図11: ビジネス機能の有効化**

**7.3.7. 顧客/仕入先拡張機能のチェックと統合** (29ページ)

トランザクションBPで顧客固有の顧客/仕入先項目を含める必要がある場合、これらの追加項目をビジネスパートナおよびCVIに統合する必要があります。

SAPノート 2309153 は、ビジネスパートナでの追加の顧客/仕入先項目を統合し、CVI同期化を使用してそれらを顧客/仕入先で更新するために、顧客/仕入先統合を拡張する方法を説明するドキュメントを提供します。

SAPノート 2309153のガイドは、SAPノート 2295823で提供されているサンプルクラスを参照しています。エンハンスメントパッケージ6以降のSAP ERP Suiteシステムでこれらのクラスを作成および使用することも可能です。

上記のSAPノートにアクセスするためのリンクを使用してください。

* SAPノート 2309153 - BP\_CVI: S4HANAリリースにおけるCVI (顧客/仕入先統合) の顧客拡張機能に関するガイドラインバージョン 1.14
* SAPノート 2295823 - BP\_CVI: 顧客/仕入先項目をビジネスパートナへ転送 - テンプレートソースコード

ビジネスパートナおよびCVIに顧客拡張機能を含めるための一般的なメカニズムは次のとおりです。

BDT (ビジネスデータツールセット) は、トランザクションBPの既存の画面を追加の必須項目、テーブル、またはチェックボックスで拡張するために使用されます。XO (拡張オブジェクト) フレームワークは、データを検証し、メモリに保存するために使用されます。CVI同期化内のBAdI実装は、XOメモリからデータを収集し、追加データが複雑なインターフェース構造の一部でない場合にデータベースに保存します。

SAPノート 2309153で提供されるドキュメントには、ビジネスパートナおよびCVIに顧客拡張機能を含めるための技術要件とプロセスを説明する追加の参照が含まれています。これらのソースには、以下のリンクを使用してもアクセスできます。

| トピック | 参照先 |
|---|---|
| BDT (ビジネスデータツールセット) | BDT開発者マニュアル https://help.sap.com/viewer/8e1936ace52649b28ef5dc48cafe30c6/750%20SP16/en-US/44bd8d5377a0ec23e10000000a174cb4.html |
| XOフレームワーク (拡張オブジェクト) | SAPノート 1623809 - XOフレームワークの開発者ドキュメント |
| CVI (顧客/仕入先統合) | SAPノート 956054 - BP\_CVI: SAP ERP 6.0以降の顧客/仕入先統合 |
| | ヘルプポータル |

---
**(続き: 30ページ)**

| トピック | 参照先 |
|---|---|
| Easy Enhancement Workbench (EEW) | ヘルプポータル https://help.sap.com/viewer/2eb99edb9d99472d9afa587acddd7a7c/750%20SP16/en-US/12b98d5377a0ec23e10000000a174cb4.html |
| ビジネスパートナの拡張性 | ヘルプポータル https://help.sap.com/viewer/725b6ad626684262b8d74a55fc8ed089/750%20SP16/en-US/a6af8d5377a0ec23e10000000a174cb4.html |

**7.3.8. CVI/BPカスタマイズのチェックと調整** (30ページ)

CVIコックピット (セクション7.2 CVIコックピット) およびリンクされたCVIカスタマイズチェック (セクション7.3.2.2 CVIカスタマイズ – チェック) を、CVI/BPカスタマイズのガイダンスサポートとして、役立つチェックとともに考慮してください。

備考
以下の章のスクリーンショットの項目値は、参照用です。

**7.3.8.1. マスタデータ同期化** (30ページ)

**7.3.8.1.1. データ配賦のためのファンクションモジュール (CRM)** (30ページ)
CVI/BP - CRM統合関連のトピックについては、セクション9.49.4 CRMを参照してください。

**7.3.8.1.2. 後処理オーダーの作成の有効化** (30ページ)
標準システムでは、すべてのビジネスプロセスに対して後処理オーダーの作成が無効になっています。このため、後処理オフィスを使用する前に、このIMGアクティビティを実行する必要があります。

IMG -> クロスアプリケーションコンポーネント -> 一般アプリケーション機能 -> 後処理オフィス -> ビジネスプロセス -> 後処理オーダーの作成の有効化

コンポーネント AP-MD の後処理オーダー作成を有効にし、ビジネスプロセス CVI\_01 (顧客 > ビジネスパートナ) および CVI\_02 (仕入先 > ビジネスパートナ) を有効にします。エントリを有効にするためにチェックボックスをマークします。

ビジネスプロセス CVI\_03 (ビジネスパートナ > 顧客) および CVI\_04 (ビジネスパートナ > 仕入先) のエントリは、チェックボックスがマークされていなくても、すでに挿入できます。

データが正常に同期化された後、CVI\_03 および CVI\_04 を有効にする必要があります。セクション7.6変換後アクティビティを参照してください。

**図12: 後処理オーダーの作成の有効化**

---
**(続き: 31ページ)**

**7.3.8.1.3. プラットフォームオブジェクトのためのPPOリクエストの有効化** (31ページ)
このIMGアクティビティを使用して、同期化エラーが発生した場合に、どのプラットフォームオブジェクトに対して後処理リクエスト (PPOリクエスト) が書き込まれるかを定義します。この定義は方向固有ではないため、プラットフォームオブジェクトが同期化でソースまたはターゲットオブジェクトとして使用される場合は、常にリクエストが書き込まれるべきです。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 同期化制御 -> 同期化制御 -> ダイアログでのプラットフォームオブジェクトの後処理リクエストの有効化

同期化オブジェクト BP (ビジネスパートナ) の新しいエントリを作成し、「PPOアクティブ」チェックボックスをマークします。

**図13: ダイアログでのPPOの有効化のためのプラットフォームオブジェクト**

備考
以下の情報を使用して、SAPが提供するマスタデータ同期化のための同期化オブジェクトを表示できます。
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 同期化制御 -> 同期化制御 -> 同期化オブジェクト

ビジネスパートナ、顧客、および仕入先について、以下のエントリが存在する必要があります。

| 同期化オブジェクト | 同期モード | 抽出クラス | 説明 | プラットフォーム | ブロックサイズ |
|---|---|---|---|---|---|
| BP | 同期比較および一括データロード用 | CVI\_BP\_EXTRACTOR | ビジネスパートナ | X | 50 |
| CUSTOMER | 同期比較および一括データロード用 | CMD\_EI\_API\_EXTRACT | 顧客 | | 50 |
| VENDOR | 同期比較および一括データロード用 | VMD\_EI\_API\_EXTRACT | 仕入先 | | 50 |

**7.3.8.1.4. 同期化オプションの有効化** (31ページ)
このIMGアクティビティを使用して、顧客/仕入先とビジネスパートナ間でデータが同期化される方向を設定できます。データは両方向で同期化できます。これは、ビジネスパートナから顧客/仕入先へ、および顧客/仕入先からビジネスパートナへデータを更新できることを意味します。

---
**(続き: 32ページ)**

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 同期化制御 -> 同期化制御 -> 同期化オプションの有効化

以下の新しいエントリを挿入します。

* ソースオブジェクト 顧客 およびターゲットオブジェクト BP
* ソースオブジェクト 仕入先 およびターゲットオブジェクト BP

アクティベーションインジケータチェックボックスをマークして、両方のエントリを有効にします。

以下のエントリをすでに挿入できます。

* ソースオブジェクト BP およびターゲットオブジェクト 顧客
* ソースオブジェクト BP およびターゲットオブジェクト 仕入先

アクティベーションチェックボックスをマークせずに挿入できます。

データの同期化が成功した後、これらのエントリを有効にする必要があります。セクション7.6変換後アクティビティを参照してください。

**図14: 同期化前の「アクティブな同期化オプション」の設定**

備考
同期化オプションは、ソース同期化オブジェクトとターゲット同期化オブジェクトの組み合わせです。同期化オプションはトランザクションSM30、ビューMDSV\_CTRL\_OPTで保守できます。以下のエントリが存在する必要があります（事前定義されています）。

| ソースオブジェクト | ターゲットオブジェクト | 戦略実装 | キュー名 |
|---|---|---|---|
| BP | CUSTOMER | CVI\_STRATEGY\_BP\_CUSTOMER | MDS\_BUPA\_CUST |
| BP | VENDOR | CVI\_STRATEGY\_BP\_VENDOR | MDS\_BUPA\_VEND |
| CUSTOMER | BP | CVI\_STRATEGY\_CUSTOMER\_BP | MDS\_CUST\_BUPA |
| VENDOR | BP | CVI\_STRATEGY\_VENDOR\_BP | MDS\_VEND\_BUPA |

**7.3.8.2. 番号範囲とグルーピング** (32ページ)

**7.3.8.2.1. 概要** (32ページ)
顧客/仕入先統合の中核タスクの1つは、ビジネスパートナの番号範囲の定義と割当です。

SAPは、ビジネスパートナ（BP）に変換する際に、顧客/仕入先の番号を同じにすることを推奨します。このアプローチを決定する際には、以下の注意事項を考慮してください。

顧客と仕入先で同じ番号を使用する場合、いずれか一方に異なるBP番号を付ける必要があります。さらに、ビジネスパートナに番号を割り当てる際に、顧客/仕入先とビジネスパートナに同じ番号を割り当てる必要があります。同じ番号を割り当てると、アプリケーションレベルでの混乱（トランザクション内でビジネスパートナに対して2つの異なる番号が表示される場合）を回避できます。これはすべての場合に可能なわけではありません。例えば、変換前にSAPビジネスパートナがすでにシステムに存在する場合や、ECCの顧客と仕入先の番号範囲が重複する場合などです。

---
**(続き: 33ページ)**

考慮すべき以下の原則があります。

* 顧客と仕入先が現在使用している番号範囲が互いに排他的である場合、ビジネスパートナの番号範囲は顧客/仕入先番号範囲のミラーイメージとして定義されるべきです。
* 顧客と仕入先が現在使用している番号範囲が互いに排他的でない場合、ビジネスパートナの番号範囲は、顧客/仕入先からほとんどの番号を再利用できるように定義されるべきです。
* 顧客/仕入先の数値をビジネスパートナに引き継ぐ場合
    * 顧客/仕入先の数値をビジネスパートナに引き継ぐことを許可するために、同期化フェーズ中にビジネスパートナ番号範囲の数値区間を外部に設定する必要があります（ECCで）。
    * 正常なデータ同期化の後、ビジネスパートナがS/4HANAでリードオブジェクトになる前に、ビジネスパートナの数値区間を内部に戻す必要があります。さらに、顧客/仕入先数値番号範囲を外部に設定して、顧客/仕入先とビジネスパートナで同じ番号を許可する必要があります。

選択された顧客/仕入先マスタレコードのアカウントグループは、作成されるビジネスパートナの番号割当を決定します。

顧客/仕入先とビジネスパートナを作成する場合、選択された顧客/仕入先のアカウントグループとビジネスパートナの番号割当に関連する組み合わせと必要なアクティビティは、以下のようになります。

| 選択されたアカウントグループ | アクティビティ |
|---|---|
| 内部番号割当のアカウントグループを選択し、内部番号割当を持つビジネスパートナグルーピングが割り当てられている場合。 | システムは自動的に顧客/仕入先番号とビジネスパートナ番号を生成します。 |
| 内部番号割当のアカウントグループを選択し、外部番号割当を持つビジネスパートナグルーピングが割り当てられている場合。番号の等価性が有効化されている場合。 | システムは、ビジネスパートナ処理のために、自動的に選択された顧客/仕入先番号をビジネスパートナ番号として指定します。 |
| 外部番号割当のアカウントグループを選択し、内部番号割当を持つビジネスパートナグルーピングが割り当てられている場合。 | 顧客/仕入先処理に使用する顧客/仕入先番号をマニュアルで入力します。システムは自動的に内部ビジネスパートナ番号を生成します。 |
| 外部番号割当のアカウントグループを選択し、外部番号割当を持つビジネスパートナグルーピングが割り当てられている場合。番号の等価性が有効化されている場合。 | 顧客/仕入先処理に使用する顧客/仕入先番号をマニュアルで入力します。システムは、選択された顧客/仕入先番号をビジネスパートナ番号として自動的に指定します。 |

**背景情報と例**
テーブルBUT000のビジネスパートナ、テーブルKNA1の顧客、およびテーブルLFA1の仕入先は、独立した番号範囲オブジェクトを使用します。

簡素化のために、この例ではビジネスパートナと顧客に焦点を当てます。
ビジネスパートナは特定のビジネスパートナグルーピング内に作成されます。アカウントグループは顧客マスタレコードの番号範囲を定義します。両方のグループが、ビジネスパートナと顧客が作成される番号範囲を決定します。これらのオブジェクト間のリンクは、顧客/仕入先統合 (CVI) のためにカスタマイズで設定する必要があります。同じ番号を割り当てる前に、対応する顧客/仕入先アカウントグループとビジネスパートナグルーピングの番号範囲が同一であることを確認する必要があります。

---
**(続き: 34ページ)**

次の例は、内部番号を持つ既存のビジネスパートナと、重複する番号範囲01を持つ内部番号を持つ顧客を示しています。

**BPグルーピング**

| グルーピング | ショートネーム | 説明 | 番号範囲 | 外部 |
|---|---|---|---|---|
| 0001 | Int.No.Assignment | 内部番号割当 | 01 | |

**ビジネスパートナ間隔**

| NR | 開始番号 | 終了番号 | Nr ステータス | 外部 |
|---|---|---|---|---|
| 01 | 0000000001 | 0999999999 | 5000 | |

**アカウントグループ (顧客)**

| グループ | 名称 | 番号範囲 |
|---|---|---|
| DEBI | 顧客 (一般) | 01 |

**顧客間隔**

| NR | 開始番号 | 終了番号 | Nr ステータス | 外部 |
|---|---|---|---|---|
| 01 | 0000100000 | 0000199999 | 100010 | |

内部番号範囲に対して終了番号のみを変更できるため、次のことを行う必要があります。

1. ビジネスパートナ間隔の「終了番号」を、例えば 0000099999 に変更します。
2. 新しい範囲 02 を作成し、外部としてマークします。
3. BPグルーピングの番号範囲を 02 に変更します。

**ビジネスパートナ間隔**

| NR | 開始番号 | 終了番号 | Nr ステータス | 外部 |
|---|---|---|---|---|
| 01 | 0000000001 | 0000099999 | 5000 | |
| 02 | 0000100000 | 0000199999 | - | X |

**BPグルーピング**

| グルーピング | ショートネーム | 説明 | 番号範囲 | 外部 |
|---|---|---|---|---|
| 0001 | Int.No.Assignment | 内部番号割当 | 02 | X |

CVIを設定して、顧客/仕入先の番号をBPに割り当てます。

**方向 顧客からBPへの番号割当**

| グループ | グループ | 同じ番号 |
|---|---|---|
| DEBI | 0001 | |

同期化中に、新しいビジネスパートナは顧客から同じ番号で作成されます (外部フラグが番号範囲にマークされています)。

S/4HANAゴーライブ後、変換後のタスクとして、ビジネスパートナと顧客の新しい同じ番号を作成できるように、番号範囲を再度変更する必要があります。新しいビジネスパートナおよび顧客の番号範囲を定義します。

1. 新しいBP番号範囲 03 を作成します。
2. BPグルーピングの番号範囲を 03 に変更します。
3. 新しい顧客番号範囲 02 (外部) を作成します。
4. アカウントグループ範囲を 02 に変更します。

**ビジネスパートナ間隔**

| NR | 開始番号 | 終了番号 | Nr ステータス | 外部 |
|---|---|---|---|---|
| 01 | 0000000001 | 0000099999 | 5000 | |
| 02 | 0000100000 | 0000199999 | - | X |
| 03 | 0000200000 | 0000300000 | | |

---
**(続き: 35ページ)**

**BPグルーピング**

| グルーピング | ショートネーム | 説明 | 番号範囲 | 外部 |
|---|---|---|---|---|
| 001 | Int.No.Assignment | 内部番号割当 | 03 | |

**顧客間隔**

| NR | 開始番号 | 終了番号 | Nr ステータス | 外部 |
|---|---|---|---|---|
| 01 | 0000100000 | 0000199999 | 100010 | |
| 02 | 0000200000 | 0000300000 | | X |

**アカウントグループ (顧客)**

| グループ | 名称 | 番号範囲 |
|---|---|---|
| DEBI | 顧客 (一般) | 02 |

CVIを設定して、方向 BP から顧客への同じ番号を使用します。

**方向 BPから顧客への番号割当**

| グルーピング | ショートネーム | アカウント グループ | 名称 | 同じ番号 |
|---|---|---|---|---|
| 001 | Int.No.Assignment | DEBI | 顧客 (一般) | X |

以下のExcel形式を使用して、既存の設定と変更を文書化できます。

**図15: 設定文書化のためのExcel形式**

このExcelは**こちら**で見つけることができます。

以下の段落では、上記の例で使用されたカスタマイズ設定について詳しく説明します。

**7.3.8.2.2. 顧客マスタレコードの番号範囲の定義** (35ページ)
このIMGアクティビティでは、顧客マスタレコードの番号範囲の間隔を定義します。顧客マスタレコードを作成する際、マスタレコードを識別する一意の番号が割り当てられます。この番号は、アカウントグループに提供される番号範囲から取得されます。

**顧客マスタの番号範囲の定義**
IMG -> ロジスティクス - 一般 -> ビジネスパートナ -> 顧客 -> 管理 -> 顧客番号範囲の定義と割当 -> 顧客マスタの番号範囲の定義

**図16: 顧客番号範囲の保守**

---
**(続き: 36ページ)**

**アカウントグループへの番号範囲の割当 (顧客)**
IMG -> ロジスティクス - 一般 -> ビジネスパートナ -> 顧客 -> 管理 -> 顧客番号範囲の定義と割当 -> アカウントグループへの番号範囲の割当

**図17: 顧客アカウントグループ番号範囲の割当**

**7.3.8.2.3. 仕入先マスタレコードの番号範囲の定義** (36ページ)
このIMGアクティビティでは、仕入先マスタレコードの番号範囲の間隔を定義します。仕入先マスタレコードを作成する際、マスタレコードを識別する一意の番号が割り当てられます。この番号は、アカウントグループに提供される番号範囲から取得されます。

**仕入先マスタの番号範囲の定義**
IMG -> ロジスティクス - 一般 -> ビジネスパートナ -> 仕入先 -> 管理 -> 仕入先マスタレコードの番号範囲の定義 -> 間隔

**図18: 仕入先番号範囲の保守**

**アカウントグループへの番号範囲の割当 (仕入先)**
IMG -> ロジスティクス - 一般 -> ビジネスパートナ -> 仕入先 -> 管理 -> 仕入先マスタレコードの番号範囲の定義 -> 間隔

**図19: 仕入先アカウントグループ番号範囲の割当**

**7.3.8.2.4. ビジネスパートナの番号範囲とグルーピングの定義** (36ページ)
このIMGアクティビティでは、ビジネスパートナの番号範囲を定義します。定義された番号範囲は、「グルーピングの定義と番号範囲の割当」アクティビティでグルーピングに割り当てられます。

**ビジネスパートナの番号範囲の定義**
IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 基本設定 -> 番号範囲とグルーピング -> 番号範囲の定義

---
**(続き: 37ページ)**

**図20: ビジネスパートナ番号範囲の保守**

使用する番号範囲の少なくとも1つについて、カスタマイズビュー「定義グルーピングと番号範囲の割当」（次の章を参照）では、内部番号割当の標準範囲として1つ、外部番号割当の標準範囲として1つの番号範囲が必要になるため、「外部割当」チェックボックスが選択されていない必要があります。そうでない場合、ビジネスパートナは作成されません。これは、実際の顧客番号をビジネスパートナ番号に引き継ぎたい場合、少なくとも2つの番号範囲を定義する必要があることを意味します。1つは「外部割当」チェックボックスが選択されておらず、もう1つは選択されているものです。

上記の「概要」セクションの例を参照して、顧客と仕入先の番号範囲に依存するビジネスパートナ番号範囲を調整する方法を説明します。

各ビジネスパートナはグルーピングに割り当てられる必要があります。これは、ビジネスパートナ番号フィールドへの入力方法を決定します。現在のシステムから顧客の番号を引き継ぎたい場合は、少なくとも2つのグルーピングを定義する必要があります。

* 1番目のグルーピングについては、**内部標準グルーピング**ラジオボタンが選択されている必要があります。
* 2番目のグルーピングについては、**外部標準グルーピング**ラジオボタンが選択されている必要があります。このグルーピングには、実際の顧客番号（顧客アカウントグループに割り当てられているもの）に使用する番号範囲を割り当てる必要があります。

**グルーピングの定義と番号範囲の割当**
IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 基本設定 -> 番号範囲とグルーピング -> グルーピングの定義と番号範囲の割当

**図21: ビジネスパートナグルーピングの保守**

各アカウントグループに対してBPグルーピングを作成することが推奨されます。簡素化のため、同じ識別子を使用します。第7.3.8.2.8項「典型的なビジネス要件の例」も参照してください。

**重要**
CVI変換レポートMDS\_LOAD\_COCKPITは、変換中に連絡担当者に内部ビジネスパートナ番号を割り当てます。内部番号範囲は、内部標準グルーピングに割り当てられた番号範囲です。割り当てられた内部番号範囲がターゲットの顧客または仕入先の番号範囲と重複する場合、連絡担当者の番号範囲を顧客および仕入先のターゲットビジネスパートナ番号の外側にある新しい範囲に変更する必要があります。他のビジネスパートナグルーピングと同じ番号範囲を共有しないでください。連絡担当者の番号の重複はエラー – R1124「GUID xxxxxを持つビジネスパートナが存在しない」を引き起こす可能性があります。

---
**(続き: 38ページ)**

**図22: ビジネスパートナグルーピングの保守**

**7.3.8.2.5. 関係の番号範囲の定義** (38ページ)
BP関係の内部管理およびBPロール定義のために、番号範囲インターバル「01」から内部番号が必要です。対応する番号範囲オブジェクトは「BU\_RELNR」です。

注: 番号範囲インターバル「01」を何も（例：関係タイプなど）に割り当てる必要はありません。

**番号範囲の定義（関係用）**
IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ関係 -> 基本設定 -> 番号範囲の定義

通常、番号範囲インターバル「01」はSAP標準で出荷されます。存在しない場合は、例えば保守する必要があります。

**図23: 番号範囲の定義: BP関係**

番号範囲インターバルが見つからない場合、エラーメッセージ R1 735 (R1735 - 番号範囲オブジェクト 01 の番号範囲インターバル BU\_RELNR が不適切に維持されています。) が表示されます。

**7.3.8.2.6. アカウントグループへのビジネスパートナロールの割当** (38ページ)
このIMGアクティビティでは、顧客または仕入先マスタレコードを処理する際に、ビジネスパートナをBPロールに割り当てます。これにより、顧客/仕入先統合の一部として顧客/仕入先を処理するときに、システムが対応するビジネスパートナを作成します。

新しいビジネスパートナマスタデータでアプリケーションシナリオが機能することを保証するために、顧客/仕入先をビジネスパートナに変換し、一般仕入先 / 一般顧客、FI仕入先 / FI顧客、購買組織などの必要なすべてのロールを割り当てることが必要です。

顧客については、少なくともBPロール FLCU00 (会社データ) および FLCU01 (販売データ) を入力してください。仕入先については、少なくとも FLVN00 (会社データ) および FLVN01 (購買データ) を入力してください。

アカウントグループに複数のBPロールを割り当てることができます。

**推奨事項:**
SAPは、以下の「CVI」ロールを配信します。

* 顧客: FLCU00 (一般データ + 会社コードデータ)、FLCU01 (一般データ + 販売データ)
* サプライヤ: FLVN00 (一般データ + 会社コードデータ)、FLVN01 (一般データ + 購買データ)

標準ロールを使用することが推奨されます。CVIのためにロールを追加することは通常不要です。また、BPロールを顧客/仕入先アカウントグループに1対1でマッピングすることは推奨されません。ここでは、BPロールと顧客/仕入先アカウントグループの比較を示します。

**BPロール** | **顧客/仕入先アカウントグループ**
---|---
複数のロールを同時に割り当て可能 | C/V は1つのアカウントグループに割り当てられます
* 削除可能
* 制限付き (タイム依存性)
* 追加可能
* 除外可能 (見込み客と顧客を同時に)
| 切り替え可能 (例: Ship-to -> Sold-to)
タイム依存性にできる | タイム依存性なし
BPマスタデータ (他のロール = 別の「ビュー」) の「ビュー」を定義する (異なる項目/エンティティが利用可能) | 表示/変更できる項目を制限する
項目変更を制御できる | 通常の項目変更を制御します (2516606 - BP\_CVI: トランザクションBPにおけるFI固有の項目変更を考慮)
番号付けを制御しない | 番号付けを制御する
特定の機能を制御する (例: CVI) | 完全に異なる機能を制御する (例: パートナー機能の使用)

---
**(続き: 39ページ)**

BPロールのフィールド変更マッピングをトランザクションBPのビジネスパートナフィールドグループにマッピングすることに加えて、この情報も確認してください。

* SAPノート 2603898 BP\_CVI: SAP S/4HANAのCVIにおけるトランザクションBPでのFI項目変更 (FMOD1) の考慮のための統合SAPノート
* SAPノート 2848273 CVI\_BDT: トランザクションBPでの項目ステータス (必須、非表示など) の理由を見つける ("可視性チェックレポート")
* ブログ「トランザクションBP、CVIにおける項目変更のヒントとトリック in S/4HANA」
https://blogs.sap.com/2020/06/17/tips-and-tricks-on-field-modifications-in-transaction-bp-cvi-in-s-4hana/

**重要:**
システム変換後にSAP与信管理を使用する予定がある場合、関連するアカウントグループに与信管理のビジネスパートナロールを割り当てることで、関連するビジネスパートナに直接割り当てることができます。前提条件として、ロールを最初に有効化する必要があります。変換後の各ビジネスパートナへのロールの手動割当が必要になる場合を除き、詳細についてはセクション9.3.与信管理を参照してください。

**顧客からBPへ**
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> キーの割当 -> 方向 顧客からBPへの番号割当の定義

---
**(続き: 40ページ)**

**図24: 顧客のロール割当の保守**

**仕入先からBPへ**
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 仕入先統合のための設定 -> 仕入先統合のための項目割当 -> キーの割当 -> 方向 仕入先からBPへの番号割当の定義

**図25: 仕入先のロール割当の保守**

**7.3.8.2.7. 番号割当 (CVIターゲット: ビジネスパートナ)** (40ページ)
このIMGアクティビティでは、顧客/仕入先マスタレコードのアカウントグループにビジネスパートナグルーピングを割り当て、顧客/仕入先を処理する際にビジネスパートナも同時に更新されるようにします。この割当により、ビジネスパートナが内部または外部の番号割当を持つアカウントグループで作成されるか、または同じ番号で作成されるかを選択できます。

**番号割当 (顧客からBPへ)**
IMG: クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> キーの割当 -> 方向 顧客からBPへの番号割当の定義

---
**(続き: 41ページ)**

**図26: 顧客の番号割当**

**番号割当 (仕入先からBPへ)**
IMG: クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 仕入先統合のための設定 -> 仕入先統合のための項目割当 -> キーの割当 -> 方向 仕入先からBPへの番号割当の定義

**図27: 仕入先の番号割当**

**7.3.8.2.8. 一般的なビジネス要件の例** (41ページ)
次の例では、番号範囲とグルーピングを設定することで解決できる典型的なビジネス要件を説明します。

**シナリオ**
現在の得意先 (Sold-to)、出荷先 (Ship-to)、請求先 (Bill-to)、および支払者 (Payer) の顧客は、異なる番号範囲と削減されたデータ入力項目を持ち、ビジネスパートナでも同じ番号範囲を維持したいと考えています。

**解決策**
1. BPで同じ番号範囲を定義します。
2. 各顧客アカウントグループに対してBPグルーピングを作成し、対応する番号範囲を割り当てます。利用可能な場合は、BPグルーピング名として同じ名前を使用できます。
3. 顧客アカウントグループとBPグルーピングを顧客とBPの間でマッピングします。
4. トランザクションBPでの顧客および仕入先の項目変更を考慮に入れるために、SAPノート 2516606 - BP\_CVI: トランザクションBPにおけるFI固有の項目変更を考慮を参照してください。

---
**(続き: 42ページ)**

このコンテキストでのSAPノート 2603898 - BP\_CVI: SAP S/4HANAのCVIにおけるトランザクションBPでのFI項目変更 (FMOD1) の考慮のための統合SAPノートも考慮してください。

5. トランザクションBPのパートナー機能表示は、既存のパートナー機能決定によって制御されます。

項目変更マッピングをトランザクションBPのビジネスパートナフィールドグループにマッピングすることに加えて、この情報も確認してください。

* SAPノート 2603898 BP\_CVI: SAP S/4HANAのCVIにおけるトランザクションBPでのFI項目変更 (FMOD1) の考慮のための統合SAPノート
* SAPノート 2848273 CVI\_BDT: トランザクションBPでの項目ステータス (必須、非表示など) の理由を見つける ("可視性チェックレポート")
* ブログ「トランザクションBP、CVIにおける項目変更のヒントとトリック in S/4HANA」
https://blogs.sap.com/2020/06/17/tips-and-tricks-on-field-modifications-in-transaction-bp-cvi-in-s-4hana/

**7.3.8.3. 顧客値マッピング (連絡担当者)** (42ページ)
属性値マッピングを保守する必要があり、既存のすべての顧客インスタンスで同一である必要があります。

**7.3.8.3.1. 連絡担当者の割当の有効化** (42ページ)
このIMGアクティビティでは、連絡担当者の割当を有効にします。

以下の両方のステートメントが真である場合に割当を有効にします。

* 連絡担当者の属性は、ビジネスパートナまたは顧客マスタレコードで処理されること。
* 顧客統合の一部として連絡担当者が同期化されることを保証するために、属性を割り当てたいこと。

連絡担当者の番号範囲とグルーピングに関する情報は、第7.3.8.2.4項「ビジネスパートナの番号範囲とグルーピングの定義」も参照してください。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 連絡担当者 -> 連絡担当者の割当の有効化

**図28: 連絡担当者の割当の有効化**

**7.3.8.3.2. 連絡担当者の部門番号の割当** (42ページ)
このIMGアクティビティでは、ビジネスパートナの部門番号を顧客マスタレコードの連絡担当者の部門番号に割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 連絡担当者 -> 連絡担当者の部門番号の割当

列 **Dept (CVI)** の値は、連絡担当者の顧客マスタデータに使用される値です。列 **Department (BP)** の値は、連絡担当者のビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

---
**(続き: 43ページ)**

**図29: 連絡担当者の部門番号の割当**

**7.3.8.3.3. 連絡担当者の機能の割当** (43ページ)
このIMGアクティビティでは、ビジネスパートナのパートナー機能を顧客マスタレコードの連絡担当者機能に割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 連絡担当者 -> 連絡担当者の機能の割当

列 **Function (CVI)** の値は、連絡担当者の顧客マスタデータに使用される値です。列 **Function (BP)** の値は、連絡担当者のビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**図30: 連絡担当者の機能の割当**

**7.3.8.3.4. 連絡担当者の権限の割当** (43ページ)
このIMGアクティビティでは、ビジネスパートナのパートナー権限を、顧客マスタレコードの連絡担当者のパートナー権限に割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 連絡担当者 -> 連絡担当者の権限の割当

---
**(続き: 44ページ)**

列 **PoAtt (CVI)** の値は、連絡担当者の顧客マスタデータに使用される値です。列 **Pwr of Att. (BP)** の値は、連絡担当者のビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**図31. 連絡担当者の権限の割当**

**7.3.8.3.5. 連絡担当者のVIPインジケータの割当** (44ページ)
このIMGアクティビティでは、ビジネスパートナのVIPインジケータを、顧客マスタレコードの連絡担当者のVIPインジケータに割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 連絡担当者 -> 連絡担当者のVIPインジケータの割当

列 **VIP (CVI)** の値は、連絡担当者の顧客マスタデータに使用される値です。列 **VIP (BP)** の値は、連絡担当者のビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**図32: 連絡担当者のVIPインジケータの割当**

**7.3.8.4. 顧客値マッピング** (44ページ)
属性値マッピングを保守する必要があり、既存のすべての顧客インスタンスで同一である必要があります。

---
**(続き: 45ページ)**

**7.3.8.4.1. 婚姻状況の割当** (45ページ)
このIMGアクティビティでは、ビジネスパートナの婚姻状況を、顧客マスタレコードの連絡担当者の婚姻状況に割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 婚姻状況の割当

列 **Marital Status (CVI)** の値は、顧客マスタデータに使用される値です。列 **Mar. Sts (BP)** の値は、ビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**図33: 婚姻状況の割当**

**7.3.8.4.2. 法的形態の法的ステータスへの割当** (45ページ)
このIMGアクティビティでは、ビジネスパートナの法的形態を、顧客/仕入先マスタレコードの法的ステータスに割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 法的形態の法的ステータスへの割当

列 **Legal Sts (CVI)** の値は、顧客/仕入先マスタデータに使用される値です。列 **LForm (BP)** の値は、ビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

---
**(続き: 46ページ)**

**図34: 法的形態の法的ステータスへの割当**

**7.3.8.4.3. 支払カードの割当** (46ページ)
このIMGアクティビティでは、顧客マスタレコードの支払カードのカードタイプを、ビジネスパートナの支払カードタイプに割り当てます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 支払カードの割当

列 **Card Type (CVI)** の値は、顧客マスタデータに使用される値です。列 **Card Type (BP)** の値は、ビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客マスタのすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**図35: 支払カードタイプの割当**

**7.3.8.4.4. 業種の割当** (46ページ)
このIMGアクティビティでは、顧客および仕入先マスタレコードの業種キーをビジネスパートナの業種に割り当て（その逆も）、顧客/仕入先統合のコンテキストで両方の業種フィールドが正しく更新されることを保証します。

ビジネスパートナ処理では、カテゴリ「組織」に属するビジネスパートナに、複数の業種システムから複数の業種を保存できます。各業種システムに対して、標準業種として1つの業種に名前を付けることができます。

顧客および仕入先マスタレコードには、業種を1つだけ保存できます。

---
**(続き: 47ページ)**

このIMGアクティビティでは、ビジネスパートナを処理する際に、標準業種の標準業種システムから対応する業種が顧客/仕入先マスタレコードからどのように導出されるかを決定します。また、顧客/仕入先マスタレコードのどの業種からビジネスパートナの対応する業種が作成されるかも決定します。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> 属性の割当 -> 業種の割当

右側で、標準システムとしてマークされている業種システムを選択します。

**図36: 業種システムの選択**

左側のオプションを選択して、方向 顧客からBP、およびBPから顧客への業種値を維持します。

**方向 顧客/仕入先からビジネスパートナへの業種マッピング**
左側で「**定義インバウンド業種マッピング**」(ダブルクリック) を選択し、対応する値を維持します。

**図37: インバウンド業種マッピングの定義**

列 **Indus.** の値は、顧客/仕入先マスタデータに使用される値です。列 **Industry** の値は、ビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客/仕入先のすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**方向 ビジネスパートナから顧客/仕入先への業種マッピング**
左側で「**定義アウトバウンド業種マッピング**」(ダブルクリック) を選択し、対応する値を維持します。

---
**(続き: 48ページ)**

**図38: アウトバウンド業種マッピングの定義**

列 **Indus.** の値は、顧客/仕入先マスタデータに使用される値です。列 **Industry** の値は、ビジネスパートナマスタデータに使用される値です。両方の領域で対応する値を維持し、顧客/仕入先のすべての値をビジネスパートナの値に割り当て、その逆も行ったことを確認してください。

**ツールサポート**
レポート FSBP\_IND\_SECTOR\_MAPPING\_CHECK (業種マッピングのチェックと設定) を使用して、顧客/仕入先統合のコンテキストで業種割当のカスタマイズエントリを生成し、既存または不足している割当エントリを評価できます。

**図39: 業種セクターのカスタマイズの同期化**

業種値が少ない場合、このレポートは必須ではありませんが、不足しているエントリの概要を得るのに役立ちます。

**7.3.8.5. 仕入先値マッピング** (48ページ)

**7.3.8.5.1. 連絡担当者** (48ページ)
仕入先連絡担当者のマッピングには特定の画面設定はありません。仕入先連絡担当者がEHPバージョン5未満で使用されている場合、SAPノート 2383051 – ビジネスパートナへの仕入先連絡担当者マッピングの開発を適用してください。

**7.3.8.5.2. 業種の割当** (48ページ)
業種値マッピングを保守する必要があり、既存のすべての仕入先インスタンスで同一である必要があります。

IMGにおける仕入先固有のトランザクションは、前の章で顧客設定について説明したものと同じ構成につながります (顧客と仕入先は同じIMGテーブルを共有します。セクション7.3.8.4.4業種の割当を参照)。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 仕入先統合のための設定 -> 仕入先統合のための項目割当 -> 属性の割当 -> 業種の割当

---
**(続き: 49ページ)**

設定された値が仕入先にとっても有効であることを確認してください。

**7.3.8.6. 独自のマッピング開発のためのビジネスアドイン (BAdI)** (49ページ)
利用可能なBAdIを使用して、顧客/仕入先からビジネスパートナへのアドレス形式などの顧客固有のマッピングを実装できます。ここでは、例えば、組織ではなく個人として異なるカテゴリでビジネスパートナを作成することも可能です。この場合、拡張機能 CVI\_MAP\_TITLE\_DIRECT を無効にし、IMGで拡張機能実装 CVI\_MAP\_BP\_CATEGORY を有効にする必要があります。実装はすでに利用可能です。拡張機能 CVI\_MAP\_BP\_CATEGORY が有効化されている場合、ビジネスパートナカテゴリは、顧客または仕入先のタイトルと、カスタマイズテーブルTSAD3の設定（IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> 基本設定 -> アドレス形式 -> アドレス形式の保守）に基づいて導出されます。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> ビジネスパートナのインバウンド (BAdIs)

以下の表は、既存のBAdIとそのBAdI定義名を示しています。

| IMGツリーノード | BAdI定義 |
|---|---|
| BAdI: データ割当 BP <-> 顧客/仕入先/連絡担当者 | CVI\_CUSTOM\_MAPPER |
| BAdI: 銀行詳細のデータ割当 BP -> 顧客/仕入先 | CVI\_MAP\_BANKDETAILS |
| BAdI: 支払カードのデータ割当 BP <-> 顧客 | CVI\_MAP\_CREDIT\_CARDS |
| BAdI: アドレス形式のデータ割当 顧客/仕入先からBPへ | CVI\_MAP\_TITLE |
| BAdI: BPから顧客/仕入先へのデータ作成のデフォルト | CVI\_DEFAULT\_VALUES |

**7.3.8.7. ビジネスパートナのアドレスタイプのチェック** (49ページ)
このアクティビティでは、特定のビジネス機能に必要な既存のアドレスタイプを確認します。アドレスタイプと標準アドレスタイプは、アドレス決定に関連しています。アドレスタイプ XXDEFAULT はSAPによって供給されます。このエントリが存在することを確認してください。存在しない場合は、名前 XXDEFAULT で新しいエントリを作成します。

IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 基本設定 -> アドレス決定 -> アドレスタイプの定義

**図40: ビジネスパートナアドレスタイプのチェック**

---
**(続き: 50ページ)**

**7.3.9. 顧客と仕入先を単一のビジネスパートナにリンクするための準備** (50ページ)
現在、同じビジネスエンティティを参照する顧客と仕入先が存在する場合でも、それらは個別のビジネスパートナにリンクされています。初期ロードの前に以下のSAPノートを実装してください。SAPノートの実装後、同じビジネスエンティティである場合、顧客と仕入先は単一のビジネスパートナにリンクされます。

* SAPノート 2363892 - S/4へのアップグレード前の初期ロード中に顧客と仕入先を単一のビジネスパートナにリンク
* SAPノート 2968536 - 単一のビジネスパートナへの顧客と仕入先のリンク動作の調和

前提条件として、以下が満たされている必要があります。

顧客または仕入先のいずれかにビジネスパートナがリンクされている、またはどちらにもリンクされていない（両方ではない）というように、顧客と仕入先がすでに個別のビジネスパートナにリンクされていないこと。このソリューションは、いずれかの顧客または仕入先のリンクテーブルエントリがすでに存在する場合にのみ適用可能です。

顧客または仕入先のビジネスパートナを作成するプロセス中に、システムはそのビジネスエンティティに対してすでにビジネスパートナが存在するかどうかをチェックします。存在する場合、上記の前提条件が満たされていれば、同じビジネスパートナにリンクします。

技術的には、これはBAdI CVI\_CUSTOM\_MAPPERのBAdI実装 (CVI\_MAP\_LEGAL\_ENTITY) です。
提供されている実装は、独自の結合基準を定義するためのPOCとして使用できます。

SAPノート 954816 - BP\_CVI: BPsの作成/リンクのためのトランザクションに関する情報も確認してください。このノートでは、同じ法的エンティティを表す同じ番号を持つ顧客と仕入先のために、メッセージ「ビジネスパートナ xxxxがすでに存在します」で同期化が失敗した場合の問題を解決する方法について説明しています。

トランザクション:

* FLBPD1 - 顧客からのBP作成
* FLBPD2 - BPと顧客のリンク
* FLBPC1 - 仕入先からのBP作成
* FLBPC2 - BPと仕入先のリンク

以下のブログも確認してください。
SAP S/4HANA ビジネスパートナ変換 – 顧客と仕入先を単一のビジネスパートナにマージ
https://blogs.sap.com/2020/08/31/sap-s-4hana-business-partner-conversion-merge-customer-and-vendor-into-single-business-partner/

**7.3.10. HCM従業員のビジネスパートナへの変換の準備** (50ページ)
ビジネスパートナが組織ではなく個人であることを実現するには、2つの可能性があります。

1. 仕入先従業員のタイトルが正しく維持されている場合、BAdI CVI\_MAP\_TITLEの標準BAdI実装 CVI\_MAP\_BP\_CATEGORY を使用できます。
2. タイトルが正しく維持されていない場合は、独自の基準でBADI CVI\_MAP\_TITLEの独自の इम्プリメンテーションを作成する必要があります。このBADIには複数の使用が許可されていないことに注意してください。したがって、既存のコーディングが独自の इम्プリメンテーションで実行されるようにする必要があります。標準BAdI実装 CVI\_MAP\_BP\_CATEGORY は無効にする必要があります。以下にサンプルコーディングを示します。この例は、従業員仕入先用の別のアカウントグループ (ZEMP) に基づいています。

```abap
data: lv_ktokk type ktokk.
select single ktokk into lv_ktokk 
 from lfa1
 where lifnr = i_vendor_id.
if sy-subrc = 0 and lv_ktokk = ‘ZEMP’.
 c_partner_category = bp_as_person.
endif.
```

---
**(続き: 51ページ)**

ビジネスパートナ番号に影響を与えたい場合は、BADI CVI\_CUSTOM\_MAPPERで実装する必要があります。

従業員に対するBP番号の設定例（LFB1-PERNRおよびBPABグルーピングと連結された従業員個人番号EN）は、BPに外部番号付けが番号範囲にあることが前提です。

**MAP\_VENDOR\_TO\_BP**
```abap
data: lt_company type VMDS\_EI\_COMPANY\_T,
 ls_company type VMDS\_EI\_COMPANY.
 if I\_VENDOR-CENTRAL\_DATA-CENTRAL-DATA-KTOKK = 'ZEMP'.
 lt_company = I\_VENDOR-COMPANY\_DATA-COMPANY.
 loop at lt_company into ls_company where data pernr ne space. "What if more than one Company Code?
 concatenate 'EN' ls_company-data-pernr into C\_PARTNER-HEADER-OBJECT\_INSTANCE-BPARTNER. "What BP already exists?
 C\_PARTNER-CENTRAL\_DATA-COMMON-DATA-BP\_CONTROL-GROUPING = 'BPAB'.
 exit.
 endloop.
 endif.
```
詳細については、以下のSAPノートを確認してください。

* 2539457 CVI & 従業員仕入先が間違ったBPカテゴリにいる
* 2542175 CVIと既存の従業員ビジネスパートナの再利用

確認すべき追加のSAPノート:

* 2880559 BAdIインターフェース CVI\_MAP\_TITLE~IF\_EX\_CVI\_MAP\_TITLE を新しいインポートパラメータで拡張。
* 2000099 CVIがエラー R1231: 「組織用に指定されていないアドレス形式 &1」で失敗する

従業員のレプリケーションに関する詳細については、セクション9.2.9.2も確認してください。

**7.4. 同期化** (51ページ)

マスタデータ同期化は、SAPシステム内のマスタデータオブジェクトを、ビジネス的には類似しているが技術的には異なる観点からレプリケートし、異なるSAPアプリケーションをビジネスプロセスでシームレスに統合できるようにします。マスタデータ同期化における同期化シナリオは2つあります。

* **マスタデータ保守からの同期化**
    新しいマスタデータを作成および保存すると、同期プロセスが有効になっているマスタデータオブジェクトタイプと同期化され、対応するマスタデータが作成されます。
    すでに同期化されている既存のマスタデータを変更する場合、システムはこのマスタデータと、保守中にソースオブジェクトタイプおよびターゲットオブジェクトタイプのすべての対応するマスタデータをロックします。変更されたマスタデータを保存すると、システムは通常、同期化プロセスが有効になっているマスタデータオブジェクトタイプとデルタ同期化を実行し、対応するマスタデータを変更します。場合によっては、既存のマスタデータを変更すると、デルタ同期化を実行する必要が生じることがあります。

* **同期化コックピットを使用した同期化**
    同期化コックピットを使用して、SAPシステム内のマスタデータオブジェクトの初期同期化を準備、実行、およびチェックします。

前提条件として、前の章で説明したカスタマイズを確認および適応し、顧客/仕入先統合 (CVI) および連絡担当者マッピングを作成している必要があります。

---
**(続き: 52ページ)**

以下の章では、同期化コックピットを使用した顧客および仕入先マスタデータの初期同期化について説明します。

マスタデータ同期化に関する詳細については、SAPヘルプでマスタデータ同期化を参照してください。

**7.4.1. 同期化コックピット** (52ページ)

同期化コックピットを使用すると、SAPシステム内のマスタデータ同期化のすべてのステップを実行できます。特に以下のことを行えます。

* 同期化実行の選択、準備、および開始。
* 同期化実行の監視
* 同期化エラーの後処理

同期化コックピットを開始するには、以下のIMGパスを使用するか、トランザクション **MDS\_LOAD\_COCKPIT** を呼び出します。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> マスデータ同期化 -> 同期化コックピットの実行

**図41: 同期化コックピット - 処理**

MDS\_LOAD\_COCKPITの画面はいくつかの領域に分かれています。

**1. 同期化プロセス** (52ページ)
* このサブスクリーンは、利用可能な (アクティブな) 同期化プロセスを示します。これらは、第7.3.8.1.4項「同期化オプションの有効化」で設定されたオプションです。トグルボタンを使用して、アクティブなプロセスのビューと、利用可能なすべての同期化プロセスのビュー（アクティブ化されているものとされていないもの）を切り替えることができます。
* 二重クリックで希望の同期化プロセスを選択します (顧客 -> ビジネスパートナ または 仕入先 -> ビジネスパートナ)

**2. 制御パラメータ** (52ページ)
* キュー設定（ブロックサイズ、キュー名、最大プロセス数）を確認します。このセクションに値を入力する必要があるのは、デフォルト値を変更する場合のみです。

---
**(続き: 53ページ)**

* 顧客の例（ブロックサイズとプロセス数）：マスタデータクレンジングと設定問題の解決後の同期化（1400万件の顧客）。ブロックサイズ50,000とCVIの60ダイアログタスクの組み合わせは、利用可能なプロセスの使用を最適化するために良いサイズであることが証明されています。
* **重要:** キュー処理（背景処理チェックボックスが有効）は、ダイアログタスクをトリガーし、バッチジョブではありません。

**3. ソースオブジェクトの選択基準** (53ページ)
* 入力パラメータは、アカウントグループ、顧客/仕入先番号、およびセントラル削除フラグの任意の組み合わせにすることができます。
* ソースオブジェクトの選択基準にはExcelファイルを使用できます。Excelファイルの形式は、ソースオブジェクトの選択基準の下にある「テンプレートのダウンロード」ボタンをクリックすることでダウンロードできます。
* エラー分析を容易にするために、最初に小規模なバッチまたは単一の顧客/仕入先を実行します。例として、10〜50の顧客または仕入先を選択します。

適用する必要のある以下のSAPノート:

* 2907519 – マスタデータ同期化ツールリバイムプ
* 2954330 – MDS\_LOAD\_COCKPITのモニタータブのパフォーマンス向上
* 2958046 – CVI : MDS\_LOAD\_COCKPITが特定の日付のログを表示しない

入力パラメータを提供した後、F8を押して同期化を開始します。

**4. モニター** (53ページ)
* 結果を表示するには、モニタータブを選択します。ユーザー名と日付に基づいてログを選択して表示することが可能です。

**5. 同期化実行ごとのステータス情報** (53ページ)
* ビジネスパートナ作成の前に、MDSコックピットはマスタデータ品質をチェックし、設定されたCVI値マッピングを適用します。品質問題または設定の欠落があるレコードについては、問題が修正されるまでビジネスパートナは作成されません。実行ステータスは赤信号でマークされます。

**7.4.1.1. 前提条件** (53ページ)
CVI同期化からのエラーメッセージを回避するために、CVIおよびBPカスタマイズを適切に設定してください。

CRMシステムがある場合は、セクション9.4 CRMを確認してください。

CpD関連のアカウントグループ（例：一回限りの顧客）でのアドレスチェックを抑制するには、IMGノード「フィールドチェック抑制の有効化」を確認します。これは、CVIコックピットの「準備」フェーズタブの「抑制チェック」項目、またはIMGで直接アクセスできます。

IMG -> クロスアプリケーションコンポーネント -> 一般アプリケーション機能 -> マスタデータ同期化 -> 顧客/仕入先統合 -> フィールドチェック抑制の有効化

**図42: 同期化コックピット - モニター**

---
**(続き: 54ページ)**

CpDに関する以下のノートに注意してください。

* 2955243 - CPDアカウントグループ機能強化: ドメインとフィールドチェック抑制画面の変更
* 2949716 - マスタデータ整合性チェックレポートにおけるCPDアカウントグループ機能強化
* 2955121 - CPDアカウントグループ機能強化 MDS\_LOAD\_COCKPIT BADI (BUPA\_SKIP\_ADDR\_CHCK) 実装

**7.4.1.2. 一部のチェックの抑制** (54ページ)
以前のバージョンでは、ノート 2344034 - マスタデータ移行のSAP S/4HANA自動化により、一部の国固有のチェックを抑制するためのBADI実装が導入されました（エントリが保存されたT005テーブルが削除されました）。エントリを復元するには、CVI\_UPGRADE\_CHECK\_RESOLVEで[完了]ボタンを押す必要がありました。

これらの機能は現在のバージョンのこのノートからは削除され、CVI\_UPGRADE\_CHECK\_RESOLVEももはや使用されないため、トランザクション BP\_CVI\_IMG\_CHK 「CVIカスタマイズ – チェックレポート」（セクション7.3.2.2 CVIカスタマイズ – チェック）を使用してください。

このソリューションの後継は、新しいIMGノードで利用可能です。

**図43: IMGノード「フィールドチェック抑制の有効化」**

この機能は、ECC 6 EHP 8 SP 13で提供されています。それより低いリリースおよびSPスタックでは、ノート 2780288 - S/4 HANA移行: MDS\_LOAD\_COCKPITからの同期化中に顧客/仕入先->BP方向でBPチェックを抑制できる、をインストールすることで利用可能にできます。

これは、CVIコックピットの「準備」フェーズタブの「抑制チェック」項目、またはIMGで直接アクセスできます。

IMG -> クロスアプリケーションコンポーネント -> 一般アプリケーション機能 -> マスタデータ同期化 -> 顧客/仕入先統合 -> フィールドチェック抑制の有効化

CpD関連のアカウントグループ（例：一回限りの顧客）でのアドレスチェックの抑制機能が追加されました。上記セクション7.4.1.1前提条件で言及されているSAPノートも確認してください。

**7.4.1.3. テスト実行機能の有効化** (54ページ)
同期化コックピットの処理タブには、標準ではグレー表示されている「テスト実行」チェックボックスがあります。SAPノート 2874184 - テスト実行の動作に関する情報、を実装することにより、テスト実行機能が有効になります。

---
**(続き: 55ページ)**

テスト実行モードが顧客からビジネスパートナ、または仕入先からビジネスパートナに設定されると、トランザクションMDS\_PPO2でログが表示されますが、ビジネスパートナはデータベースにコミットされません。

注意
テスト実行モードでの実行は、内部番号が生成されると元に戻せず再利用できなくなるため、番号範囲の枯渇を招きます。

通常、テスト実行モードで数百万件のレコードに対して顧客/仕入先からビジネスパートナへの変換を実行する場合、ビジネスパートナ、住所、ビジネスパートナ関係などのオブジェクトの番号範囲、およびその他の一部のアプリケーション番号範囲オブジェクトの枯渇につながる可能性があります。

したがって、テスト実行を行う際は注意し、MDS\_LOAD\_COCKPITトランザクションで提供される顧客/仕入先範囲（小規模な顧客/仕入先範囲に対してのみテスト実行モードでMDS\_LOAD\_COCKPITを実行することを推奨）を移行するために提供される範囲に注意してください。

**7.4.1.4. 例: MDS\_LOAD\_COCKPITの実行順序** (55ページ)

**環境:**
同期化するオブジェクト
* 顧客
* 仕入先
* 顧客に割り当てられた連絡担当者
* 仕入先に割り当てられた連絡担当者

**システムランドスケープ**
* ERP (ECCからS/4HANAへ変換予定)
* 顧客マスタはここで作成され、CRMにレプリケートされること
* CRM
    * 連絡担当者はここで作成され、ERP (ECC -> S/4HANA) にレプリケートされること

**CVI同期化後のターゲット**
* 顧客がBPにリンクされる
* 仕入先がBPにリンクされる
* 同じ法的エンティティの場合、顧客と仕入先が1つのBPにマージされる
* 顧客の連絡担当者がBPにリンクされる
* 仕入先の連絡担当者がBPにリンクされる
* マージされた顧客と仕入先の連絡担当者、仕入先で顧客の連絡担当者として利用可能（その逆も）
    * （これは、BP (連絡担当者) が顧客と仕入先にリンクされているBP (組織) にリンクされる場合の標準動作となるため）
* 顧客ロールを持つBPのみがCRMにレプリケートされるため、マージされた仕入先からのすべての連絡担当者はCRMにレプリケートされる必要がある

---
**(続き: 56ページ)**

**CVI前の状況**
ECC CRM
| (同じ法的エンティティ)
顧客 (CP 23, CP 45)
仕入先 (CP 78)
|
|
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 95 (組織)
* 顧客用ビジネスパートナ
* 顧客の連絡担当者

**CVI同期化後のターゲット状況**
ECC CRM
| (同じ法的エンティティ)
顧客 (CP 23, CP 45)
仕入先 (CP 78)
|
|
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 213 (個人)
ビジネスパートナ 95 (組織)
|
|
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 213 (個人)
ビジネスパートナ 95 (組織)

**ターゲット状況を達成するためのステップ**
1. CRMレプリケーションをオフにする (推奨)

---
**(続き: 57ページ)**

**2. MDS\_LOAD\_COCKPIT: 顧客 -> BP**
すべての顧客をBPに変換します。割り当てられたすべての連絡担当者もBPに変換されます。

ECC:
顧客
CP 23
CP 45
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 95 (組織)

**3. MDS\_LOAD\_COCKPIT: 仕入先 -> BP**
すべての仕入先をBPに変換します。割り当てられたすべての連絡担当者もBPに変換されます。
このステップでは、同じ法的エンティティの仕入先が、ステップ2の既存のBPに割り当てられます。

ECC:
顧客 仕入先
CP 23
CP 45
CP 78
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 213 (個人)
ビジネスパートナ 95 (組織)

---
**(続き: 58ページ)**

**4. MDS\_LOAD\_COCKPIT: BP -> ECC: 仕入先**
顧客と仕入先がマージされたBPのみを選択します。
このステップは、以前の顧客連絡担当者を仕入先にリンクするためです。

ECC:
顧客 仕入先
CP 23
CP 45
CP 78
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 213 (個人)
ビジネスパートナ 95 (組織)

**5. MDS\_LOAD\_COCKPIT: BP -> ECC: 顧客**
顧客と仕入先がマージされたBPのみを選択します。
このステップは、以前の仕入先連絡担当者を顧客にリンクするためです。

ECC:
顧客 仕入先
CP 23
CP 45
CP 78
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 213 (個人)
ビジネスパートナ 95 (組織)

**6. CRMレプリケーションのオン**

---
**(続き: 59ページ)**

**7. BUPA\_SEND: マージされた顧客と仕入先を持つBPからの連絡担当者をすべてCRMにレプリケート**

CRM:
ビジネスパートナ 100 (個人)
ビジネスパートナ 165 (個人)
ビジネスパートナ 213 (個人)
ビジネスパートナ 95 (組織)

**7.4.2. 後処理オフィス (PPO)** (59ページ)

上記の手順を実行した後、後処理されるべき後処理オーダーが作成されているかどうかを確認する必要があります。そのため、トランザクションMDS\_PPO2を使用して、マスタデータ同期化実行中に発生したエラーメッセージを取得します。

同期化中に発生したエラーはログに記録され、後処理オフィス (PPO) を使用して表示および解決できます。MDSコックピットでモニタータブを選択します。

**図44: PPOエラーの解決**

エラーを解決するには、エラーステータスの行を選択し、「PPO呼び出し」ボタンをクリックします。これにより、トランザクションMDS\_PPO2に移動し、対応するエラー詳細が表示されます。

または、選択基準「ソフトウェアコンポーネント」=「AP-MD」を使用して、トランザクションMDS\_PPO2、またはトランザクション /N/SAPPO/PPO3を直接呼び出すこともできます。

概要画面で、ビジネスパートナまたは顧客/仕入先番号をダブルクリックして、対応するエラーメッセージを表示します。

**図45: PPOエラーメッセージの表示**

データエラーの場合（以下の図の1を参照）、

* ソースオブジェクトタブ（顧客または仕入先）を選択します。
* 「表示」または「変更」オプションを選択します。これにより、対応するトランザクションページが開き、データを表示または編集できます。
* 変更を保存します。データは自動的にターゲットオブジェクトと同期化されます。

---
**(続き: 60ページ)**

カスタマイズエラーの場合（以下の図の2を参照）、

* 対応するカスタマイズテーブル/アクティビティに手動で移動し、エラーを解決します。
* エラーエントリに戻ります。
* 同期化を再開します。同期化オプションは2つあります。
    * 個別同期化 - 選択したソースオブジェクトとターゲットオブジェクトを同期化します。
    * 一括同期化 - 選択したエラーコードに基づいて、すべてのソースオブジェクトとターゲットオブジェクトを同期化します。

**図46: PPO詳細の表示**

エラーが解決されたら、MDS\_PPO2に戻り、「完了」ボタンを使用してエラーステータスを手動で設定します。

同期化エラーを解決した後、他にエラーが発生していないか確認するために、修正を行った日付を選択基準として使用して、MDS\_PPO2レポートを再実行します。

一般的な同期化の問題とその解決策の概要については、セクション7.4.5設定とマスタデータの問題を参照してください。

**7.4.2.1. PPOメッセージのダウンロード** (60ページ)
エラー分析と文書化のために、PPOからエラーメッセージのリストをダウンロードすることが有用な場合があります。他のALVビューのようにメッセージをスプレッドシートにダウンロードする組み込み機能はありません。以下の手順を実行することで、メッセージをスプレッドシートとして取得できます。

1. トランザクションMDS\_PPO2に移動します。選択基準を入力し、「実行」(F8) を押します。
2. 出力のレイアウトをニーズに合わせて変更するために（例：メッセージクラスとメッセージ番号を挿入）、[レイアウトの選択…] ボタンの右側にある小さな三角形を押し、「レイアウトの変更…」を選択します。
3. [印刷プレビュー] ボタンの右側にある小さな三角形を押して印刷メニューを開き、「印刷プレビュー（階層全体）」を選択します。
4. プレビューウィンドウで「システム -> リスト -> ローカルファイルに保存」を選択し、テキストファイルとして保存します。
5. テキストファイルをExcelにインポートします。

**7.4.2.2. 技術的背景** (60ページ)
以下のオブジェクトは、同期化コックピットの機能を技術的な観点からさらに理解するための出発点として役立ちます。

---
**(続き: 61ページ)**

**ファンクションモジュール**

* MDS\_LOAD\_START: 一括同期化の開始
* MDS\_LOAD\_RESTART: 一括同期化の再開

**テーブル**

* /SAPPO/ORDER\_DAT: 後処理オーダーの追加データ
* /SAPPO/ORDER\_HDR: 後処理オーダー - ヘッダーデータ
* /SAPPO/ORDER\_MSG: 後処理オーダーのメッセージ
* /SAPPO/ORDER\_OBJ: 後処理オーダーの関連オブジェクト

**7.4.3. 例 - PPOを使用した同期化エラーの解決** (61ページ)
次の例では、単一の顧客の同期化エラーをステップバイステップで解決する方法を示します。顧客の例では、2つの異なるエラーが存在します。

1. カスタマイズエラー
2. マスタデータエラー

同期化実行後、MDSコックピットのモニターでエラーメッセージが表示されます。「PPO呼び出し」を選択すると、エラーメッセージ「アドレス 0002 のフォームが組織向けに指定されていません」が表示されます。

**図47: ビジネスプロセスIDごとのPPOオーダーの表示**

これは典型的なカスタマイズエラーです。CVIは組織タイプの新しいビジネスパートナを作成します。アドレス形式は組織には許可されていません。

対応するカスタマイズは以下で見つけることができます。
IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 基本設定 -> アドレス形式 -> アドレス形式の保守

**図48 "アドレス形式の保守"**

---
**(続き: 62ページ)**

「Ms.」や「Mr.」などに対して「Org.」をオンに切り替えた場合、カテゴリ「組織」のビジネスパートナが作成されます。これを避けるためには、修正としてセクション7.3.8.6で説明されているBAdI CVI\_MAP\_BP\_CATEGORYを有効にすることができます。

修正を適用した後、PPOのエラーエントリに戻り、「個別同期化」または「一括同期化」を選択して同期化を再開します。この顧客についてはPPOに複数のエントリが存在するため、一括同期化を選択します。明らかに、これは複数の同期化実行に含まれていました。備考：最新の実行のみがさらに処理されます。

**図49: 一括同期化 - オブジェクト選択**

---
**(続き: 63ページ)**

**図50: 後処理デスクトップ - オーダー詳細の編集**

すべてのエントリを選択し、処理を開始します。MDSコックピットに戻り、モニタータブを更新します。モニタータブに2番目のエラー行が表示されます。

**図51: MDSコックピット - モニター**

新しいエントリを選択し、PPOを開きます。新しいエラーメッセージが表示されます。**「メールアドレス thats\_not\_a\_correct\_email は無効です」**。カスタマイズエラーは解決されましたが、マスタデータエラーが

---
**(続き: 64ページ)**

発生します。同期化プロセスは、メールアドレスの形式が有効かどうかをチェックします。無効な場合、PPOオーダーが作成されます。

顧客タブから処理方法「変更」をダブルクリックして、顧客マスタデータをPPOオーダーから直接編集を開始します。

**図52: 顧客変更: 一般データ**

メールアドレスを変更して顧客を保存した後、データはターゲットオブジェクトと自動的に同期化されます。

PPOおよびMDSコックピットモニターのエントリは更新されません。この顧客のすべてのエントリを選択してMDS\_PPO2で表示すると、3つのエラーメッセージがまだ表示されます。

**図53: PPOデスクトップ - オーダー編集: 概要**

PPOオーダーを開いた後、「完了」ボタンを使用してエラーステータスを手動で設定します。

---
**(続き: 65ページ)**

**図54: PPOデスクトップ - オーダー編集: 概要**

ビジネスパートナが正常に作成されたことを確認するために、CVIリンクテーブル **CVI\_CUST\_LINK** をトランザクションSE16でチェックします。顧客のエントリが追加されています。

または、トランザクション **MDS\_LINKS** (= レポート CVI\_MAPPING\_BP\_CUST\_VEND) を使用して、有効なリンクが存在することを確認します。

**図55: レポート CVI\_MAPPING\_BP\_CUST\_VEND**

後処理の労力を避けるために、同期化を開始する前に、カスタマイズ設定とマスタデータ品質を注意深くチェックする必要があります。セクション0を参照してください。

**7.4.4. 同期化完了のチェック** (66ページ)
セクション7.3.2.3で説明されているように、CVI\_COCKPITは完全性チェックトランザクション CVI\_COMPL\_CHK (ABAPレポート CVI\_COMPLETENESS\_CHECK) へのリンクを提供します。ビジネスパートナにまだ変換されていない顧客、仕入先、および連絡担当者がリストされており、修正後に再度実行するためにMDS\_LOAD\_COCKPITに直接アップロードできるMS Excelファイルとしてリストをダウンロードすることが可能です。

完了チェックのために以前使用されていたトランザクション CVI\_PRECHECK\_UPGRADE (レポート PRECHECK\_UPGRADATION\_REPORT) は、SAPノート 2831894 - 廃止: CVI変換: 事前チェックアップグレードレポート、により廃止されています。

**7.4.5. 設定およびマスタデータの問題** (66ページ)
以下に、顧客および仕入先マスタデータの同期化中に発生する可能性のある設定およびマスタデータの問題を説明します。設定とマスタデータを注意深く確認し、必要に応じて調整してください。前の章で説明されているすべての設定が行われ、顧客/仕入先またはビジネスパートナのカスタマイズで不足している値が維持されていることを確認してください。

エラーは、設定の欠落、特定のマスタデータ構成、またはその他の原因により発生する可能性があります。可能性のある問題の非網羅的なリストは、顧客プロジェクトの経験に基づいており、頻繁に更新されます。SAP S/4HANAプロジェクトの早期段階でサンドボックスでCVI変換を実行し、可能な問題を特定して解決してください（セクション7.5.2 CVI変換アプローチ: 例も参照）。

同期化の問題のコレクションは、SAPノート
2904137 - MDS\_PPO2の汎用エラーメッセージのPPOヒント、で見つけることができます。

**7.4.5.1. CVI設定の問題** (66ページ)

**7.4.5.1.1. BUPA\_TAXN011 - 税コードカテゴリが存在しない** (66ページ)
このエラーの根本原因は、ビュー V\_TFKTAXNUMTYPEC で税番号カテゴリが不足していることです。システムに関連する国のエントリをビュー V\_TFKTAXNUMTYPEC に維持する必要があります。

IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 基本設定 -> 税番号 -> 税番号カテゴリの保守

標準設定では、2文字と数字の命名規則に従います。

* 2文字は、税番号が使用される国のISOコードです。
* 数字は連続した番号です。

この番号は、顧客または仕入先マスタのどの税番号フィールドが使用されるかを制御します。

V\_TFKTAXNUMTYPEC に新しいエントリを作成するには、定義済みの税タイプのいずれかをキーとして選択する必要があります。税タイプがシステムに存在しない場合は、まずトランザクションSM30を使用してビュー V\_TFKTAXNUMTYPE に新しいエントリを作成する必要があります。

---
**(続き: 67ページ)**

**図56: 税番号カテゴリの保守**

SAPノートも確認してください。

* 1006160 - EU加盟国向けの新税番号タイプ (2007年1月1日現在)
* 775919 - ビジネスパートナの税番号カテゴリの欠落

エラーメッセージ Specify an industry の根本原因は、顧客 (KNA1-BRSCH) または仕入先 (LFA1-BRSCH) の業種が業種システムで設定されていないことです。セクション7.3.8.4.4 業種の割当を参照してください。

顧客/仕入先に使用されるすべての業種をビジネスパートナ用にも維持し、その逆も行う必要があります。

顧客/仕入先カスタマイズで業種を表示および保守するには:
IMG -> 販売と流通 -> マスタデータ -> ビジネスパートナ -> 顧客 -> マーケティング -> 顧客の業種セクターの定義

BPカスタマイズで業種を表示および保守するには:
IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 組織 -> 業種システムと業種の保守

顧客/仕入先業種をBP業種に、その逆に割り当てるには:
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 項目割当のための項目割当 -> 属性の割当 -> 業種の割当

**7.4.5.1.2. R11173 - 業種の指定** (67ページ)

**7.4.5.1.3. F2868/F2869 - 組織向けにアドレスフォームが設定されていない** (67ページ)
エラーメッセージ Form of address xxx not designated for organizations の根本原因は、アドレスフォームのカスタマイズが不完全であることです。

顧客/仕入先は異なるビジネスパートナカテゴリを使用しません。SAPビジネスパートナでは、ビジネスパートナカテゴリを個人、組織、グループで区別する必要があります。アドレス形式の詳細については、SAPヘルプのビジネスアドレスサービスを参照してください。

CVIは組織タイプの新しいビジネスパートナを作成します。組織およびグループに有効なアドレス形式を維持します。

IMG -> クロスアプリケーションコンポーネント -> SAPビジネスパートナ -> ビジネスパートナ -> 組織 -> 業種システムと業種の保守

---
**(続き: 68ページ)**

**図57: アドレス形式の保守**

補正のために、「Ms.」や「Mr.」に対して「Org.」をオンに切り替えた場合、カテゴリ「組織」のビジネスパートナが作成されます。これを避けるためには、セクション7.3.8.6で説明されているBAdI CVI\_MAP\_BP\_CATEGORYを有効にすることができます。

**7.4.5.1.4. T5002 - 国コードXXの電話/ファックスコードが維持されていない** (68ページ)
エラーメッセージ Telephone/fax code for country code XX is not maintained の根本原因は、国設定のカスタマイズが不足していることです。

国固有の電話番号を維持します。

IMG -> SAP Netweaver -> 一般設定 -> 国の設定 -> 国コードの定義

**図58: 国コードの定義**

**7.4.5.2. マスタデータの問題** (68ページ)
マスタデータの問題は、誤ったデータ形式でのマスタデータアップロード、無効化された標準チェック、またはマスタデータを保守するための顧客レポートの使用に基づいていることがよくあります。その他のソースは、依存するマスタデータレコードを調整せずに変更された設定です（例：輸送ゾーンの変更）。

**7.4.5.2.1. 取引先xxxが顧客yyに割り当てられていない** (68ページ)
エラーメッセージ Trading partner xxx assigned to customer yyy doesn’t exist の根本原因は、項目KNA1-VBUNDに指定された取引先がテーブルT880に存在しないことです（仕入先、LFA1-VBUNDについても同様）。

**図59: 顧客一般データの変更 – 取引先**

---
**(続き: 69ページ)**

このエラーは、例えば、VBUNDフィールドが誤った形式で転送され、マスタデータがテーブルダンプとしてアップロードされた場合に発生する可能性があります。フィールドの形式は6桁の数値である必要があります（フィールド定義はCHAR 6ですが、6桁の数値値のみが許可されます）。

VBUNDフィールドの値が誤っている場合は、トランザクションXD02/XK02で手動で変更するか、修正を自動化するためのレポートを作成します。

備考
マスタデータレプリケーションにIDOCが使用される場合、マスタデータレコードは誤った形式のVBUND値では投稿されません。

取引先パートナーのフィールドの値の形式が正しいが、IDがテーブルT880にない場合は、不足しているエントリを維持します。

カスタマイズパス:
IMG -> エンタープライズストラクチャ -> 定義 -> 財務会計 -> 会社コードの定義

**7.4.5.2.2. AR102 - 銀行口座キーの長さがxxでなければならない** (69ページ)
無効な銀行口座番号に関するエラーメッセージの根本原因は、銀行口座番号（顧客: KNBK-BANKN、仕入先: LFBK-BANKN）が国設定で指定されている長さと異なる長さで定義されていることです。

**図60: 顧客一般データの変更 – 銀行口座**

正しい投稿を保証するために、銀行口座の長さは銀行口座の国固有の設定に準拠する必要があります。

国設定を確認するには:
IMG -> SAP Netweaver -> 一般設定 -> 国の設定 -> 国固有チェックの定義

トランザクションXD02/XK02で値を手動で変更するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.3. AR147 - 銀行管理キーは2文字でなければならない** (69ページ)
無効な銀行管理キーに関するエラーメッセージの根本原因は、銀行管理キー（顧客: KNBK-BKONT、仕入先: LFBK-BKONT）が誤った形式で定義されていることです。長さは2文字である必要があります。

---
**(続き: 70ページ)**

**図61: 顧客一般データの変更 – 銀行管理キー**

トランザクションXD02/XK02で値を手動で変更するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.4. 銀行キーxxxが国yyに存在しない** (70ページ)
銀行キーが見つからないというエラーメッセージの根本原因は、銀行キー（顧客: KNBK-BANKL、仕入先: LFBK-BANL）が銀行マスタデータで定義されていないことです。

**図62: 顧客一般データの変更 – 銀行キー**

銀行キーが顧客/仕入先マスタデータで間違っているか、銀行マスタにキーが不足しているという理由も考えられます。

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

銀行マスタデータを変更するには、トランザクションFI01（作成）またはFI02（変更）を使用します。

**7.4.5.2.5. 口座名義人がいない** (70ページ)
口座名義人情報（顧客: KNBK-KOINH、仕入先: LFBK-KOINH）が提供されていないが、銀行の国にとって必要である場合、口座名義人がいないというエラーメッセージの根本原因となります。

**図63: 顧客一般データの変更 – 口座名義人**

正しい投稿を保証するために、マスタデータレプリケーションの前に、すべての口座で口座名義人情報が存在することを確認するための追加のチェックを実行する必要があります。

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.6. AM654 - 郵便番号 (私書箱) の長さがxxまたはyyでなければならない** (70ページ)
郵便番号の長さと私書箱に関するエラーメッセージの根本原因は、郵便番号 (私書箱) の形式が国の設定で定義されている形式と異なることです。

誤った郵便番号情報は、テーブルKNA1/LFA1、およびテーブルADRCに存在する可能性があります。

テーブルKNA1/LFA1では、以下のフィールドが使用されます。

---
**(続き: 71ページ)**

* PSTLZ: 郵便番号
* PSTL2: 私書箱郵便番号
* PFACH: 私書箱

テーブルADRCでは、以下のフィールドが使用されます。

* POST\_CODE1: 郵便番号
* POST\_CODE2: 私書箱郵便番号
* PO\_BOX: 私書箱

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.7. AR128/AR129 - 税コードnは無効です** (71ページ)
メッセージ Tax Code n is not valid (n=1 または n=2) の根本原因は、顧客（テーブルKNA1）または仕入先（テーブルLFA1）マスタデータのフィールドSTCD1またはSTCD2に無効な税番号があることです。

**図64: 税番号**

トランザクションXD02/XK02で値を手動で変更するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.8. 税管轄コードは無効です** (71ページ)
税管轄コードに関するエラーメッセージの根本原因は、顧客/仕入先マスタデータに保存されている管轄コード（顧客: KNA1-TXJCD、仕入先: LFA1-TXJCD）が、カスタマイズで定義されている形式と異なることです。

カスタマイズを確認するには:
IMG -> 財務会計 -> 財務会計グローバル設定 -> 売上/購買税 -> 基本設定 -> 税管轄コードの構造の指定

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.9. BUPA\_TAX200 - 税コードカテゴリXXXの税番号はすでに維持されています** (71ページ)
すでに存在する税番号に関するエラーメッセージの根本原因は、VAT登録番号が二重に保守されていることです。

VAT登録番号は、顧客マスタのフィールドKNA1-STCEG（顧客）またはLFA1-STCEG（仕入先）、およびセクション「その他」のフィールドKNAS-STCEG（顧客）またはLFAS-STCEG（仕入先）に維持されています。

---
**(続き: 72ページ)**

**図65: 顧客一般データの変更 – VAT情報**

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

SAPノート 2232604 - 顧客または仕入先をビジネスパートナにレプリケートする際のBUPA\_TAX200エラーも確認してください。

**7.4.5.2.10. 税コードnの項目への入力がXX文字を超えています** (72ページ)
変換で実行された仕入先のマッピング方法では、仕入先の税番号1（フィールドLFA1-STCD1）は、仕入先の税国がドイツ（DE）の場合、ビジネスパートナの税コード2（フィールドLFA1-STCD2）にマッピングされます。

フィールドSTCD1は16文字で定義され、STCD2は11文字で定義されます。ファンクションモジュール BUPA\_TAX\_NUMBER\_CHECK は、これら2つのフィールドの長さをチェックします。

税コードが11文字を超える場合、顧客/仕入先の税コード1に11文字を超える税コードを入力できる可能性があるため、エラーAR103が発生します。

詳細はSAPノート 2098239 - 税コード2の項目への入力が11文字を超える、を参照してください。

エラーメッセージAR103を警告または情報メッセージに変更します。

トランザクションOBA5を使用してエラーメッセージを抑制するには、新しいユーザー固有のメッセージ制御を定義します。アプリケーションエリアARを選択します。保守ビューで「新規エントリ」を押します。メッセージ番号103を選択し、オンライン処理およびバッチ入力処理のメッセージタイプとして「-」を選択します。新しいエントリを保存します。

**図66: 税コードが長すぎる**

備考
メッセージをカスタマイズ可能にする方法の説明については、SAPノート 958424 - BP: 税コード2のエラーメッセージを参照してください。

---
**(続き: 73ページ)**

**7.4.5.2.11. 存在しない顧客/仕入先への参照** (73ページ)
存在しない顧客/仕入先に関するエラーメッセージの根本原因は、顧客マスタデータ（KNA1-LIFNR）で参照されている仕入先、または仕入先マスタデータ（LFA1-KUNNR）で参照されている顧客が存在しないことです。

マスタデータレプリケーションにIDOCが使用されている場合、マスタデータレコードは投稿されません。

正しい投稿を保証するために、マスタデータレプリケーションの前に、ソースシステムで参照されている顧客/仕入先の存在を確認するための追加チェックを実行する必要があります。

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.12. 不正なクレジットカード番号の割当** (73ページ)
不正なクレジットカード番号に関するエラーメッセージの根本原因は、クレジットカード番号が信用限度タイプに対するカスタマイズ設定に適合しないことです。

クレジットカードはテーブルVCNUMに保存されます。顧客へのクレジットカードの割当はテーブルVCKUNに保存されます。両方のテーブルで、フィールドCCNUMがクレジットカード番号を保存するために使用されます。

クレジットカードタイプのカスタマイズを確認および調整するには、カスタマイズパスを使用します。
IMG -> 販売と流通 -> 請求 -> 支払カード -> カードタイプの保守

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**図67: 無効なクレジットカード番号**

**7.4.5.2.13. BC428 - KNVKテーブルの訪問時間の不整合 (許可されていないオーバーフロー)** (73ページ)
このエラーメッセージ (メッセージBC428) の根本原因は、連絡担当者に対して訪問時間が使用されるとすぐに、午前と午後の時間間隔の両方に対して開始時刻と終了時刻を定義する必要があることです。開始時刻または終了時刻のいずれかのみが維持されている場合に、このエラーが発生します。

フィールド:

* KNVK-MOAB1: 午前インターバル開始
* KNVK-MOBI1: 午前インターバル終了
* KNVK-MOAB2: 午後インターバル開始
* KNVK-MOBI2: 午後インターバル終了

---
**(続き: 74ページ)**

**図68: 顧客一般データの変更 – 訪問時間**

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します（例：連絡時間（コンタクトアワー）を削除します）。

**7.4.5.2.14. 顧客マスタにWebアドレスがない** (74ページ)
Webアドレスが見つからないというエラーメッセージの根本原因は、有効なURLアドレスなしでタイプHPG（ホームページ）の通信エントリがあることです。一般的に、このエラーは、識別子なしで通信タイプが維持されている場合に発生します。

通信タイプと識別子は、主に以下のフィールドを使用してテーブルADR12に保存されます。

* ADR12-URI\_TYPE: 識別子
* ADR12-URI\_SRCH: ショートフォーム
* ADR12-URI\_ADDR: アドレス

**図69: 顧客一般データの変更 – Webアドレス**

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します（例：URIアドレスのないすべてのエントリを削除します）。

---
**(続き: 75ページ)**

**7.4.5.2.15. ビジネスパートナ国が定義されていない** (75ページ)
ビジネスパートナ国が未定義であることに関連するエラーメッセージの根本原因は、顧客/仕入先マスタで国が維持されていないことですが、ビジネスパートナでは必須のエントリです。

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.16. F2840 - 輸送ゾーンXXは国XXに定義されていません** (75ページ)
未定義の輸送ゾーンに関するエラーの根本原因は、国に、顧客/仕入先データで維持されていた輸送ゾーンがもはや存在しないことです。

**図70: 顧客一般データの変更 – 輸送ゾーン**

**輸送ゾーンの保守**
IMG -> SAP Netweaver -> アプリケーションサーバー -> Basisサービス -> アドレス管理 -> 輸送ゾーンの保守

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

**7.4.5.2.17. XYZフィールドの最後のX文字の使用が制限されています (YYのXX)** (75ページ)
このメッセージの根本原因は、顧客/仕入先の名前と住所データが、一部のシナリオでフィールドが切り捨てられる可能性があることです。これらのシナリオは、ALE、EDI、または住所の印刷を伴うデータ転送です。これらの場合、システムは名前フィールド、Street、City、Districtのフィールドの最初の35文字、およびフィールド「検索項1」の最初の10文字のみを使用します。

これらのシナリオでアドレスデータが切り捨てられないようにしたい場合は、保守中にアドレスフィールドの最初の35文字またはフィールド「検索項1」の最初の10文字のみを使用するか、必要に応じてテキストを省略してください。

---
**(続き: 76ページ)**

**図71: 顧客一般データの変更 – 値が長すぎる**

顧客/仕入先マスタの値を変更するには、トランザクションXD02/XK02を使用するか、修正を自動化するためのレポートを作成します。

メッセージ（AM228）はカスタマイズで抑制できます。以下のパスを使用します。
IMG -> クロスアプリケーションコンポーネント -> 銀行ディレクトリ -> メッセージ制御の変更

または、トランザクションOBA5を呼び出します。アプリケーションエリアAMを選択します。保守ビューで「新規エントリ」を押します。メッセージ番号228を選択し、オンライン処理およびバッチ入力処理のメッセージタイプとして「-」を選択します。新しいエントリを保存します。

**図72: ユーザーごとのメッセージ制御**

**7.4.5.2.18. システムに維持されている国に対してジオコーダがありません** (76ページ)
このメッセージは、住所（国もなし）が割り当てられていない顧客または仕入先で発生する可能性があります。この設定は、一回限りの顧客/仕入先（CPD）を管理する場合に使用される可能性があります。

---
**(続き: 77ページ)**

**図73: 住所のないマスタデータ**

解決策は、同期化を許可するために（少なくとも）国を割り当てるか、CpD関連のアカウントグループでのアドレスチェックを抑制するためにIMGノード「フィールドチェック抑制の有効化」をチェックすることから構成されます（詳細はセクション7.4.1.1前提条件を参照）。

**7.4.5.3. その他の問題** (77ページ)

**7.4.5.3.1. R11124 - GUID xxxxxのビジネスパートナが存在しない** (77ページ)
エラー Business partner with GUID xxxxx does not exist の根本原因は、連絡担当者の番号範囲設定が間違っていることです。

連絡担当者の番号範囲を他のBPグルーピングと共有しないでください。連絡担当者の番号範囲は、内部標準グルーピングの番号範囲です。詳細については、第7.3.8.2.4項「ビジネスパートナの番号範囲とグルーピングの定義」を参照してください。

別の原因は、リンクテーブル CVI\_CUST\_LINK および CVI\_VEND\_LINK の不整合です。この問題を解決するために、修正レポートを実装して実行する必要があります。
974504 - マスタデータ同期化のリンクテーブルの不整合

**7.4.5.3.2. R1908 - GUID xxxxxxのビジネスパートナがすでに存在します** (77ページ)
この問題は、顧客/仕入先に対応するビジネスパートナが作成されたが、リンクテーブル CVI\_CUST\_LINK または CVI\_VEND\_LINK にエントリが存在しない場合に発生します。修正レポートがこの問題を解決します。
SAPノート 2373665 - 同じ番号オブジェクトのCVIテーブルのリンク不足

**7.4.5.3.3. ロックテーブルオーバーフロー** (77ページ)
同期化プロセス中にロックテーブルオーバーフローが発生する可能性があります。これは、パラメータ enque/table\_size によって引き起こされる技術的な制限によるものです。必要に応じて、パラメータ enque/table\_size の値を大幅に（例：システムの構成とマスタデータ量に応じて4〜10 GB）増やしてください。

注: ロックテーブルのオーバーフローは、マスタデータ同期化のリンクテーブルの不整合（「エラー！参照元が見つかりません。エラー！参照元が見つかりません。- エラー！参照元が見つかりません。」(ノート 974504 - マスタデータ同期化のリンクテーブルの不整合を参照) と記載されています）を引き起こす可能性があります。

**7.4.5.3.4. 更新終了エラー (ADRNR)** (77ページ)
同期化プロセスは、番号範囲オブジェクト ADRNR が枯渇したために終了する可能性があります。新しいビジネスパートナの作成は、多くの新しいアドレスも作成します。CVI一括実行を開始する前に、現在の番号オブジェクトを確認し、必要に応じて変更してください。

カスタマイズパス:
IMG -> SAP Netweaver -> アプリケーションサーバー -> Basisサービス -> アドレス管理 -> アドレスと個人番号範囲の保守

または、トランザクションSNROで番号範囲オブジェクトADRNRを呼び出すか、トランザクションSA01を使用します。

---
**(続き: 78ページ)**

**7.4.5.3.5. R11244 - アドレスの有効期間のエラー** (78ページ)
アドレスに不整合があります。これらの不整合を修正するには、SAPノートを確認してください。
1064373 - SAP BP: アドレスの不整合をクリアするためのレポート BUT000<->ADR\*
865271 - BP\_MISC: アドレスの不整合を取得するためのレポート

**7.4.5.3.6. AM053 - アドレス番号またはアドレスハンドルを指定してください** (78ページ)
アドレスに不整合があります。これらの不整合を修正するには、SAPノートを確認してください。
1064373 - SAP BP: アドレスの不整合をクリアするためのレポート BUT000<->ADR\*
865271 - BP\_MISC: アドレスの不整合を取得するためのレポート

**7.4.5.3.7. F2810/F4230 - 銀行XXXが国YYで削除マークされています** (78ページ)
顧客/仕入先マスタデータで使用される銀行キー（顧客: KNBK-BANKL、仕入先: LFBK-BANL）が削除マークされている（例：トランザクションFI06で）ことがメッセージの根本原因です。

メッセージ番号BF00210のメッセージはデフォルトでエラーとして定義されているため、同期化は失敗します。
トランザクションOBA5を使用して新しいユーザー固有のメッセージ制御を定義することにより、エラーメッセージをオフに切り替えます。アプリケーションエリアBF00を選択します。保守ビューで「新規エントリ」を押します。メッセージ番号210を選択し、オンライン処理およびバッチ入力処理のメッセージタイプとして「-」を選択します。新しいエントリを保存します。

**図74: ユーザーごとのメッセージ制御**

**7.4.5.3.8. すべてのアドレス番号が定義されていません** (78ページ)
一部のケースで、ADRCテーブルのアドレスが顧客/仕入先にリンクされていないことが報告されています。同時に、トランザクションXD02/XK02はADRCからアドレスデータを読み取ろうとして失敗します。

正しい投稿を保証するために、マスタデータレプリケーションの前に、アドレス番号の割当を保証するための追加チェックを実行する必要があります。

チェックと修正を自動化するためのレポートを作成します。

**7.4.5.3.9. その他** (78ページ)
以下のリスト（網羅的ではない）は、前の章で説明されていないその他のカスタマイズおよびマスタデータエラーを示しています。これらのエラーは、以前の顧客変換プロジェクトで発生したものであり、便宜のためにここにリストされています。

問題を解決するために、マスタデータを手動またはツールを介して変更します。顧客が時間的制約またはリソース制約のために既存のデータ品質を受け入れる場合、エラーのチェックが構成であれば、構成をバイパスするチェックは短期的な救済策として検討でき、SAP S/4HANA変換が予定通りに開始できるようにします。データエラーは修正される必要があり、データエラーチェックは本番稼動前に復元される必要があります。

---
**(続き: 79ページ)**

| メッセージクラス / 番号 | メッセージ |
|---|---|
| AM/129 | 輸送ゾーン xxxxxx は国 xx に定義されていません |
| AR/102 | VAT登録番号 XXXXXXXXX は長さ 12 でなければなりません |
| AR/103 | VAT登録番号 XXXXXXXXX は長さ 12 を超えています |
| AR/104 | 銀行キー AAA は数字のみを含む必要があります |
| AR/191 | VAT登録番号のISOコード XX は正しくありません |
| AR/196 | VAT登録番号に無効な文字が含まれています |
| BF00/211 | 銀行 XXX が存在しません |
| FSBP\_FS\_ATTRIBUTES/015 | 会社 XXX が存在しません |
| GEOCODING/002 | ジオコーダ SAP0: 国指定が不完全です (カスタマイズ) |
| R1/286 | ビジネスパートナ xxx がすでに存在します (第0章も参照) |
| R1/1124 | GUID xxxxx のビジネスパートナが存在しません |
| T5/002 | 国コード xx の電話/ファックスコードが維持されていません |

**7.5. 変換プロセス** (79ページ)

ECCシステムをSAP S/4HANAにアップグレードするための変換プロセスは、S/4HANA変換ガイドに従ってトリガーする必要があります。技術チームが実行する変換ステップは、ECCシステムからSAP S/4HANAオンプレミスへのシステム変換の一部です。追加のCVIアクションは必要ありません。

システム変換の前提条件として、CVIのカスタマイズが設定され、テストされている必要があります。すべての顧客/仕入先マスタデータのビジネスパートナへの変換は、システム変換の一部としてCVI変換を実行しようとするのではなく、カスタマイズやマスタデータ設定の問題を予測して解決できるように、システム変換前に実行することが推奨されます。

**7.5.1. CVI変換アプローチ: 主要な考慮事項** (79ページ)

CVI変換（ビジネスパートナ同期化）を計画する際の主な考慮事項は次のとおりです。

* ダウンタイムなし
* SAP S/4HANA変換プロセスのクリティカルパスに含まれない
* 労力や時間に関する直前の驚きなし

CVIは、変換されるマスタデータが高い品質であることを要求します。コックピットレベルでは品質チェックをオフにすることはできません。これにより、顧客は顧客および仕入先マスタのデータ品質プロジェクトを実行することが強制されます。事前に開始しないと、アップグレードにとって深刻な障害となる可能性があります。

CVI変換の時間と労力に影響を与え、上記の目標と競合する可能性のある他の要因があります。

* BP/CVI/事前チェックのノウハウ
* 顧客/仕入先/BP番号範囲
* BPカスタマイズの整合性（項目属性を含む）
* 顧客/仕入先/ビジネスパートナデータの一貫性
* 顧客/仕入先拡張機能（拡張 - 複雑で時間がかかる場合がある）
* データボリューム

顧客は、SAP S/4HANA変換プロジェクトの遅延を避けるために、現在のシステムでCVIの実行を直ちに開始する必要があります。

**7.5.2. CVI変換アプローチ: 例** (79ページ)

1. 以下のステップについては、トランザクション CVI\_COCKPIT を使用して体系的なタスクシーケンスを実行します。このトランザクションでCVI変換の進捗状況を維持および追跡します。
2. SAP S/4HANAプロジェクトの早期段階で、本番データを使用してサンドボックスでCVI変換を実行します。
    * 本番CVI変換の前にすべてのデータエラーを特定し、エラー解決を決定します。特定のマスタデータエラーでは、既存のマスタデータを修正するためにカスタムプログラムが必要になる場合があります。

---
**(続き: 80ページ)**

* ビジネスプロセスへの影響を評価し、データ検証を緩和するために設定による回避策が実装されることがあります。例えば、顧客に対してタイトルMr.が使用され、システムがCompanyを期待する場合などです。
    * 本番環境でのCVI変換プロセスのランタイムを評価します。必要な変換時間が長すぎてSAP S/4HANA変換スケジュールに影響を与える場合、以下の手順に従ってCVI変換を事前に行うことができます。そうでない場合は、SAP S/4HANA変換とともにCVI変換を実行できます。
3. 同期化方向「顧客/仕入先からビジネスパートナへ」に対してのみ、ECC本番システムでCVIを構成します。
4. CVIコックピットでロードツールを実行します（これはトランザクションMDS\_LOAD\_COCKPITを呼び出します。ビジネス取引の中断を避けるため、できれば業務時間外に実行してください）。ダウンタイムは不要ですが。
5. CVIコックピットの「CVIロード」フェーズで、後処理および完全性チェックステップを実行し、変換されなかったオブジェクトに対してロードツール（MDS\_LOAD\_COCKPIT）ステップを再度実行する前に、顧客/仕入先/連絡担当者で変換されていないすべてのエラーを特定し、解決します。
6. ユーザーは、SAP S/4HANA変換の前に、ECC顧客/仕入先保守トランザクションを使用してマスタデータ作成を継続し、CVIがバックグラウンドでビジネスパートナを作成します。
7. ECCシステムをSAP S/4HANAに変換する前に、BPトランザクションをロックしてユーザーの使用を防ぎます。
8. ECCシステムをS/4HANAに変換します。
9. S/4HANAシステムで、ビジネスパートナから顧客/仕入先への方向のCVIを有効化します。

**7.5.3. SUM実行中のCVI事前チェックのバイパス (概念実証 (POC) 使用のみ)** (80ページ)
サンドボックス環境でのSAP S/4HANA概念実証（POC）テスト中に、顧客/仕入先マスタデータ品質が低く、データを修正する時間が十分でない場合、以下のSAPノートで説明されている手順に従うことで、SUM実行中のCVI事前チェックをバイパスできます。

重要
チェックのバイパスはSAPでは推奨されておらず、サンドボックス環境でのテスト目的のため、例外的な場合にのみ行うべきです。

実際のSAP S/4HANA変換中にこのチェックをバイパスすることは推奨されません。なぜなら、これらのエラーは理想的には修正されるべきだからです。修正は、エラーの原因に応じて、手動または他の顧客固有のレポートで行うことができます。エラーの特定と修正をサポートする重要なツールは次のとおりです。

* カスタマイズチェックトランザクション CVIカスタマイズ – チェックレポート（トランザクションコード BP\_CVI\_IMG\_CHK）。CVIコックピットを介して、「準備」フェーズタブの「自動化されたカスタマイズ」として、または「アップグレード準備」フェーズタブの「アップグレード前カスタマイズチェック」として直接実行できます。SAPノート 2891455 - 新しいカスタマイズチェックレポート SAP S/4HANAマスタデータ移行 (BP<->CVI) を確認してください。
* 完全性チェックトランザクション（トランザクションコード）は、まだ同期化されていない顧客、仕入先、連絡担当者をリストします。これは、トランザクションコード CVI\_COMPL\_CHK で開始するか、CVIコックピットの「CVIロード」フェーズタブから開始できます。
* 後処理オフィスは、CVI同期化中のエラーを見つけるのに役立ちます。エラーは修正でき、同期化を再度実行できます。後処理オフィスには、CVIコックピットの「CVIロード」および「アップグレード準備」フェーズタブからアクセスできます。
* マスタデータ整合性チェックレポート（トランザクションコード CVI\_PRECHK）。このレポートは準備フェーズでのほとんどの一般的なマスタデータ整合性エラーの早期検出と修正のために考慮されていますが、変換前の後のフェーズでも依然として有用です。個々のマスタデータレコードの修正に加えて、PoC中の同期化エラーを回避するために、定数値の設定など、一括修正を行うことも可能です。

ビジネスパートナへの顧客/仕入先データの同期化に使用される必須チェックの一部をバイパスするために、MDS\_LOAD\_COCKPITトランザクションを実行する前に、以下のSAPノートを実装してください（セクション7.4.1同期化コックピットを参照）。

* SAPノート 2336018 - BP S4HANA : MDS\_LOAD\_COCKPITトランザクション経由での必須BP項目グループチェックの抑制
* SAPノート 2345087 - BP\_BAP: 一括処理での投稿終了を引き起こす必須入力項目での値の欠落

---
**(続き: 81ページ)**

また、セクション7.4.1.2「一部のチェックの抑制」に記載されているように、裁判所固有のチェックを含むさらなるチェックの切り替えも考慮してください。

**7.5.4. ヒントとトリック** (81ページ)

* パフォーマンス MDS\_LOAD\_COCKPIT: 単一のビジネスパートナの作成には合理的な時間がかかります。SAPはパフォーマンスを改善しましたが、フルロードは与えられた同期時間を超える可能性があります。MDS\_LOAD\_COCKPITは、同期化を並列プロセスで実行するオプションを提供します。このオプションを使用することが強く推奨されます。いくつかの経験に基づくと、データベースパフォーマンスはボトルネックではありません。並列で10以上のプロセスを実行してもDBパフォーマンスは低下しません。
* 通常、BPに使用される番号範囲はSAP標準ではバッファリングされません。各単一プロセスはNRIVから新しい番号を生成します。これは、例えば、一括並列処理を使用する場合、番号範囲に対する並列ロックにつながる可能性があります。これは、番号範囲のバッファリングを使用することで防ぐことができます。

**7.6. 変換後アクティビティ** (81ページ)

ビジネスパートナおよび完了したシステム変換の一括初期ロードが成功した後、ビジネスパートナがリードオブジェクトであることを保証するために、いくつかの設定を変更する必要があります。システムを調整して、新しく作成または変更されたビジネスパートナを顧客/仕入先にバック同期化する必要があります。

S/4HANA 2020以降、S/4HANAでのCVI同期化のためのカスタマイズチェックを行うのに役立つトランザクション BP\_CVI\_IMG\_CHK (CVIカスタマイズチェックfor同期化) があります。これは整合性チェックを行い、対応するカスタマイズに直接ジャンプできるようにします。これはセクション7.3.2.2 CVIカスタマイズ – チェックで説明されているECCの同じトランザクションに対応しますが、S/4HANAではビジネスパートナがリードオブジェクトであり、同期化の方向がビジネスパートナから顧客/仕入先であることに焦点を当てています。これはトランザクションコード BP\_CVI\_IMG\_CHK を介して開始でき、カスタマイズではここにあります。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> ビジネスパートナ (CVI) -> カスタマイズチェック -> ビジネスパートナ 顧客/サプライヤ統合チェック

**図75: S/4HANAでのCVIカスタマイズチェックのためのトランザクション BP\_CVI\_IMG\_CHK**

**7.6.1. 後処理オーダーの作成の有効化 (BPから顧客/仕入先への方向)** (81ページ)
標準システムでは、すべてのビジネスプロセスに対して後処理オーダーの作成が無効になっています。前のパラグラフ7.3.8.1.2「後処理オーダーの作成の有効化」では、ビジネスパートナへの顧客/仕入先 (CVI\_01 および CVI\_02) の方向が有効化されていることが確認されています。今度は、ビジネスパートナから顧客/仕入先への方向を有効化する必要があります。

---
**(続き: 82ページ)**

IMG -> クロスアプリケーションコンポーネント -> 一般アプリケーション機能 -> 後処理オフィス -> ビジネスプロセス -> 後処理オーダーの作成の有効化

コンポーネント AP-MD の後処理オーダー作成を有効にし、ビジネスプロセス CVI\_03 (ビジネスパートナ > 顧客) および CVI\_04 (ビジネスパートナ > 仕入先) を有効にします。エントリを有効にするためにチェックボックスをマークします。

**図76: 後処理オーダーの作成の有効化**

備考
S/4HANAへのシステム変換が完了した後、顧客/仕入先の保守はビジネスパートナトランザクションを使用してのみ可能になります。したがって、ビジネスプロセス CVI\_01 および CVI\_02 はもはや使用されません。カスタマイズエントリは残すことができますが、使用されません。

注意 SUMによるS4/HANAへの変換を実行する前に、後処理オフィスにリストされている後処理オーダーを解決することが極めて重要です。なぜなら、これらはSUM事前チェックの対象ではないからです。そのため、トランザクションMDS\_PPO2を使用できます。（章7.2.3も参照）そうしないと、データ不整合が発生します。

**7.6.2. 同期化オプションの有効化 (BPから顧客/仕入先への方向)** (82ページ)
このIMGアクティビティを使用すると、顧客/仕入先とビジネスパートナ間でデータが同期化される方向を設定できます。データは両方向で同期化できます。これは、ビジネスパートナから顧客/仕入先へ、および顧客/仕入先からビジネスパートナへデータを更新できることを意味します。

章7.3.8.1.4「同期化オプションの有効化」では、顧客/仕入先からビジネスパートナへの方向のオプションを有効にしました。今度は、ビジネスパートナから顧客/仕入先への方向を有効にする必要があります。

IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 同期化制御 -> 同期化制御 -> 同期化オプションの有効化

準備フェーズでまだ実行されていない場合は、以下の新しいエントリを挿入します。

* ソースオブジェクト BP およびターゲットオブジェクト 顧客
* ソースオブジェクト BP およびターゲットオブジェクト 仕入先

アクティベーションチェックボックスをマークして、両方のエントリを有効にします。

---
**(続き: 83ページ)**

**図77: アクティブな同期化オプション**

備考
システム変換が完了した後、顧客/仕入先の保守はビジネスパートナトランザクションを使用してのみ可能になります。したがって、同期化オプション 顧客 -> ビジネスパートナ および 仕入先 -> ビジネスパートナはもはや使用されません。カスタマイズエントリは残すことができますが、使用されません。

**7.6.3. 顧客統合のためのBPロールカテゴリの設定** (84ページ)
このIMGアクティビティでは、ビジネスパートナから顧客/仕入先への方向で顧客/仕入先統合を有効にするBPロールカテゴリを定義します。ビジネスパートナを処理する際に、財務会計で対応する顧客/仕入先がどのように作成されるかを決定できます。

このIMGアクティビティに入力されるBPロールカテゴリは、顧客に基づいています。これは、システムが対応するBPロールを持つビジネスパートナを処理するときに、顧客/仕入先統合を考慮することを意味します。IMGアクティビティでは、BPロールカテゴリに割り当てられたビジネスパートナロールが、必須またはオプションの顧客/仕入先ビジネスパートナロールであるかを定義します。

必須の顧客/仕入先ビジネスパートナロールの場合、システムは対応する顧客/仕入先を自動的に作成します。オプションの顧客/仕入先ビジネスパートナロールの場合、ビジネスパートナ処理中に対応する顧客/仕入先を作成するかどうかを決定できます。

**BPから顧客へ**
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> BPロールカテゴリの設定

**図78: 顧客統合のためのビジネスパートナロールの設定**

概要画面では、ビジネスパートナロールカテゴリを割り当てる必要があります。システムは、このアカウントグループに割り当てられているBPロールでビジネスパートナを作成します。

**BPから仕入先へ**
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 仕入先統合のための設定 -> BPロールカテゴリの設定

**図79: 仕入先ビジネスパートナロールの定義リンク**

---
**(続き: 85ページ)**

概要画面では、ビジネスパートナロールカテゴリを割り当てる必要があります。システムは、このアカウントグループに関連付けられたビジネスパートナロールで、関連するアカウントグループを持つビジネスパートナを作成します。

**7.6.4. 番号割当 (CVIターゲット: 顧客/仕入先)** (85ページ)
このIMGアクティビティでは、顧客/仕入先マスタレコードのアカウントグループをビジネスパートナグルーピングに割り当て、顧客/仕入先統合の一部としてビジネスパートナが処理されるのと同時に顧客/仕入先が更新されるようにします。この割当で、顧客/仕入先マスタレコードが内部または外部の番号割当を持つアカウントグループで作成されるか、または同じ番号で作成されるかを選択できます。同じ番号を使用する場合は、第7.1.8.2項「番号範囲とグルーピング」で説明されているように、ビジネスパートナの番号範囲を調整する必要があります。

ビジネスパートナと顧客/仕入先の同じ間隔を割り当てます。新しく作成された顧客/仕入先が対応するビジネスパートナと同じ番号付けを持つことを保証するために、顧客/仕入先の番号割当を外部に設定します。フラグ「同じ番号」を設定します。

**番号割当 (BPから顧客へ)**
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 顧客統合のための設定 -> 顧客統合のための項目割当 -> キーの割当 -> 方向 BPから顧客への番号割当の定義

**図80: 方向 ビジネスパートナから顧客への番号割当**

**番号割当 (BPから仕入先へ)**
IMG -> クロスアプリケーションコンポーネント -> マスタデータ同期化 -> 顧客/仕入先統合 -> ビジネスパートナ設定 -> 仕入先統合のための設定 -> 仕入先統合のための項目割当 -> キーの割当 -> 方向 BPから仕入先への番号割当の定義

**図81: アカウントグループとグルーピングの割当**

---
**(続き: 86ページ)**

**7.6.5. アカウントグループの項目ステータスの変更** (86ページ)
システム変換後、顧客および仕入先を作成または保守するためのトランザクションは使用できなくなり、ビジネスパートナトランザクションBPにリダイレクトされます。

今後、顧客および仕入先マスタレコードの項目ステータスに関する設定は、対応するビジネスパートナ設定を使用して構成できます。トランザクションBPで定義された項目ステータス設定が考慮されるようにするために、SAPノート 2516606 - BP\_CVI: トランザクションBPにおける顧客および仕入先のFI固有の項目変更の考慮 / 2603898 - BP\_CVI: S/4HANAのCVIにおけるトランザクションBPでのFI項目変更 (FMOD1) の考慮のための統合SAPノート を実装してください。

このトピックの処理に関するその他の役立つヒント:

ビジネスパートナフィールドグループへの項目変更マッピングに加えて、この情報も確認してください。

* SAPノート 2603898 BP\_CVI: SAP S/4HANAのCVIにおけるトランザクションBPでのFI項目変更 (FMOD1) の考慮のための統合SAPノート
* SAPノート 2848273 CVI\_BDT: トランザクションBPでの項目ステータス (必須、非表示など) の理由を見つける ("可視性チェックレポート")
* ブログ「トランザクションBP、CVIにおける項目変更のヒントとトリック in S/4HANA」
https://blogs.sap.com/2020/06/17/tips-and-tricks-on-field-modifications-in-transaction-bp-cvi-in-s-4hana/

項目グループとデータセットを見つけるには、トランザクションBPで情報が必要な項目にカーソルを置きます。トランザクションフィールドでOK-Code BDT\_ANALYZERを入力します。その後、項目グループ、データセットなどのすべての技術情報を取得できるポップアップが表示されます。

さらなる項目ステータス分析のために、トランザクションCVI\_CHECK\_VISIBILITYを使用できます。トランザクションBPで入力項目が必須、表示専用、非表示、またはオプションであり、この項目グループに対して異なる項目ステータスを期待する場合、または変更したい場合は、このトランザクションで項目ステータスの理由を示すことができます。

**7.6.6. 業種の対応付け** (86ページ)
ビジネスパートナから顧客/仕入先への方向の業種マッピングを維持する必要があります。構成ステップは、前の章7.3.8.4.4「業種の割当」で「方向 ビジネスパートナから顧客/仕入先への業種マッピング」としてすでに説明されています。

上記の段落で説明されているように、有効な値が維持されていることを確認してください。

**7.6.7. 一般的な対応付けチェック** (86ページ)
CVIカスタマイズで維持したすべての値がビジネスパートナカスタマイズで利用可能であることを確認してください。連絡担当者、顧客、仕入先の各設定を二重に確認してください。参照として、セクション 7.3.8.3 顧客値マッピング (連絡担当者)、7.3.8.4 顧客値マッピング、および 7.3.8.5 仕入先値マッピングを参照してください。

**7.6.8. ヒントとトリック** (86ページ)

* PPOには時間の経過とともに多数のエントリが含まれる可能性があります。非本番システムでは、PPOをクリーンアップするためにパッケージ /SAPPO/ORDER からのトランザクションを使用できます。
    ノート 2776860 - プログラム /SAPPO/DELETE\_ORDERS は廃止されており、PPOオーダーの削除はサポートされていません。

---
**8. カスタムコードへの影響** (87ページ)

S/4HANAでのCVI/BPに関連するカスタムコードには、いくらかの影響があります。
すべてのバッチ入力およびCALL TRANSACTIONステートメントは、API CL\_MD\_BP\_MAINTAINを使用して再実装する必要があります。

CALL TRANSACTION の例外的なケースは1つだけであり、これらの古いトランザクションに対して自動的に適切なトランザクションにリダイレクトされるトランザクションを、パラメーターなしで呼び出す場合にのみ使用できます。

FD01, FD02, FD03, FK01, FK02, FK03, MAP2, MAP3, MK01, MK02, MK03, V-03, V-04, V-05, V-06, V-07, V-08, V-09, V-11, VAP1, VAP2, VAP3, VD01, VD02, VD03, XD01, XD02, XD03, XD05, XK01, XK05, XK06, XK07, XK02, XK03.

リダイレクトが機能しない古いトランザクションには例外は適用されません。
FD06, FK06, MK06, MK12, MK18, MK19, VD06, XD06, XD0, V+21, V+22, V+23, MAP21, FD0

上記の古いトランザクションのリストは、中央ノート 2265093 – S4TWL – ビジネスパートナアプローチ、で見つけることができます。

ECCの対応する顧客/仕入先マスタデータテーブルフィールドは、ビジネスパートナから顧客/仕入先へのCVIを介してSAP S/4HANAで移入されます。

SI\_MD\_BPのピースリストに記載されているテーブルへの直接書き込みステートメントやカスタムコードの記述、またはビジネスパートナマスタデータの作成/更新の代わりに、SAPノート 2417298 - 顧客およびサプライヤロールを持つビジネスパートナの作成に記載されている利用可能なAPI (CL\_MD\_BP\_MAINTAIN)、IDOC、またはBP SOAサービスを使用する必要があります。

---
**9. 周辺システム/その他のアプリケーションへの影響** (88ページ)

**9.1. インターフェース** (88ページ)

**9.1.1. 一般情報** (88ページ)
SAP S/4HANAサイドバイサイド実装で引き続き機能するビジネスパートナのインターフェースは次のとおりです。

* ビジネスパートナのCIFインターフェース、例: SCM-EWM, SCM-TM
* ビジネスパートナ同期化のためのミドルウェア、例: CRM
* 顧客および仕入先に関するBWレポート（BWエクストラクタについては、常にノート 25002020 - S4TWL - SAP S/4HANAのBWエクストラクタを確認してください）

ビジネスパートナマスタデータを作成または更新する外部アプリケーションは、SAPノート 2417298 - 顧客およびサプライヤロールを持つビジネスパートナの作成に記載されているIDOCまたはBP SOAPサービスを使用する必要があります。

以下のノートも考慮してください:

* SAPノート 2506041 - S4TWL - API RFC\_CVI\_EI\_INBOUND\_MAIN は、S/4 HANA OP 1709 FPS2リリースおよびCloud Edition 1805以降ではサポートされていません
* SAPノート 2650140 - RFC\_CVI\_EI\_INBOUND\_MAIN は廃止される予定です。

システム内でビジネスパートナを作成するために、API ABAPクラス CL\_MD\_BP\_MAINTAIN を使用できます。

バッチ入力は、S/4HANAでは顧客マスタおよびサプライヤマスタデータを保守するテクノロジーとしてはサポートされません。SAP S/4HANAが「ビジネスパートナファースト」アプローチに従うため、従来の顧客およびサプライヤトランザクションは廃止されたため、バッチ入力プログラムは機能しなくなります。詳細と代替手段については、SAPノート 2492904 - S4TWL - 顧客/サプライヤマスタのバッチ入力、を確認してください。

システム内の別のアプリケーションから関数モジュール (FM) BUP\_PARTNER\_MAINTAIN を呼び出すことで、トランザクションBPにナビゲートできます。

セクション6.2 移行 / BP更新も参照してください。

**9.1.2. S/4HANAのIDoc DEBMAS/CREMAS** (88ページ)
これらの両方のIDocタイプはS/4HANAで引き続き利用可能です。インバウンド処理は、BPから顧客/仕入先へのCVI同期化をサポートするように再設計されました（ノート 2417298 - ビジネスパートナと顧客およびサプライヤロールの統合を参照）。

制限事項として、IDocは顧客または仕入先部分のみをカバーします（例：同じBPへの顧客と仕入先のマージはサポートされていません）。APIの変更（同期 BP-> C/Vのサポート）により、技術的な制限がいくつか存在します（参照：ノート 2479954 - SAP S/4HANAビジネスパートナでのDEBMAS/CREMAS IDoc）。

ノート:

* IBANのみ: IDocにIBANのみが含まれる場合（銀行ID、銀行口座なし、IBANのみ）、MM-Switch MM\_SFWS\_SC2（ビジネス機能 LOG\_MM\_CI\_2）を両方のIDocタイプでアクティブにして処理する必要があります（KBA 1664137 - 銀行口座情報がCREMAS / DEBMAS Idocで更新されないを参照）。
* 銀行口座情報を持つビジネスパートナ（顧客/仕入先）をDEBMAS/CREMAS IDOCを使用してレプリケートしようとしていますが、銀行口座情報のみがあり、口座番号がない場合、銀行口座情報はレプリケートされません。解決策：SAPノート 2754287 - 銀行口座番号なしのDEBMAS/CREMAS IBAN機能を実装します。
* S/4HANAでのDEBMAS/CREMASのカスタムロジックについては、SAPノート 2630068 - S/4 HANAでのDEBMAS/CREMASのカスタムロジックの処理を確認してください。

**9.2. 従業員レプリケーション** (88ページ)
SAP S/4HANAの顧客は、SAP ERP HCMオンプレミスも使用している可能性があり、SAP ERP HCMの使用を継続したい場合があります。SAP HCMは、個別のインスタンスまたはSAP S/4HANAとの単一インスタンスで実行できます。両方のオンプレミスインスタンス間の統合（SAP HCMとSAP S/4HANAオンプレミス）は、ALEを介して、

---
**(続き: 89ページ)**

SAP HCMが別のインスタンスで実行されている場合にのみ、利用可能です。SAP HCMがSAP S/4HANAオンプレミスと同じインスタンスで実行されている場合、統合は「互換性モード」の一部として自動的に提供されます。

S/4HANAの新しいデータモデルはビジネスパートナ（BP）に基づいています。各従業員にはBPが割り当てられる必要があります。従業員マスタデータはCVIの一部ではありません。これらはロール「従業員」および「仕入先」を持つビジネスパートナとして作成される必要があります。

SAP S/4HANAに変換した後、本番使用前に移行レポート /SHCM/RH\_SYNC\_BUPA\_FROM\_EMPL を実行する必要があります。カスタマイズの依存関係により、レポートは技術的なダウンタイム中に実行することはできません。

詳細については、以下のSAPノートを参照してください。

* 2340095 - S4TWL - 従業員のビジネスパートナへの変換（意図されたS/4HANAターゲットリリース、例：「統合ガイド - OP 2020.pdf」に従って添付ファイルを確認してください）。
* 2713963 - FAQ: CVI - システム変換のための顧客仕入先統合からSAP S/4HANAへ
* 2409229 - 従業員同期化レポート: FAQ

S/4HANA 2020オンプレミスで導入された新しい従業員ビジネスパートナモデルを必ず確認してください。例えば、ロール従業員におけるBPの並行雇用およびグローバル雇用を適切に反映できます（リンクの詳細を確認してください）。新しいモデルを取得するには、それをオンにする必要があります。「統合ガイド - OP 2020.pdf」の詳細を確認してください。この実装SAPノートを使用したい場合は、S/4HANAで新しい従業員ビジネスパートナモデルを使用することをチェックしてください。

* 2539457 - CVIと従業員仕入先が間違ったBPカテゴリにいる: CVIがアクティブな場合、仕入先作成または変換中にBPは個人カテゴリで作成されます。

以下のSAPノートによるオプションは推奨されません。

* 2542175: CVIがアクティブな場合、仕入先作成または変換中に従業員BPが再利用される（仕入先に対して新しいBPを作成するのではなく）。ノートより：「しかし、このSAP S/4HANAデータモデルには制限があり、そのため推奨しません。」
* 2869343: CVIがアクティブな場合、仕入先作成または変換時の潜在的な制限にもかかわらず、従業員BPが再利用される。ノートより：「これはデフォルトでは望ましくありません。なぜなら、HRで並行雇用または国再アサインメント（CE/GE）を使用している場合、従業員ビジネスパートナのデータ最新性に関して制限がある可能性があるため、推奨しません。」

第7.3.10項 HCM従業員のビジネスパートナへの変換の準備も確認してください。

S/4HANA 1809 FPS02 – 1909 (すべてのFPS、SPS) のリリースについては、クックブック SAP S/4HANA Cookbook Employee Business Partner Integration as of SAP S/4HANA 1809 FPS02 で、さらに詳細な情報と「ハウツー」が見つかります。このクックブックには、S/4HANA 2020で導入された変更は反映されていません。

個人データ処理トピックについては、このSAPノートを確認してください。

* 2959779 FAQ: 従業員ビジネスパートナの個人データ処理

**9.3. 与信管理** (89ページ)
与信管理 (FI-AR-CR) はSAP S/4HANAの一部としては利用できません。SAP S/4HANAの機能的な同等物はSAP与信管理 (FIN-FSCM-CR) です。FI-AR-CRをFIN-FSCM-CRに移行する必要があります。

移行には、ビジネスパートナ関連のステップ（例：与信管理のビジネスパートナロールの有効化）などが含まれます。

詳細については、SAPノート 2270544 - S4TWL - 与信管理を参照してください。ビジネスパートナ関連のステップを含む詳細なタスクリストは、ノートに添付されています。

---
**(続き: 90ページ)**

**9.4. CRM** (90ページ)

ノート 2285062 – S4TWL: SAPCRMとS/4HANA間のビジネスパートナデータ交換、オンプレミス版は、さまざまなCVIフェーズでの適応を処理する方法の全体的な紹介を提供します。このノートには、さらなるノートと情報へのリンクが含まれています。

**図82: SAP ERP 6.0およびSAP S/4HANAにおけるSAP CRM統合のフェーズ**

また、CVIを有効化して一括同期化を開始する前に実行する必要がある重要かつ必須のステップも含まれています。以下のクロスリファレンスノートを考慮してください。

* 2283695 – 同期化コックピットがSAP CRMマッピングテーブルを無視して間違ったGUIDでビジネスパートナを生成する
* 2420959 – CVI\_MAPPERの住所GUID RFC BADI

**重要**
顧客/仕入先統合 (CVI) のBAdIが実装され、ビジネスパートナ生成のための顧客または仕入先マスタデータの同期化が一括で開始される前に、BAdIが実装されていることが不可欠です。統合シナリオでSAP CRMを使用している場合、同期化の前に同期化を開始すると、ビジネスパートナ間のマッピングが回復不能に失われます。

チェックレポートは、BAdI実装がシステムに利用可能かどうかを検証するために提供されています（ノート 2304337 - Badi実装 CVI\_MAPPER の事前チェッククラスの説明ノート）。さらに、既存のCVIがすでにアクティブであった場合に発生する可能性のある不整合、または一括同期化後に発生する不整合を特定するチェックレポートも利用可能です。

準備ステップおよびシステム変換後のステップに関する詳細情報については、上記のSAPノートの最新バージョンを参照してください。

フェーズ:

* ECC、CVIを有効化する前
    * SAP CRM (CRMKUNNR, CRMPARNR, CRMLIFNR) からのBP-GUIDを含むSAP CRMマッピングテーブルの整合性と完全性をチェックする
    * ノート 2283695 – 同期化コックピットがSAP CRMマッピングテーブルを無視して間違ったGUIDでビジネスパートナを生成する、2420959 – CVI\_MAPPERの住所GUID RFC BADIを実装する。
* ECC、CVIを有効化し、MDS\_LOAD\_COCKPITで一括同期化
    * MDS\_LOAD\_COCKPITの前: CRMミドルウェアを非アクティブ化する
    * MDS\_LOAD\_COCKPITによる一括同期化: 上記テーブルからのGUIDが使用されます。

---
**(続き: 91ページ)**

* MDS\_LOAD\_COCKPITの後: セットアップを変更し、CRMミドルウェアを再アクティブ化する

リードオブジェクト（顧客またはBP）を決定し、ノート 1808119 – CVIがアクティブな場合、CRMで2つのキューにECC顧客の作成または変更の結果が生じる、を使用します。

* MDS\_LOAD\_COCKPITの後: ノート 2304337 - Badi実装 CVI\_MAPPER の事前チェッククラスの説明ノートからのレポートで、不整合なGUIDがないかチェックします。
* S/4HANA（SUM後）、BPがリードオブジェクト
    * S/4HANA変換後のダウンタイムで、SAP S/4HANAオンプレミスエディションとSAP CRM間のビジネスパートナデータ交換のためのカスタマイズ設定について、ノート 2283810 – を実行します。SAP S/4HANAへの変換時にビジネスパートナ、顧客マスタ、仕入先マスタデータを交換したくない場合は、ノート 2882755 - ノート 2283810の補遺、にも注意してください。
    * 制限事項については、以下の2つのノートを考慮してください: 2231667 – SAP S/4HANA、オンプレミスエディションとSAP CRMの統合に関する制限、2324473 – SAP CRMとSAP S/4HANAの統合: 解決された制限、により部分的に解決されています。

詳細な説明はopenSAPコース「SAP S/4HANAへのシステム変換における主要な機能トピック」（第3週、ユニット5を参照）で提示されています。

SAP CRMとCVIに関連する以下のSAPノートのリストも参照してください。

* 2231667 – SAP CRMとのSAP S/4HANA、オンプレミスエディションの統合に関する制限
* 2324473 – SAP CRMとSAP S/4HANAの統合: 解決された制限、により部分的に解決されています
* 1808119 - CVIがアクティブな場合、ECC 617のみでCRMとECC間のビジネスパートナレプリケーション
    * 低いリリースの場合は、SAPノート 2545498 - CVIがアクティブな場合、ERPとCRM間の間違ったビジネスパートナGUIDを適用してください。
* 2283695 - 同期化コックピットがSAP CRMマッピングテーブルを無視して間違ったGUIDでビジネスパートナを生成する
* 2654430 - CRMとS4間のデータ交換は、古いビジネスパートナの場合、両方のシステムでビジネスパートナのGUIDが異なるため不可能です。
* 2748477 - FM - COM\_BUPA\_MWX\_FILTER\_MAINでCRM GUIDからS4 BP GUIDへのマッピングが考慮されない
* 2624257 - 仕入先作成の結果、メインテーブルとCRMマッピングテーブル間で不整合なGUIDが発生する
* 2704424 - 顧客作成の結果、メインテーブルとCRMマッピングテーブル間で不整合なGUIDが発生する
* 2283810 - SAP S/4 HANA、オンプレミスエディションとSAP CRM間のビジネスパートナデータ交換のためのカスタマイズ設定

**BPロールフィルタリング**
SAP ERP 6.0（ECCおよびS/4）からCRMへのレプリケーションのためにロールまたは完全なビジネスパートナをフィルタリングする必要がある場合、SAP ERP 6.0でテーブルCOM\_BUPA\_CALL\_FU（トランザクションCOM\_BUPA\_CALL\_FU）にZファンクションモジュールを登録する必要があります。これは、メインファンクションモジュールが呼び出される前のイベントR3OUT / オブジェクトBUPAで登録する必要があり、BPデータを準備するために、例えば次のように行います。

**図: データ交換: 活性化ファンクションモジュール**

ロールまたはBPをフィルタリングする理由、例えば:

---
**(続き: 92ページ)**

* CRMで仕入先ロールは不要です
* 顧客マスタに割り当てられていないBP（「ピュア」仕入先など）はCRMで不要です

**BPロールマッピング（ヒントとトリック）:**
SAP ERP 6.0（ECCおよびS/4）からCRMへのロールマッピングが必要な場合、CRMでテーブルCRMC\_BUT\_CALL\_FU（トランザクションBUPA\_CALL\_FU）に関数モジュールZを登録する必要があります。このZファンクションモジュールは、ファンクションモジュール「BUPA\_INBOUND\_MAIN\_CENTRAL」の直前に登録する必要があります。例えば、次のようになります。

**図: データ交換: 活性化ファンクションモジュール**

SAP ERP 6.0の外部イベントCRMOUで実行しない理由については、章「9.7 MDG（S/4に埋め込み）」を確認してください。

**9.5. 業種ソリューション – ユーティリティ (IS-U)** (92ページ)
ユーティリティ業種ソリューションでは、C/VからBPへの変換にMDS\_LOAD\_COCKPITを使用できません。以下のSAPノートを参照してください。

* 2344100 - S4TWL - SAP ISUのCVI統合
* 2354282 - S4事前チェック IS-UT: SAPユーティリティソリューションのS/4 HANAへの移行のための変換レポート
* 2364509 - レポート REU\_CVI\_CUST\_LINK はすべてのレコードを処理しない
* 2202282 - S4TC IS-UTマスタチェック S/4システム変換チェック

レポート REU\_CVI\_CUST\_LINK および REU\_CVI\_EKUN\_TO\_BUT0ID を実行してCVIが完了していることを確認する必要があります。また、新しい顧客を作成するたびにデルタ同期化がトリガーされるわけではないことも念頭に置く必要があります。したがって、特定の技術変換ステップでCVIを完了する必要がある場合に、いつでもこれらのプログラムを起動する必要があります。

IS-UとCVIに関する包括的なFAQを含むノート:

* SAPノート 2792765 - FAQ: IS-UTアップグレード S4

**9.6. 業種ソリューション – 小売 (IS-R)** (92ページ)
小売業種ソリューションについては、以下のSAPノートを参照してください。

* 2310884 - サイトマスタのSAP S/4HANA変換
    特に、ノートの添付ファイルを確認してください。
* 2451504 - サイトに割り当てられた顧客/仕入先のCVIカスタマイズチェックレポート
* 3074379 - 顧客仕入先統合 (CVI) コックピットからの小売サイトの除外
* 3112307 - 顧客仕入先統合 (CVI) コックピットからの小売サイトの除外 - ドキュメント

**9.7. MDG (S/4に埋め込み)** (92ページ)
現在の経験に基づき、以下を考慮してください。

* MDG自体は、ビジネスパートナのデータを表示するためにマッピングおよび準備するために既存の機能を使用します。例えば、CRMミドルウェアのイベントCRMOUを使用します。アクティブなすべてのファンクションモジュールが呼び出されます。独自のZファンクションモジュールを登録する場合、これを特に考慮する必要があります。この背景から、イベントCRMOUは、例えばS/4からCRMへのBPロールのマッピングには適切ではありません。

---
**(続き: 93ページ)**

**9.8. SAP Cloud for Customer (C4C)** (93ページ)
SAP Cloud for Customerとの統合については、S/4HANAリリースのサポートされている統合シナリオを以下のノートで見つけてください: 2293815 - SAP S/4HANAエンタープライズ管理: SAP Cloud for Customerとの統合シナリオに関する情報。ERPアドオンCODERINTはS/4HANAではもはや使用されません。なぜなら、統合はS/4HANAコアの一部だからです。アップグレードの場合、ERPアドオンはアンインストールされます。

S/4HANA変換の検証からの「SAP Cloud for Customerとの統合を伴うS/4HANA変換」を説明するドキュメントは以下で見つけることができます。
https://www.sap.com/documents/2018/09/925c68a9-1d7d-0010-87a3-c30de2ffd8ff.html

またはブログはこちら:
https://blogs.sap.com/2018/09/20/s4hana-conversion-with-integration-to-sap-cloud-for-customer/

---
**10. 追加情報** (94ページ)

**10.1. SAPノート** (94ページ)

以下は役立つSAPノートの概要です。本ドキュメントで言及されているものは「ドキュメント内のリンク」列でマークされています。特に SAPノート 2265093 - S4TWL - ビジネスパートナアプローチを参照してください。

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| BPマスタノート | 2265093 | S4TWL - ビジネスパートナアプローチ | x |
| 新規導入 / 移行 | 2239701 | SAP Rapid Data Migration for SAP S/4HANA, オンプレミス版 | x |
| | 2287723 | SAP S/4HANAオンプレミス版でのLSMW | x |
| | 2324208 | 許可された支払者 : DDIC 変更 | x |
| | 2331298 | S/4 HANA BPロードプログラムでRFC機能のロードオプションがない | x |
| | 2312529 | DEBMASの受信時のALEインバウンドエラー | x |
| 拡張機能 | 2309153 | BP\_CVI: S4HANAリリースにおけるCVI (顧客/仕入先統合) の顧客拡張機能に関するガイドラインバージョン 1.14 | x |
| | 2295823 | BP\_CVI: 顧客/仕入先項目をビジネスパートナへ転送 - テンプレートソースコード | x |
| | 1623809 | XOフレームワークの開発者ドキュメント | x |
| | 2565693 | BP\_BCL: 中央BPデータに対する顧客固有の検証が特定の場合に機能しない | |
| MDS\_LOAD\_COCKPIT 同期化 | 2513118 | MDS\_LOAD\_COCKPITがテスト実行モードで CVI\_CUST\_LINK/ CVI\_VEND\_LINK エントリを作成する | |
| | 2701228 | mds\_load\_cockpit のPPO改善 | |
| | 2780288 | S/4 HANA 移行: MDS\_LOAD\_COCKPIT からの同期化中に顧客/仕入先->BP方向でBPチェックを抑制できる | x |
| | 2906882 | SAPノート 2780288 の後にチェックが抑制されない | |
| | 2898039 | BP CVI: 仕入先の一括同期化中に間違ったエラー処理 | |
| | 2923695 | 同期化中にBPを作成する際のエラーにより不整合なCVIリンクが作成される。 | |

---
**(続き: 95ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| | 2907519 | マスタデータ同期化ツールリバイムプ | |
| | 2954330 | MDS\_LOAD\_COCKPITのモニタータブのパフォーマンス向上 | |
| | 2958046 | CVI : MDS\_LOAD\_COCKPITが特定の日付のログを表示しない | |
| | 2955619 | MDS\_LOAD\_COCKPIT Excelアップロード行数 | |
| | 2386600 | CVI: 連絡担当者とのBP同期化における間違ったエラー処理 | |
| | 2446456 | CVI: 連絡担当者ビジネスパートナアドレスマッピングが常に正しいわけではない | |
| | 2763205 | 顧客連絡担当者の変更がビジネスパートナに反映されない | |
| | 2777401 | アドレスが変更されたときに連絡担当者ビジネスパートナが更新されない | |
| | 2804399 | テスト実行後にBPへの同期化が失敗する | |
| | 2647788 | ビジネスパートナでのシミュレーション機能 | |
| | 2786293 | CVI: ビジネスパートナマッピングから顧客/仕入先へのマッピング中に、連絡担当者が正しくマッピングされない。 | |
| リンク / マッピング | 974504 | マスタデータ同期化のリンクテーブルの不整合 | x |
| | 1958471 | CVI\_VEND\_CT\_LINK テーブルに不整合なエントリがある (ノート 974504で言及されているSAPノート) | |
| | 2831298 | CVI\_VEND\_CT\_LINK テーブルの不整合。 | |
| | 2798554 | CVI\_OTH: BP ID付きのテーブル CVI\_CUST\_LINK および CVI\_VEND\_LINK のビュー | |
| | 954816 | BPの作成/リンクのためのトランザクション | x |
| | 1306639 | BP\_CVI: CVIがアクティブな場合の顧客./仕入先からのBPのオプション作成 | |
| | 2383051 | 仕入先連絡担当者のビジネスパートナへのマッピングの開発 (SAPノートの現在のステータス: パイロット) | x |
| | 2363892 | S/4へのアップグレード前の初期ロード中に顧客と仕入先を単一のビジネスパートナにリンク | x |

---
**(続き: 96ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| ビジネス機能 | 1454441 | 仕入先の連絡担当者の開発 (前提条件と副作用を参照) | x |
| 制限事項 | 2214213 | SAP S/4HANA、オンプレミス版 1511: 制限ノート (BPの制限された項目数) | x |
| チェック & ツール | 2832085 | 顧客仕入先統合 (CVI) からビジネスパートナへの新しいセントラルコックピット | x |
| | 2823648 | ビジネスパートナCVI同期化の前提条件SAPノートに関する情報 | x |
| | 2820678 | CVI SAP\_APPL TCI | x |
| | 2891455 | 新しいカスタマイズチェックレポート SAP S/4HANAマスタデータ移行 (BP<->CVI) 用 | x |
| | 2211312 | S4TC SAP\_APPL: ビジネスパートナの事前変換チェック (チェッククラス) | |
| | 2210486 | 廃止 : 変換レポート: チェックとIMGアクティビティのドキュメント + BPチェッククラスを使用するためのZレポート | x |
| | 956054 | BP\_CVI: ERP 6.00以降の顧客/仕入先統合 | x |
| | 2344034 | S/4HANA Automation for Master Data Migration (CVI\_UPGRADE\_CHECK\_RESOLVE) | x |
| | 2345087 | 2344034の前提条件: 一括処理での投稿終了を引き起こす必須入力フィールドでの値の欠落 | x |
| | 2336018 | 2344034の前提条件: MDS\_LOAD\_COCKPITトランザクション経由での必須BP項目グループチェックの抑制 | x |
| | 2874184 | テスト実行動作に関する情報。 | x |
| | 2743494 | 2743494 - 事前検証: マスタデータ整合性チェック | x |
| | 2780288 | S/4 HANA 移行: MDS\_LOAD\_COCKPIT からの同期化中に顧客/仕入先->BP方向でBPチェックを抑制できる | x |
| | 2891522 | CVI\_COCKPIT: 新しいカスタマイズチェックレポートへのナビゲーション | X |
| | 2861108 | CVI\_COCKPIT: CVI\_LOADテーブルエントリとドキュメント | X |

---
**(続き: 97ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| | 2812309 | CVI\_COCKPIT: CVI\_LOAD ステージ | X |
| | 2850361 | 顧客/仕入先統合のTCIの言語依存オブジェクトのテキスト (DE/EN) の配信 (SAPノート 2818292) | X |
| | 2850537 | セントラル顧客仕入先統合(CVI) コックピット - インターフェースノート | X |
| | 2942339 | 事前検証: マスタデータ整合性チェック V2 - DDIC作成 | X |
| | 2891951 | 事前検証: マスタデータ整合性チェックレポートへの機能強化 | X |
| | 2949093 | 事前検証: マスタデータ整合性チェックレポート - 権限オブジェクトへの機能強化 | X |
| | 2949094 | 事前検証: マスタデータ整合性チェックレポート - 権限オブジェクト: DDIC | X |
| | 2958796 | 事前検証: マスタデータ整合性チェックレポートから仕入先データが保存されない | X |
| | 2996762 | マスタデータ整合性チェック (Tcode : CVI\_PRECHK) で業種チェックが実行されない | X |
| | 2968936 | マスタデータ整合性チェックレポート - データ品質管理 (DQM) に基づく住所クレンジング: DDIC作成 | X |
| | 2957924 | マスタデータ整合性チェックレポート - データ品質管理 (DQM) に基づく住所クレンジング | X |
| | 2807124 | インターフェース IF\_ADDRESS\_COMM\_CHECK のパラメータ不一致 | |
| | 2749015 | 通信データに対する国固有のチェック | |
| | 2832840 | BaDI 抑制チェックに関するドキュメント更新 | |
| | 2872225 | CVI\_BDT: レポート CVI\_CHECK\_VISIBILITY および CVI\_CHECK\_VISIBILITY\_BUPR の単体テスト | |
| BP 修正 | 2326148 | ビジネスパートナ 顧客 / 仕入先に関する分類機能。 | |

---
**(続き: 98ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| | 2484379 | 仕入先機能の返品 | |
| マスメンテナンス | 2346269 | XD99およびXK99を使用した顧客/仕入先の大量保守機能 | x |
| インターフェース/DEBMAS/CREMAS IDoc | 2417298 | 顧客およびサプライヤロールを持つビジネスパートナの作成 | X |
| | 2506041 | S4TWL - API RFC\_CVI\_EI\_INBOUND\_MAIN は、S/4 HANA OP 1709 FPS2 および Cloud Edition 1805 以降ではサポートされていません | X |
| | 2479954 | SAP S/4HANAビジネスパートナでのDEBMAS/CREMAS IDoc | x |
| | 2754287 | 銀行口座番号なしのDEBMAS/CREMAS IBAN機能 | x |
| | 1664137 | 銀行口座情報がCREMAS / DEBMAS Idocで更新されない | x |
| 従業員 | 2340095 | S4TWL - 従業員のビジネスパートナへの変換 | x |
| | 2323301 | SAP HCM従業員ロールのビジネスパートナ同期化に関するカスタマイズドキュメント | x |
| | 2792166 | BPと従業員の同じ番号 -> 参照ノートを参照 | |
| | 2475550 | HCM従業員 BPトランザクションの処理 - DDICレポート | x |
| | 2475604 | HCM従業員 BPトランザクションの処理 | x |
| | 2463565 | S/4HANAシステムでのトランザクションBPの動作とHRシステムからの従業員データ | x |
| | 2507610 | 戻りパラメータの不一致によりS/4メソッド呼び出しで例外が発生する | x |
| | 2539457 | CVI & 従業員仕入先が間違ったBPカテゴリにいる | x |
| | 2542175 | CVIと既存の従業員ビジネスパートナの再利用 | x |
| | 2000099 | CVIがエラー R1231: 「組織用に指定されていないアドレス形式 &1」で失敗する | x |

---
**(続き: 99ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| | 2880559 | BAdIインターフェース CVI\_MAP\_TITLE~IF\_EX\_CVI\_MAP\_TITLE の新しいインポートパラメータによる機能強化。 | x |
| | 2959779 | FAQ: 従業員ビジネスパートナの個人データ処理 | x |
| CRM | 2285062 | S4TWL: SAP CRMとS/4HANA間のビジネスパートナデータ交換 | x |
| | 2283810 | SAP S/4 HANA、オンプレミス版とSAP CRM間のビジネスパートナデータ交換のためのカスタマイズ設定 | x |
| | 2882755 | ノート 2283810 の補遺 | x |
| | 1968132 | CVIがアクティブな場合のCRMとECC間のビジネスパートナレプリケーション (ECC 617のみ) | x |
| | 2526204 | ECCからCRMへの仕入先BPのレプリケーションの制限 | x |
| | 2283695 | 同期化コックピットがSAP CRMマッピングテーブルを無視して間違ったGUIDでビジネスパートナを生成する | x |
| | 2420959 | CVI\_MAPPERの住所GUID RFC BADI | x |
| | 2304337 | Badi実装 CVI\_MAPPER の事前チェッククラスの説明ノート | x |
| | 1808119 | CVIがアクティブな場合、ECC顧客の作成または変更がCRMで2つのキューを生成する | x |
| | 2231667 | SAP S/4HANA、オンプレミス版とSAP CRMの統合に関する制限 | x |
| | 2324473 | SAP CRMとSAP S/4HANAの統合: 解決された制限 | x |
| | 2654430 | CRMとS4間のデータ交換は、古いビジネスパートナの場合、両方のシステムでビジネスパートナのGUIDが異なるため不可能です。 | x |
| | 2704424 | 顧客作成の結果、メインテーブルとCRMマッピングテーブル間で不整合なGUIDが発生する。 | x |
| | 2624257 | 仕入先作成の結果、メインテーブルとCRMマッピングテーブル間で不整合なGUIDが発生する | x |
| | 2748477 | FM - COM\_BUPA\_MWX\_FILTER\_MAINでCRM GUIDからS4 BP GUIDへのマッピングが考慮されない | x |
| | 2545498 | CVIがアクティブな場合のSAP ERP 6.0とCRM間の間違ったビジネスパートナGUID | x |

---
**(続き: 100ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| 与信管理 | 2270544 | S4TWL - 与信管理 | X |
| タイム依存性 | 2379157 | S4TWL - ビジネスパートナ BUT000/ヘッダーレベルタイム依存性 (--> BPが使用され、BUT000のタイム依存性が有効な場合、事前チェックに含める) | X |
| 項目制御 | 2603898 | BP\_CVI: SAP S/4HANAのCVIにおけるトランザクションBPでのFI項目変更 (FMOD1) の考慮のための統合SAPノート | X |
| | 2848273 | CVI\_BDT: トランザクションBPでの項目ステータス (必須、非表示など) の理由を見つける ("可視性チェックレポート") | x |
| | 2516606 | BP\_CVI: トランザクションBPにおける顧客および仕入先のFI固有の項目変更を考慮する | x |
| 税エラー | 1006160 | 新しいEUメンバーに対する新しい税番号タイプ (2007年1月1日現在) | X |
| | 2098239 | 税コード2の項目への入力が11文字を超える | x |
| | 958424 | BP: 税コード2のカスタムメッセージ | X |
| | 2445162 | CVI: 仕入先に対するBP税番号DE5マッピングが不正確 | |
| | 2317896 | 同期化中にstcd5の税番号フィールドが移入される。 | |
| | 2299895 | 中国の税番号の誤ったCVIマッピング | |
| | 2527465 | アルゼンチンに対する税カテゴリAR1DおよびAR1ZでのCVIの失敗 | |
| | 2463731 | 中国のゴールデン税番号: 税タイプ CN5 STCD5へのマッピング | |
| | 1751648 | アルゼンチンローカライゼーションの不足している税番号カテゴリ | |
| | 1382602 | スイスのVAT登録番号が不正確にマッピングされる | |
| | 1128784 | エラー:VAT登録番号が国ですでに編集されている | |
| | 1041155 | スイスVAT登録番号の移行問題 | |
| | 2232604 | 仕入先または顧客をビジネスパートナにレプリケートする際のBUPA\_TAX200エラー | X |

---
**(続き: 101ページ)**

| トピック | SAPノート | タイトル / 説明 | ドキュメント内のリンク |
|---|---|---|---|
| IS ユーティリティ | 2766031 | EU離脱後のFIにおける税番号チェックと税番号入力 (STCEG) | |
| | 2344100 | S4TWL - SAP ISUのCVI統合 | x |
| | 2354282 | S4事前チェック IS-UT: SAPユーティリティソリューションのS/4 HANAへの移行のためのレポート | x |
| | 2202282 | S4TC IS-UT マスタチェック S/4システム変換チェック | X |
| | 2792765 | FAQ: IS-UTアップグレード S4 | X |
| 小売 | 2310884 | サイトマスタのSAP S/4HANA変換 | X |
| | 2814283 | S4事前チェックでサイトマスタの連絡担当者を除外しない | X |
| | 3074379 | 顧客仕入先統合 (CVI) コックピットからの小売サイトの除外 | X |
| | 3112307 | 顧客仕入先統合 (CVI) コックピットからの小売サイトの除外 - ドキュメント | X |

**10.2. ドキュメント** (101ページ)
以下は、さらなるリソースへのリンクのリストです。

* S/4HANA簡素化項目カタログ
* SAP S/4HANA 2021の変換ガイド
* SAPヘルプ: ビジネスパートナアプローチの導入
* SAPヘルプ: 顧客仕入先統合
* SAPヘルプ: マスタデータ同期化
* SAPノート 2265093 S4TWL - ビジネスパートナアプローチ
* SAPノート 2340095 S4TWL – 従業員のビジネスパートナへの変換
* SAPノート 2713963 FAQ: CVI - システム変換のための顧客仕入先統合からSAP S/4HANAへ
* SAPノート 2823632 ビジネスパートナアプローチとCVIプロセスに関するコンサルティングノート

---
**11. 図一覧** (102ページ)

| 図番号 | タイトル | ページ |
|---|---|---|
| 図1 | CVI複合インターフェース | 7 |
| 図2 | CVI同期化シナリオ | 14 |
| 図3 | CVI同期化プロセス | 18 |
| 図4 | CVIコックピットによってサポートされるフェーズ | 19 |
| 図5 | トランザクション CVI\_COCKPIT (ECC 6.0) | 19 |
| 図6 | SAPノートに関するCVIコックピットの準備 | 22 |
| 図7 | マスタデータ整合性チェックの選択画面 | 25 |
| 図8 | マスタデータ整合性チェックの結果リスト | 25 |
| 図9 | CVIカスタマイズチェックの例のスナップショット | 26 |
| 図10 | CVI完全性チェックの例のスナップショット | 27 |
| 図11 | ビジネス機能の有効化 | 29 |
| 図12 | 後処理オーダーの作成の有効化 | 30 |
| 図13 | ダイアログでのPPOの有効化のためのプラットフォームオブジェクト | 31 |
| 図14 | 同期化前の「アクティブな同期化オプション」の設定 | 32 |
| 図15 | 設定文書化のためのExcel形式 | 35 |
| 図16 | 顧客番号範囲の保守 | 35 |
| 図17 | 顧客アカウントグループ番号範囲の割当 | 36 |
| 図18 | 仕入先番号範囲の保守 | 36 |
| 図19 | 仕入先アカウントグループ番号範囲の割当 | 36 |
| 図20 | ビジネスパートナ番号範囲の保守 | 37 |
| 図21 | ビジネスパートナグルーピングの保守 | 37 |
| 図22 | ビジネスパートナグルーピングの保守 | 38 |
| 図23 | 番号範囲の定義: BP関係 | 38 |
| 図24 | 顧客のロール割当の保守 | 40 |
| 図25 | 仕入先のロール割当の保守 | 40 |
| 図26 | 顧客の番号割当 | 41 |
| 図27 | 仕入先の番号割当 | 41 |
| 図28 | 連絡担当者の割当の有効化 | 42 |
| 図29 | 連絡担当者の部門番号の割当 | 43 |
| 図30 | 連絡担当者の機能の割当 | 43 |
| 図31. 連絡担当者の権限の割当 | 44 |
| 図32: 連絡担当者のVIPインジケータの割当 | 44 |
| 図33: 婚姻状況の割当 | 45 |
| 図34: 法的形態の法的ステータスへの割当 | 46 |
| 図35: 支払カードタイプの割当 | 46 |
| 図36: 業種システムの選択 | 47 |
| 図37: インバウンド業種マッピングの定義 | 47 |
| 図38: アウトバウンド業種マッピングの定義 | 48 |
| 図39: 業種セクターのカスタマイズの同期化 | 48 |
| 図40: ビジネスパートナアドレスタイプのチェック | 49 |
| 図41: 同期化コックピット - 処理 | 52 |
| 図41: 同期化コックピット - モニター | 53 |
| 図43: IMGノード「フィールドチェック抑制の有効化」 | 54 |
| 図44: PPOエラーの解決 | 59 |
| 図45: PPOエラーメッセージの表示 | 59 |
| 図46: PPO詳細の表示 | 60 |
| 図47: ビジネスプロセスIDごとのPPOオーダーの表示 | 61 |
| 図48 "アドレス形式の保守" | 61 |
| 図49: 一括同期化 - オブジェクト選択 | 62 |
| 図50: 後処理デスクトップ - オーダー詳細の編集 | 63 |
| 図51: MDSコックピット - モニター | 63 |
| 図52: 顧客変更: 一般データ | 64 |

---
**(続き: 103ページ)**

| 図番号 | タイトル | ページ |
|---|---|---|
| 図53: PPOデスクトップ - オーダー編集: 概要 | 64 |
| 図54: PPOデスクトップ - オーダー編集: 概要 | 65 |
| 図55: レポート CVI\_MAPPING\_BP\_CUST\_VEND | 65 |
| 図56: 税番号カテゴリの保守 | 67 |
| 図57: "アドレス形式の保守" | 68 |
| 図58: 国コードの定義 | 68 |
| 図59: 顧客一般データの変更 – 取引先 | 68 |
| 図60: 顧客一般データの変更 – 銀行口座 | 69 |
| 図61: 顧客一般データの変更 – 銀行管理キー | 70 |
| 図62: 顧客一般データの変更 – 銀行キー | 70 |
| 図63: 顧客一般データの変更 – 口座名義人 | 70 |
| 図64: 税番号 | 71 |
| 図65: 顧客一般データの変更 – VAT情報 | 72 |
| 図66: 税コードが長すぎる | 72 |
| 図67: 無効なクレジットカード番号 | 73 |
| 図68: 顧客一般データの変更 – 訪問時間 | 74 |
| 図69: 顧客一般データの変更 – Webアドレス | 74 |
| 図70: 顧客一般データの変更 – 輸送ゾーン | 75 |
| 図71: 顧客一般データの変更 – 値が長すぎる | 76 |
| 図72: ユーザーごとのメッセージ制御 | 76 |
| 図73: 住所のないマスタデータ | 77 |
| 図74: ユーザーごとのメッセージ制御 | 78 |
| 図75: S/4HANAでのCVIカスタマイズチェックのためのトランザクション BP\_CVI\_IMG\_CHK | 81 |
| 図76: 後処理オーダーの作成の有効化 | 82 |
| 図77: アクティブな同期化オプション | 83 |
| 図78: 顧客統合のためのビジネスパートナロールの設定 | 84 |
| 図79: 仕入先ビジネスパートナロールの定義リンク | 84 |
| 図80: 方向 ビジネスパートナから顧客への番号割当 | 85 |
| 図81: アカウントグループとグルーピングの割当 | 85 |
| 図82: SAP ERP 6.0およびSAP S/4HANAにおけるSAP CRM統合のフェーズ | 90 |

---
**104ページ**

www.sap.com/contactsap

© 2020 SAP SE または SAP 関連会社。無断複写・転載を禁じます。
本書のいかなる部分も、SAP SEまたはSAP関連会社の書面による明示的な許可なく、いかなる形式または目的のためにも複製または送信することはできません。
ここに記載されている情報は、事前の通知なしに変更されることがあります。SAP SEおよびその販売店が販売する一部のソフトウェア製品には、他のソフトウェアベンダーの専有ソフトウェアコンポーネントが含まれています。
国内製品仕様は異なる場合があります。

これらの資料は、情報提供のみを目的として、SAP SEまたはSAP関連会社によって提供されており、いかなる種類の表明または保証も行いません。SAPまたはその関連会社は、資料の誤りまたは省略について責任を負いません。SAPまたはSAP関連会社の製品およびサービスに対する唯一の保証は、製品およびサービスに付随する明示的な保証書に記載されているもののみです。本資料のいかなる内容も、追加の保証を構成するものと解釈されるべきではありません。

特に、SAP SEまたはその関連会社は、本ドキュメントまたは関連プレゼンテーションに記載されている事業方針を追求したり、本資料で言及されている機能、製品、プラットフォームの方向性、および機能性を開発またはリリースする義務を負いません。本ドキュメント、または関連プレゼンテーション、およびSAP SEまたはその関連会社の戦略および将来の可能性のある開発、製品、および/またはプラットフォームの方向性および機能性はすべて変更される可能性があり、SAP SEまたはその関連会社によっていつでも理由なく変更されることがあります。本ドキュメントの情報は、コミットメント、約束、または法的義務として解釈されるべきではありません。すべての将来の見通しに関する記述は、実際の結果が期待と大きく異なる可能性のあるさまざまなリスクと不確実性の対象となります。読者は、これらの将来の見通しに関する記述に過度な信頼を置かないように注意し、購入の意思決定に頼るべきではありません。

SAPおよびここに記載されているその他のSAP製品とサービス、およびそれぞれのロゴは、ドイツおよびその他の国におけるSAP SE（またはSAP関連会社）の商標または登録商標です。ここに記載されているその他のすべての製品およびサービス名は、それぞれの会社の商標です。追加の商標情報および通知については、http://www.sap.com/corporate-en/legal/copyright/index.epx を参照してください。

**SAP**
**Run Simple**